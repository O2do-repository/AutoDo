import{f as $}from"./fetchWithApiKey-C7sQFpO8.js";import{d as h,r as u,a as C,h as T,g as e,j as x,w as t,e as f,t as k,ab as z,o as A,_ as N,c as w,b as E,F as B,m as M,am as P,ac as L,ad as F,k as K,al as G,f as I,V as J}from"./index-Ch00-T5v.js";import{V as D,a as O,b as S,c as R}from"./VCard-BssREAJA.js";import{V as q}from"./VSpacer-D_tszrFr.js";import{V as W,a as j}from"./VSnackbar-Cj9k8E71.js";import{a as U,V as y}from"./VRow-B6JHqpeN.js";const H=h({__name:"DeleteConsultant",props:{consultantUuid:{}},emits:["consultantDeleted"],setup(a,{emit:o}){const d=a,b=o,i=u(!1),m=u(!1),c=u(!1),n=u(""),V=u(""),_=async()=>{if(!d.consultantUuid){n.value="UUID consultant manquant",V.value="red",c.value=!0;return}m.value=!0;try{const p=await $(`https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/consultant/${d.consultantUuid}`,{method:"DELETE"}),s=await p.text();let l;try{l=JSON.parse(s)}catch{throw new Error("Erreur serveur : réponse invalide")}if(!p.ok||!l.success)throw new Error(l.message);b("consultantDeleted",{uuid:d.consultantUuid,message:l.message})}catch(p){n.value=p.message||"Erreur inconnue",V.value="red"}finally{c.value=!0,m.value=!1}};return(p,s)=>(C(),T("div",null,[e(x,{color:"error",variant:"text",icon:"mdi-delete",density:"comfortable",onClick:s[0]||(s[0]=l=>i.value=!0)}),e(W,{modelValue:i.value,"onUpdate:modelValue":s[2]||(s[2]=l=>i.value=l),"max-width":"500"},{default:t(()=>[e(D,null,{default:t(()=>[e(O,{class:"headline"},{default:t(()=>s[4]||(s[4]=[f("Confirmer la suppression")])),_:1}),e(S,null,{default:t(()=>s[5]||(s[5]=[f(" Êtes-vous sûr de vouloir supprimer ce consultant ? ")])),_:1}),e(R,null,{default:t(()=>[e(q),e(x,{color:"grey",onClick:s[1]||(s[1]=l=>i.value=!1)},{default:t(()=>s[6]||(s[6]=[f("Annuler")])),_:1}),e(x,{color:"red",loading:m.value,onClick:_},{default:t(()=>s[7]||(s[7]=[f("Supprimer")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(j,{modelValue:c.value,"onUpdate:modelValue":s[3]||(s[3]=l=>c.value=l),color:V.value,timeout:"3000"},{default:t(()=>[f(k(n.value),1)]),_:1},8,["modelValue","color"])]))}}),Q=h({name:"ConsultantGrid",setup(){const a=u([]),o=u(!1),d=u(null),b=z(),i=u(!1),m=u(""),c=u("green"),n="https://via.placeholder.com/150?text=No+Image",V=async()=>{o.value=!0;try{const r=localStorage.getItem("apiKey"),v=await $("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/consultant",{method:"GET"});if(!v.ok)throw new Error("Failed to fetch consultants");const g=await v.json();if(g.success&&Array.isArray(g.data))a.value=g.data;else throw new Error("Invalid data format")}catch(r){d.value=r.message||"Unknown error"}finally{o.value=!1}},_=({uuid:r,message:v})=>{a.value=a.value.filter(g=>g.consultantUuid!==r),m.value=v,c.value="green",i.value=!0},p=async r=>{try{if(!(await $(`https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/consultant/${r}`,{method:"DELETE"})).ok)throw new Error("Erreur lors de la suppression");a.value=a.value.filter(g=>g.consultantUuid!==r)}catch(v){console.error(v.message)}},s=r=>{sessionStorage.setItem("selectedConsultant",JSON.stringify(r)),b.push("/consultant/consultant-info")},l=r=>{r.target.src=n};return A(()=>{V()}),{consultants:a,loading:o,error:d,snackbar:i,snackbarMessage:m,snackbarColor:c,deleteConsultant:p,goToConsultantProfiles:s,defaultImage:n,setPlaceholder:l,handleConsultantDeleted:_}}}),X={class:"consultant-name"},Y={class:"consultant-email text-caption grey--text"};function Z(a,o,d,b,i,m){const c=H;return C(),w(J,null,{default:t(()=>[e(U,{justify:"center"},{default:t(()=>[e(y,{cols:"12",class:"text-center mb-6"},{default:t(()=>o[3]||(o[3]=[E("h2",{class:"purple--text"},"A perfect blend of genius and caffeine",-1)])),_:1}),(C(!0),T(B,null,M(a.consultants,n=>(C(),w(y,{key:n.consultantUuid,cols:"12",sm:"4",md:"2",class:"text-center"},{default:t(()=>[e(D,{class:"consultant-card",elevation:"3",onClick:V=>a.goToConsultantProfiles(n)},{default:t(()=>[e(c,{consultantUuid:n.consultantUuid,onClick:o[0]||(o[0]=P(()=>{},["stop"])),onConsultantDeleted:a.handleConsultantDeleted},null,8,["consultantUuid","onConsultantDeleted"]),e(S,{class:"d-flex flex-column align-center justify-center text-truncate text-center"},{default:t(()=>[e(L,{size:"150"},{default:t(()=>[e(F,{src:n.picture?n.picture:a.defaultImage,alt:"Photo Consultant",contain:""},null,8,["src"])]),_:2},1024),E("div",X,k(n.surname)+" "+k(n.name),1),E("div",Y,k(n.email),1)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128)),e(y,{cols:"12",sm:"4",md:"2",class:"text-center"},{default:t(()=>[e(D,{outlined:"",class:"consultant-card d-flex flex-column align-center justify-center"},{default:t(()=>[e(x,{onClick:o[1]||(o[1]=n=>a.$router.push("/consultant/add-consultant")),icon:"",color:"primary"},{default:t(()=>[e(K,{large:""},{default:t(()=>o[4]||(o[4]=[f("mdi-plus-circle")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a.loading?(C(),w(U,{key:0,justify:"center"},{default:t(()=>[e(y,{cols:"12",class:"text-center"},{default:t(()=>[e(G,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):I("",!0),a.error?(C(),w(U,{key:1,justify:"center"},{default:t(()=>[e(y,{cols:"12",class:"text-center red--text"},{default:t(()=>[f(k(a.error),1)]),_:1})]),_:1})):I("",!0),e(j,{modelValue:a.snackbar,"onUpdate:modelValue":o[2]||(o[2]=n=>a.snackbar=n),color:a.snackbarColor,timeout:"3000"},{default:t(()=>[f(k(a.snackbarMessage),1)]),_:1},8,["modelValue","color"])]),_:1})}const ee=N(Q,[["render",Z],["__scopeId","data-v-d9878bf5"]]),re=h({__name:"list-consultant",setup(a){return(o,d)=>(C(),w(ee))}});export{re as default};
