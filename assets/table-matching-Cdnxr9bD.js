import{p as ce,D as ke,g as de,T as fe,a9 as Ce,G as R,e as me,aa as ve,f as n,H as L,at as Te,j as v,N as _e,ap as Pe,k as ge,O as I,ae as Fe,F as O,Q as oe,R as Re,au as Se,Y as Z,av as Me,X as ze,aw as Ue,h as he,a5 as je,o as V,i as H,w as s,l as B,n as d,x as N,t as k,q as K,s as $,z as se,B as re,ax as Be,V as Ae,_ as Ee}from"./index-D38XjB7g.js";import{c as De,d as ie,V as ee,a as Ge}from"./VSelect-IogMJ753.js";import{f as Ie,V as Q,q as Ne}from"./forwardRefs-BC4KZ-Ym.js";import{c as xe,u as pe,d as X,g as $e,h as He,i as Le,j as Oe,V as qe,a as ue}from"./VTextField-Duo7iVIY.js";import{V as Je,a as Ke,b as Qe}from"./VCard-CUGcD9f2.js";import{V as Xe}from"./VSpacer-CRe8laZ6.js";import{V as Ye}from"./VDataTable-B05uYdaD.js";const We=ce({...xe(),...ke(De(),["inline"])},"VCheckbox"),Ze=de()({name:"VCheckbox",inheritAttrs:!1,props:We(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,C){let{attrs:g,slots:x}=C;const i=fe(e,"modelValue"),{isFocused:f,focus:p,blur:M}=pe(e),A=Ce(),E=R(()=>e.id||`checkbox-${A}`);return me(()=>{const[D,y]=ve(g),z=X.filterProps(e),b=ie.filterProps(e);return n(X,L({class:["v-checkbox",e.class]},D,z,{modelValue:i.value,"onUpdate:modelValue":T=>i.value=T,id:E.value,focused:f.value,style:e.style}),{...x,default:T=>{let{id:_,messagesId:G,isDisabled:S,isReadonly:l,isValid:t}=T;return n(ie,L(b,{id:_.value,"aria-describedby":G.value,disabled:S.value,readonly:l.value},y,{error:t.value===!1,modelValue:i.value,"onUpdate:modelValue":o=>i.value=o,onFocus:p,onBlur:M}),x)}})}),{}}}),et=ce({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...xe(),...$e()},"VTextarea"),tt=de()({name:"VTextarea",directives:{Intersect:Te},inheritAttrs:!1,props:et(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,C){let{attrs:g,emit:x,slots:i}=C;const f=fe(e,"modelValue"),{isFocused:p,focus:M,blur:A}=pe(e),E=R(()=>typeof e.counterValue=="function"?e.counterValue(f.value):(f.value||"").toString().length),D=R(()=>{if(g.maxlength)return g.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function y(r,h){var m,w;!e.autofocus||!r||(w=(m=h[0].target)==null?void 0:m.focus)==null||w.call(m)}const z=v(),b=v(),T=_e(""),_=v(),G=R(()=>e.persistentPlaceholder||p.value||e.active);function S(){var r;_.value!==document.activeElement&&((r=_.value)==null||r.focus()),p.value||M()}function l(r){S(),x("click:control",r)}function t(r){x("mousedown:control",r)}function o(r){r.stopPropagation(),S(),Z(()=>{f.value="",Me(e["onClick:clear"],r)})}function u(r){var m;const h=r.target;if(f.value=h.value,(m=e.modelModifiers)!=null&&m.trim){const w=[h.selectionStart,h.selectionEnd];Z(()=>{h.selectionStart=w[0],h.selectionEnd=w[1]})}}const a=v(),c=v(+e.rows),U=R(()=>["plain","underlined"].includes(e.variant));Pe(()=>{e.autoGrow||(c.value=+e.rows)});function j(){e.autoGrow&&Z(()=>{if(!a.value||!b.value)return;const r=getComputedStyle(a.value),h=getComputedStyle(b.value.$el),m=parseFloat(r.getPropertyValue("--v-field-padding-top"))+parseFloat(r.getPropertyValue("--v-input-padding-top"))+parseFloat(r.getPropertyValue("--v-field-padding-bottom")),w=a.value.scrollHeight,q=parseFloat(r.lineHeight),Y=Math.max(parseFloat(e.rows)*q+m,parseFloat(h.getPropertyValue("--v-input-control-height"))),W=parseFloat(e.maxRows)*q+m||1/0,F=Ue(w??0,Y,W);c.value=Math.floor((F-m)/q),T.value=ze(F)})}ge(j),I(f,j),I(()=>e.rows,j),I(()=>e.maxRows,j),I(()=>e.density,j);let P;return I(a,r=>{r?(P=new ResizeObserver(j),P.observe(a.value)):P==null||P.disconnect()}),Fe(()=>{P==null||P.disconnect()}),me(()=>{const r=!!(i.counter||e.counter||e.counterValue),h=!!(r||i.details),[m,w]=ve(g),{modelValue:q,...Y}=X.filterProps(e),W=He(e);return n(X,L({ref:z,modelValue:f.value,"onUpdate:modelValue":F=>f.value=F,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":U.value},e.class],style:e.style},m,Y,{centerAffix:c.value===1&&!U.value,focused:p.value}),{...i,default:F=>{let{id:J,isDisabled:te,isDirty:ae,isReadonly:be,isValid:Ve}=F;return n(Le,L({ref:b,style:{"--v-textarea-control-height":T.value},onClick:l,onMousedown:t,"onClick:clear":o,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},W,{id:J.value,active:G.value||ae.value,centerAffix:c.value===1&&!U.value,dirty:ae.value||e.dirty,disabled:te.value,focused:p.value,error:Ve.value===!1}),{...i,default:ye=>{let{props:{class:le,...ne}}=ye;return n(O,null,[e.prefix&&n("span",{class:"v-text-field__prefix"},[e.prefix]),oe(n("textarea",L({ref:_,class:le,value:f.value,onInput:u,autofocus:e.autofocus,readonly:be.value,disabled:te.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:S,onBlur:A},ne,w),null),[[Re("intersect"),{handler:y},null,{once:!0}]]),e.autoGrow&&oe(n("textarea",{class:[le,"v-textarea__sizer"],id:`${ne.id}-sizer`,"onUpdate:modelValue":we=>f.value=we,ref:a,readonly:!0,"aria-hidden":"true"},null),[[Se,f.value]]),e.suffix&&n("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:h?F=>{var J;return n(O,null,[(J=i.details)==null?void 0:J.call(i,F),r&&n(O,null,[n("span",null,null),n(Oe,{active:e.persistentCounter||p.value,value:E.value,max:D.value,disabled:e.disabled},i.counter)])])}:void 0})}),Ie({},z,b,_)}}),at={class:"d-flex align-center mb-4"},lt={class:"text-h5"},nt={class:"text-subtitle-1 mb-2"},ot=["href"],st={key:0},rt=he({__name:"TableMatching",setup(e){je();const C=v([]),g=v(null),x=v(""),i=v([]),f=v(!1),p=v(""),M=v("success"),A=v([{key:"edit",title:"",align:"center"},{key:"rfpReference",title:"Référence RFP",align:"start"},{key:"score",title:"Score",align:"end"},{key:"offerDate",title:"Date de l'offre",align:"start"},{key:"statutMatching",title:"Statut",align:"start"},{key:"comment",title:"Commentaire",align:"start"}]),E=async()=>{try{const l=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matching");if(!l.ok)throw new Error("Erreur, impossible de récupérer les matchings");const t=await l.json();C.value=(Array.isArray(t.data)?t.data:[t.data]).map(o=>({...o,editable:!1})),i.value=y.value.map(o=>o.name)}catch(l){g.value=l instanceof Error?l.message:"Erreur, impossible de récupérer les matchings"}},D=l=>new Date(l).toLocaleDateString("fr-FR"),y=R(()=>{const l={};return C.value.forEach(t=>{const o=`${t.consultantSurname}_${t.consultantName}`,u=`${t.consultantSurname} ${t.consultantName}`;l[o]||(l[o]={name:o,fullName:u,jobTitleGroups:[]});let a=l[o].jobTitleGroups.find(c=>c.jobTitle===t.jobTitle);a||(a={jobTitle:t.jobTitle,matchings:[]},l[o].jobTitleGroups.push(a)),a.matchings.push(t)}),Object.values(l)}),z=R(()=>{if(!x.value)return y.value;const l=x.value.toLowerCase();return y.value.map(t=>{const o=t.jobTitleGroups.map(u=>{const a=u.matchings.filter(c=>{var U;return c.jobTitle.toLowerCase().includes(l)||c.rfpReference.toLowerCase().includes(l)||((U=c.comment)==null?void 0:U.toLowerCase().includes(l))||c.score.toString().includes(l)});return a.length>0?{jobTitle:u.jobTitle,matchings:a}:null}).filter(Boolean);return o.length>0?{...t,jobTitleGroups:o}:null}).filter(Boolean)}),b=l=>i.value.includes(l),T=l=>{b(l)?i.value=i.value.filter(t=>t!==l):i.value.push(l)},_=()=>i.value=y.value.map(l=>l.name),G=()=>i.value=[],S=async l=>{for(let t of l)if(t.editable)try{if((await fetch(`https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matching/${t.matchingUuid}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({statutMatching:t.statutMatching,comment:t.comment,score:t.score,profileUuid:t.profileUuid,rfpUuid:t.rfpUuid})})).ok)t.editable=!1,p.value="Modifications sauvegardées avec succès!",M.value="success",f.value=!0;else throw new Error("Erreur de sauvegarde")}catch(o){console.error("Erreur de sauvegarde :",o),p.value="Échec de la sauvegarde.",M.value="error",f.value=!0}};return R(()=>y.value.some(l=>l.jobTitleGroups.some(t=>t.matchings.some(o=>o.editable)))),ge(E),(l,t)=>(V(),H(Ae,null,{default:s(()=>[t[11]||(t[11]=B("h1",{class:"text-center mb-6"},"Liste des Matchings",-1)),n(ee,{type:"info",variant:"outlined",class:"mb-4 d-flex align-center"},{default:s(()=>[t[2]||(t[2]=d(" Vous devez être connecté pour accéder aux liens RFP sur le site Connecting-Expertise. ")),n(Q,{color:"info",variant:"outlined",href:"https://customer.connecting-expertise.com/",target:"_blank",rel:"noopener noreferrer",size:"small"},{default:s(()=>t[1]||(t[1]=[d(" Se connecter ")])),_:1})]),_:1}),B("div",at,[n(qe,{modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=o=>x.value=o),label:"Rechercher un matching","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":"",class:"flex-grow-1"},null,8,["modelValue"]),n(Ne,{class:"ml-4"},{default:s(()=>[n(Q,{onClick:_,size:"small",variant:"outlined"},{default:s(()=>[n(N,null,{default:s(()=>t[3]||(t[3]=[d("mdi-unfold-more-horizontal")])),_:1}),t[4]||(t[4]=d(" Tout développer "))]),_:1}),n(Q,{onClick:G,size:"small",variant:"outlined"},{default:s(()=>[n(N,null,{default:s(()=>t[5]||(t[5]=[d("mdi-unfold-less-horizontal")])),_:1}),t[6]||(t[6]=d(" Tout réduire "))]),_:1})]),_:1})]),g.value?(V(),H(ee,{key:0,type:"error",variant:"outlined",class:"mb-4"},{default:s(()=>[d(k(g.value),1)]),_:1})):K("",!0),!C.value.length&&!g.value?(V(),H(ee,{key:1,type:"info",class:"mt-4"},{default:s(()=>t[7]||(t[7]=[d(" Aucun matching disponible. ")])),_:1})):K("",!0),(V(!0),$(O,null,se(z.value,o=>(V(),$("div",{key:o.name,class:"mb-6"},[n(Je,null,{default:s(()=>[n(Ke,{class:re(["consultant-header d-flex align-center",{"cursor-pointer":!0}]),onClick:u=>T(o.name)},{default:s(()=>[n(N,{size:"large",class:"mr-2"},{default:s(()=>t[8]||(t[8]=[d("mdi-account")])),_:1}),B("span",lt,k(o.fullName),1),n(Xe),n(ue,{class:"ml-2 mr-2",color:"primary"},{default:s(()=>[d(k(o.jobTitleGroups.reduce((u,a)=>u+a.matchings.length,0))+" matching"+k(o.jobTitleGroups.reduce((u,a)=>u+a.matchings.length,0)>1?"s":""),1)]),_:2},1024),n(N,null,{default:s(()=>[d(k(b(o.name)?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:2},1024)]),_:2},1032,["onClick"]),n(Be,null,{default:s(()=>[b(o.name)?(V(),H(Qe,{key:0},{default:s(()=>[(V(!0),$(O,null,se(o.jobTitleGroups,u=>(V(),$("div",{key:u.jobTitle,class:"mb-4"},[B("h3",nt,[n(N,{class:"mr-1"},{default:s(()=>t[9]||(t[9]=[d("mdi-briefcase")])),_:1}),d(" "+k(u.jobTitle),1)]),n(Ye,{headers:A.value,items:u.matchings,class:"elevation-1 mb-4",density:"compact"},{"item.rfpReference":s(({item:a})=>[B("div",null,[B("a",{href:a.rfpUrl,target:"_blank",rel:"noopener noreferrer",style:{color:"#1976d2","text-decoration":"underline"}},k(a.rfpReference),9,ot)])]),"item.edit":s(({item:a})=>[n(Ze,{modelValue:a.editable,"onUpdate:modelValue":c=>a.editable=c,"hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),"item.offerDate":s(({item:a})=>[d(k(D(a.offerDate)),1)]),"item.score":s(({item:a})=>[n(ue,{color:a.score>=30?"success":a.score>=10?"warning":"error",class:re(a.score>=30?"text-white":""),size:"small"},{default:s(()=>[d(k(a.score),1)]),_:2},1032,["color","class"])]),"item.comment":s(({item:a})=>[n(tt,{modelValue:a.comment,"onUpdate:modelValue":c=>a.comment=c,disabled:!a.editable,density:"compact",variant:"outlined","hide-details":"",rows:"2",style:{width:"300px","text-align":"right"},class:"comment-textarea"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.statutMatching":s(({item:a})=>[n(Ge,{modelValue:a.statutMatching,"onUpdate:modelValue":c=>a.statutMatching=c,items:["Apply","NotApply","Rejected"],disabled:!a.editable,variant:"outlined",density:"compact","hide-details":"",style:{"max-width":"150px"}},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["headers","items"]),u.matchings.some(a=>a.editable)?(V(),$("div",st,[n(Q,{size:"small",color:"primary",onClick:a=>S(u.matchings)},{default:s(()=>t[10]||(t[10]=[d(" Sauvegarder ")])),_:2},1032,["onClick"])])):K("",!0)]))),128))]),_:2},1024)):K("",!0)]),_:2},1024)]),_:2},1024)]))),128))]),_:1}))}}),it=Ee(rt,[["__scopeId","data-v-1cfe3020"]]),ht=he({__name:"table-matching",setup(e){return(C,g)=>(V(),H(it))}});export{ht as default};
