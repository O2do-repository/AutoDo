import{_ as C,V as $}from"./VForm-BdH75OA7.js";import{h as w,j as i,a5 as B,O as N,k as L,_ as j,o as y,i as k,w as s,f as r,n as b,V as z}from"./index-Cq1kXTKe.js";import{V as J,a as D,b as A,c as F}from"./VCard-DQq9b4vQ.js";import{V as M,a as t}from"./VRow-1sGS59qU.js";import{V as p}from"./VTextField-CMTq0PpK.js";import{V as v}from"./VSelect-CDRWyK6h.js";import{V as H}from"./forwardRefs-DSjRsZ7R.js";const K=w({name:"AddProfile",components:{GoBackBtn:C},setup(){const e=i({consultantUuid:"",RateHour:null,CV:"",CVDate:"",JobTitle:"",ExperienceLevel:"",Skills:[],keywords:[]}),o=B(),f=["Junior","Medior","Senior"],m=i([]),c=i([]),n=i(null),u="https://example.com/default-cv.pdf",a=i(""),h=l=>!!l||"Champ obligatoire",E=l=>!isNaN(l)&&Number(l)>=0||"Entier positif requis",q=l=>/^(https?:\/\/)[^\s$.?#].[^\s]*$/.test(l)||"Lien invalide (ex: https://...)",g=l=>!!l||"Date requise",R=async()=>{try{const l=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/skill");if(!l.ok)throw new Error("Erreur récupération des skills");const d=await l.json();m.value=d.map(V=>V.name)}catch(l){console.error("Erreur skills :",l)}},P=async()=>{try{const l=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/keyword");if(!l.ok)throw new Error("Erreur récupération des keywords");const d=await l.json();c.value=d.map(V=>V.name)}catch(l){console.error("Erreur keywords :",l)}},T=()=>{if(!e.value.CV||e.value.CV.trim()===""){a.value="";return}a.value=e.value.CV},U=()=>{e.value.CV===u&&(e.value.CV="")},S=()=>{e.value.CV||(e.value.CV=u)};return N(()=>e.value.CV,T),L(()=>{const l=sessionStorage.getItem("selectedConsultantUuid");l?e.value.consultantUuid=l:console.error("Aucun consultant sélectionné"),R(),P()}),{profile:e,experienceLevels:f,availableSkills:m,availableKeywords:c,formRef:n,required:h,numberRule:E,urlRule:q,dateRule:g,placeholderCV:u,validCV:a,clearPlaceholder:U,restorePlaceholder:S,submitProfile:async()=>{try{if((!e.value.CV||e.value.CV.trim()==="")&&(e.value.CV=u),!n.value)return;const{valid:l}=await n.value.validate();if(!l)return;if(!(await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/profil",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.value)})).ok)throw new Error("Erreur lors de l'ajout du profil");setTimeout(()=>{o.go(-1)},1e3)}catch(l){console.error(l instanceof Error?l.message:"Une erreur est survenue")}}}}});function O(e,o,f,m,c,n){const u=C;return y(),k(z,null,{default:s(()=>[r(J,{class:"pa-4"},{default:s(()=>[r(u,{class:"mb-4"}),r(D,{class:"text-h5 font-weight-bold"},{default:s(()=>o[7]||(o[7]=[b("Nouveau Profil")])),_:1}),r(A,null,{default:s(()=>[r($,{ref:"formRef"},{default:s(()=>[r(M,null,{default:s(()=>[r(t,{cols:"12"},{default:s(()=>[r(p,{label:"Lien du CV *",modelValue:e.profile.CV,"onUpdate:modelValue":o[0]||(o[0]=a=>e.profile.CV=a),variant:"outlined",color:"primary",placeholder:e.placeholderCV,rules:[e.required,e.urlRule],onFocus:e.clearPlaceholder,onBlur:e.restorePlaceholder,required:""},null,8,["modelValue","placeholder","rules","onFocus","onBlur"])]),_:1}),r(t,{cols:"6"},{default:s(()=>[r(p,{label:"Job Title *",modelValue:e.profile.JobTitle,"onUpdate:modelValue":o[1]||(o[1]=a=>e.profile.JobTitle=a),rules:[e.required],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),r(t,{cols:"6"},{default:s(()=>[r(v,{label:"Niveau d'expérience *",modelValue:e.profile.ExperienceLevel,"onUpdate:modelValue":o[2]||(o[2]=a=>e.profile.ExperienceLevel=a),items:e.experienceLevels,rules:[e.required],variant:"outlined",color:"primary",required:""},null,8,["modelValue","items","rules"])]),_:1}),r(t,{cols:"6"},{default:s(()=>[r(p,{label:"Tarif / heure *",modelValue:e.profile.RateHour,"onUpdate:modelValue":o[3]||(o[3]=a=>e.profile.RateHour=a),modelModifiers:{number:!0},type:"number",rules:[e.required,e.numberRule],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),r(t,{cols:"6"},{default:s(()=>[r(p,{label:"Date du CV *",modelValue:e.profile.CVDate,"onUpdate:modelValue":o[4]||(o[4]=a=>e.profile.CVDate=a),type:"date",rules:[e.required,e.dateRule],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),r(t,{cols:"12"},{default:s(()=>[r(v,{label:"Compétences *",modelValue:e.profile.Skills,"onUpdate:modelValue":o[5]||(o[5]=a=>e.profile.Skills=a),items:e.availableSkills,multiple:"",chips:"","closable-chips":"",rules:[e.required],variant:"outlined",color:"primary"},null,8,["modelValue","items","rules"])]),_:1}),r(t,{cols:"12"},{default:s(()=>[r(v,{label:"Mots-clés *",modelValue:e.profile.keywords,"onUpdate:modelValue":o[6]||(o[6]=a=>e.profile.keywords=a),items:e.availableKeywords,multiple:"",chips:"","closable-chips":"",rules:[e.required],variant:"outlined",color:"primary"},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),r(F,{class:"d-flex justify-end"},{default:s(()=>[r(H,{color:"primary",onClick:e.submitProfile},{default:s(()=>o[8]||(o[8]=[b("Publier")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}const G=j(K,[["render",O]]),ee=w({__name:"add-profile",setup(e){return(o,f)=>(y(),k(G))}});export{ee as default};
