import{_ as R}from"./GoBackBtn.vue_vue_type_script_setup_true_lang-JHxlzadA.js";import{d as S,r as t,ab as D,P as J,o as F,_ as K,a as m,c as f,w as a,g as o,e as p,f as h,t as P,j as M,V as H}from"./index-Ch00-T5v.js";import{f as g}from"./fetchWithApiKey-C7sQFpO8.js";import{V as G,a as O,b as I,c as W}from"./VCard-BssREAJA.js";import{V as Q}from"./VForm-CEOap3g_.js";import{a as X,V as u}from"./VRow-B6JHqpeN.js";import{V}from"./VTextField-NEJ7P9LY.js";import{V as q}from"./VSelect-Db8poBrv.js";import{V as E}from"./VAlert-nealorJD.js";import"./VChip-Dh1s8N5S.js";const Y=S({name:"AddProfile",components:{GoBackBtn:R},setup(){const e=t({consultantUuid:"",RateHour:null,CV:"",CVDate:"",JobTitle:"",ExperienceLevel:"",Skills:[],keywords:[]}),r=D(),v=["Junior","Medior","Senior"],b=t([]),C=t([]),c=t(null),i="https://example.com/default-cv",s=t(""),T=l=>!!l||"Champ obligatoire",U=l=>!isNaN(l)&&Number(l)>=0||"Entier positif requis",$=l=>/^(https?:\/\/)[^\s$.?#].[^\s]*$/.test(l)||"Lien invalide (ex: https://...)",B=l=>!!l||"Date requise",N=async()=>{try{const l=await g("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/skill");if(!l.ok)throw new Error("Erreur récupération des skills");const n=await l.json();b.value=n.data.map(d=>d.name)}catch(l){console.error("Erreur skills :",l)}},L=async()=>{try{const l=await g("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/keyword");if(!l.ok)throw new Error("Erreur récupération des keywords");const n=await l.json();C.value=n.data.map(d=>d.name)}catch(l){console.error("Erreur keywords :",l)}},j=()=>{if(!e.value.CV||e.value.CV.trim()===""){s.value="";return}s.value=e.value.CV},z=()=>{e.value.CV===i&&(e.value.CV="")},A=()=>{e.value.CV||(e.value.CV=i)};J(()=>e.value.CV,j),F(()=>{const l=sessionStorage.getItem("selectedConsultantUuid");l?e.value.consultantUuid=l:console.error("Aucun consultant sélectionné"),N(),L()});const y=t(!1),w=t(null),k=t(!1);return{profile:e,experienceLevels:v,availableSkills:b,availableKeywords:C,formRef:c,required:T,numberRule:U,urlRule:$,dateRule:B,placeholderCV:i,validCV:s,clearPlaceholder:z,restorePlaceholder:A,submitProfile:async()=>{y.value=!0,w.value=null,k.value=!1;try{if((!e.value.CV||e.value.CV.trim()==="")&&(e.value.CV=i),!c.value)return;const{valid:l}=await c.value.validate();if(!l)return;const n=await g("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/profil",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.value)}),d=await n.json();if(!n.ok)throw new Error(d.message);k.value=d.message,setTimeout(()=>{r.push("/consultant/consultant-info")},1e3)}catch(l){w.value=l instanceof Error?l.message:"Une erreur est survenue"}finally{y.value=!1}},loading:y,error:w,success:k}}});function Z(e,r,v,b,C,c){const i=R;return m(),f(H,null,{default:a(()=>[o(G,{class:"pa-4"},{default:a(()=>[o(i,{class:"mb-4"}),o(O,{class:"text-h5 font-weight-bold"},{default:a(()=>r[7]||(r[7]=[p("Nouveau Profil")])),_:1}),o(I,null,{default:a(()=>[o(Q,{ref:"formRef"},{default:a(()=>[o(X,null,{default:a(()=>[o(u,{cols:"12"},{default:a(()=>[o(V,{label:"Lien du CV *",modelValue:e.profile.CV,"onUpdate:modelValue":r[0]||(r[0]=s=>e.profile.CV=s),variant:"outlined",color:"primary",placeholder:e.placeholderCV,rules:[e.required,e.urlRule],onFocus:e.clearPlaceholder,onBlur:e.restorePlaceholder,required:""},null,8,["modelValue","placeholder","rules","onFocus","onBlur"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(V,{label:"Job Title *",modelValue:e.profile.JobTitle,"onUpdate:modelValue":r[1]||(r[1]=s=>e.profile.JobTitle=s),rules:[e.required],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(q,{label:"Niveau d'expérience *",modelValue:e.profile.ExperienceLevel,"onUpdate:modelValue":r[2]||(r[2]=s=>e.profile.ExperienceLevel=s),items:e.experienceLevels,rules:[e.required],variant:"outlined",color:"primary",required:""},null,8,["modelValue","items","rules"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(V,{label:"Tarif / heure *",modelValue:e.profile.RateHour,"onUpdate:modelValue":r[3]||(r[3]=s=>e.profile.RateHour=s),modelModifiers:{number:!0},type:"number",rules:[e.required,e.numberRule],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(V,{label:"Date du CV *",modelValue:e.profile.CVDate,"onUpdate:modelValue":r[4]||(r[4]=s=>e.profile.CVDate=s),type:"date",rules:[e.required,e.dateRule],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(u,{cols:"12"},{default:a(()=>[o(q,{label:"Compétences *",modelValue:e.profile.Skills,"onUpdate:modelValue":r[5]||(r[5]=s=>e.profile.Skills=s),items:e.availableSkills,multiple:"",chips:"","closable-chips":"",rules:[e.required],variant:"outlined",color:"primary"},null,8,["modelValue","items","rules"])]),_:1}),o(u,{cols:"12"},{default:a(()=>[o(q,{label:"Mots-clés *",modelValue:e.profile.keywords,"onUpdate:modelValue":r[6]||(r[6]=s=>e.profile.keywords=s),items:e.availableKeywords,multiple:"",chips:"","closable-chips":"",rules:[e.required],variant:"outlined",color:"primary"},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e.loading?(m(),f(E,{key:0,type:"info",class:"mt-4"},{default:a(()=>r[8]||(r[8]=[p("Chargement en cours...")])),_:1})):h("",!0),e.error?(m(),f(E,{key:1,type:"error",class:"mt-4"},{default:a(()=>[p(P(e.error),1)]),_:1})):h("",!0),e.success?(m(),f(E,{key:2,type:"success",class:"mt-4"},{default:a(()=>[p(P(e.success),1)]),_:1})):h("",!0),o(W,{class:"d-flex justify-end"},{default:a(()=>[o(M,{color:"primary",onClick:e.submitProfile},{default:a(()=>r[9]||(r[9]=[p("Publier")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}const x=K(Y,[["render",Z]]),de=S({__name:"add-profile",setup(e){return(r,v)=>(m(),f(x))}});export{de as default};
