import{_ as $,V as R}from"./VAutocomplete-vBOt-nic.js";import{d as j,r as t,ab as F,P as J,o as K,_ as H,a as p,c as m,w as a,e as d,t as E,f as V,g as o,j as G,V as O}from"./index-D-Inbi5U.js";import{f as T}from"./fetchWithApiKey-puCv6LHg.js";import{V as b}from"./VAlert-BJkg2Izn.js";import{V as I,a as W,b as Q,c as X}from"./VCard-D2J_XjvE.js";import{V as Y}from"./VForm-O3Sno3Kz.js";import{a as Z,V as u}from"./VRow-CxmJ-ldm.js";import{V as y}from"./VTextField-Xr4deW5K.js";import{a as x}from"./filter-D2Osl6aZ.js";import"./VChip-CevWF3Km.js";const _=j({name:"EditProfile",components:{GoBackBtn:$},setup(){const e=localStorage.getItem("selectedProfile"),l=t(e?JSON.parse(e):{profileUuid:"",rateHour:null,cv:"",cvDate:"",jobTitle:"",experienceLevel:"",skills:[],keywords:[]}),w=F(),c=["Junior","Medior","Senior"],k=t([]),g=t([]),f=t(null),s=t(null),v="https://example.com/default-cv",h=t(""),B=r=>!!r||"Champ obligatoire",N=r=>!isNaN(r)&&Number(r)>=0||"Entier positif requis",S=r=>/^(https?:\/\/)[^\s$.?#].[^\s]*$/.test(r)||"Lien invalide (ex: https://...)",M=r=>!!r||"Date requise",U=()=>{if(!l.value.cv||l.value.cv.trim()===""){h.value="";return}h.value=l.value.cv},L=()=>{l.value.cv===v&&(l.value.cv="")},z=()=>{l.value.cv||(l.value.cv=v)};J(()=>l.value.cv,U);const D=async()=>{try{const r=await T("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/skill",{});if(!r.ok)throw new Error("Erreur récupération des skills");const i=await r.json();k.value=i.data.map(n=>n.name)}catch(r){console.error("Erreur skills :",r)}},A=async()=>{try{const r=await T("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/keyword",{});if(!r.ok)throw new Error("Erreur récupération des keywords");const i=await r.json();g.value=i.data.map(n=>n.name)}catch(r){console.error("Erreur keywords :",r)}};K(()=>{D(),A(),U()});const C=t(!1),q=t(null),P=t(!1);return{profile:l,experienceLevels:c,availableSkills:k,availableKeywords:g,formRef:f,required:B,numberRule:N,urlRule:S,dateRule:M,placeholderCV:v,validCV:h,clearPlaceholder:L,restorePlaceholder:z,submitProfile:async()=>{C.value=!0,q.value=null,P.value=!1;try{if((!l.value.cv||l.value.cv.trim()==="")&&(l.value.cv=v),!f.value)return;const{valid:r}=await f.value.validate();if(!r)return;const i=await T("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/profil",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l.value)}),n=await i.json();if(!i.ok)throw new Error(n.message);P.value=n.message,setTimeout(()=>{w.push("/consultant/consultant-info")},1e3)}catch(r){q.value=r instanceof Error?r.message:"Une erreur est survenue"}finally{C.value=!1}},errorMessage:s,loading:C,error:q,success:P}}});function ee(e,l,w,c,k,g){const f=$;return p(),m(O,null,{default:a(()=>[e.errorMessage?(p(),m(b,{key:0,closable:"",type:"error",variant:"outlined",class:"mb-4"},{default:a(()=>[d(E(e.errorMessage),1)]),_:1})):V("",!0),o(I,{class:"pa-4"},{default:a(()=>[o(f,{class:"mb-4"}),o(W,{class:"text-h5 font-weight-bold"},{default:a(()=>l[7]||(l[7]=[d("Modifier le Profil")])),_:1}),o(Q,null,{default:a(()=>[o(Y,{ref:"formRef"},{default:a(()=>[o(Z,null,{default:a(()=>[o(u,{cols:"12"},{default:a(()=>[o(y,{label:"CV URL *",modelValue:e.profile.cv,"onUpdate:modelValue":l[0]||(l[0]=s=>e.profile.cv=s),variant:"outlined",color:"primary",placeholder:e.placeholderCV,rules:[e.required,e.urlRule],onFocus:e.clearPlaceholder,onBlur:e.restorePlaceholder,required:""},null,8,["modelValue","placeholder","rules","onFocus","onBlur"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(y,{label:"Job Title *",modelValue:e.profile.jobTitle,"onUpdate:modelValue":l[1]||(l[1]=s=>e.profile.jobTitle=s),rules:[e.required],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(x,{label:"Niveau d'expérience *",modelValue:e.profile.experienceLevel,"onUpdate:modelValue":l[2]||(l[2]=s=>e.profile.experienceLevel=s),items:e.experienceLevels,rules:[e.required],variant:"outlined",color:"primary",required:""},null,8,["modelValue","items","rules"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(y,{label:"Tarif / heure *",modelValue:e.profile.rateHour,"onUpdate:modelValue":l[3]||(l[3]=s=>e.profile.rateHour=s),modelModifiers:{number:!0},type:"number",rules:[e.required,e.numberRule],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(y,{label:"Date du CV *",modelValue:e.profile.cvDate,"onUpdate:modelValue":l[4]||(l[4]=s=>e.profile.cvDate=s),type:"date",rules:[e.required,e.dateRule],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(u,{cols:"12"},{default:a(()=>[o(R,{label:"Compétences *",modelValue:e.profile.skills,"onUpdate:modelValue":l[5]||(l[5]=s=>e.profile.skills=s),items:e.availableSkills,multiple:"",chips:"","closable-chips":"",rules:[e.required],variant:"outlined",color:"primary"},null,8,["modelValue","items","rules"])]),_:1}),o(u,{cols:"12"},{default:a(()=>[o(R,{label:"Mots-clés *",modelValue:e.profile.keywords,"onUpdate:modelValue":l[6]||(l[6]=s=>e.profile.keywords=s),items:e.availableKeywords,multiple:"",chips:"","closable-chips":"",rules:[e.required],variant:"outlined",color:"primary"},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e.loading?(p(),m(b,{key:0,type:"info",class:"mt-4"},{default:a(()=>l[8]||(l[8]=[d("Chargement en cours...")])),_:1})):V("",!0),e.error?(p(),m(b,{key:1,type:"error",class:"mt-4"},{default:a(()=>[d(E(e.error),1)]),_:1})):V("",!0),e.success?(p(),m(b,{key:2,type:"success",class:"mt-4"},{default:a(()=>[d(E(e.success),1)]),_:1})):V("",!0),o(X,{class:"d-flex justify-end"},{default:a(()=>[o(G,{color:"primary",onClick:e.submitProfile},{default:a(()=>l[9]||(l[9]=[d("Publier")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}const le=H(_,[["render",ee]]),fe=j({__name:"edit-profile",setup(e){return(l,w)=>{const c=le;return p(),m(c)}}});export{fe as default};
