import{f as N}from"./fetchWithApiKey-puCv6LHg.js";import{s as H,u as X,x as Y,U as Z,ag as ee,z,A as te,ah as ae,g as o,B as G,d as q,ab as se,r as f,o as le,a as c,c as T,w as l,b as g,e as n,j as M,k as y,aQ as oe,t as m,f as U,h as k,m as I,F as J,V as ne,p as K,aR as re,_ as ie}from"./index-D-Inbi5U.js";import{V as $}from"./VAlert-BJkg2Izn.js";import{m as ue,u as ce,a as O,V as de}from"./VTextField-Xr4deW5K.js";import{V as me,a as fe,b as pe}from"./VCard-D2J_XjvE.js";import{V as be}from"./VSpacer-DMfKlYC9.js";import{V as Q}from"./VChip-CevWF3Km.js";import{V as he}from"./VDataTable-BOCEZ4ei.js";import{h as ve,g as W,a as ge}from"./filter-D2Osl6aZ.js";import{V as Ve}from"./VTextarea-GILDFczO.js";const xe=H({...ue(),...X(ve(),["inline"])},"VCheckbox"),ye=Y()({name:"VCheckbox",inheritAttrs:!1,props:xe(),emits:{"update:modelValue":u=>!0,"update:focused":u=>!0},setup(u,v){let{attrs:p,slots:b}=v;const i=Z(u,"modelValue"),{isFocused:C,focus:_,blur:w}=ce(u),A=ee(),R=z(()=>u.id||`checkbox-${A}`);return te(()=>{const[E,h]=ae(p),B=O.filterProps(u),V=W.filterProps(u);return o(O,G({class:["v-checkbox",u.class]},E,B,{modelValue:i.value,"onUpdate:modelValue":x=>i.value=x,id:R.value,focused:C.value,style:u.style}),{...b,default:x=>{let{id:P,messagesId:S,isDisabled:D,isReadonly:a,isValid:e}=x;return o(W,G(V,{id:P.value,"aria-describedby":S.value,disabled:D.value,readonly:a.value},h,{error:e.value===!1,modelValue:i.value,"onUpdate:modelValue":s=>i.value=s,onFocus:_,onBlur:w}),b)}})}),{}}}),ke={class:"d-flex align-center mb-4"},Te={class:"text-h5"},Ce={class:"text-subtitle-1 mb-2"},_e=["href"],we={key:0},je=q({__name:"TableMatching",setup(u){se();const v=f([]),p=f(null),b=f(""),i=f([]),C=f(!1),_=f(""),w=f("success"),A=f([{key:"edit",title:"",align:"center"},{key:"rfpReference",title:"Référence RFP",align:"start"},{key:"score",title:"Score",align:"end"},{key:"publicationDate",title:"Date de publication",align:"start"},{key:"statutMatching",title:"Statut",align:"start"},{key:"comment",title:"Commentaire",align:"start"}]),R=async()=>{try{const a=await N("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matching");if(!a.ok)throw new Error("Erreur, impossible de récupérer les matchings");const e=await a.json();v.value=(Array.isArray(e.data)?e.data:[e.data]).map(s=>({...s,editable:!1})),i.value=h.value.map(s=>s.name)}catch(a){p.value=a instanceof Error?a.message:"Erreur, impossible de récupérer les matchings"}},E=a=>new Date(a).toLocaleDateString("fr-FR"),h=z(()=>{const a={};return v.value.forEach(e=>{const s=`${e.consultantSurname}_${e.consultantName}`,r=`${e.consultantSurname} ${e.consultantName}`;a[s]||(a[s]={name:s,fullName:r,jobTitleGroups:[]});let t=a[s].jobTitleGroups.find(d=>d.jobTitle===e.jobTitle);t||(t={jobTitle:e.jobTitle,matchings:[]},a[s].jobTitleGroups.push(t)),t.matchings.push(e)}),Object.values(a)}),B=z(()=>{if(!b.value)return h.value;const a=b.value.toLowerCase();return h.value.map(e=>{const s=e.fullName.toLowerCase().includes(a),r=e.jobTitleGroups.map(t=>{const d=t.jobTitle.toLowerCase().includes(a),F=t.matchings.filter(j=>{var L;return j.jobTitle.toLowerCase().includes(a)||j.rfpReference.toLowerCase().includes(a)||((L=j.comment)==null?void 0:L.toLowerCase().includes(a))||j.score.toString().includes(a)});return s||d?{jobTitle:t.jobTitle,matchings:t.matchings}:F.length>0?{jobTitle:t.jobTitle,matchings:F}:null}).filter(Boolean);return s||r.length>0?{...e,jobTitleGroups:r}:null}).filter(Boolean)}),V=a=>i.value.includes(a),x=a=>{V(a)?i.value=i.value.filter(e=>e!==a):i.value.push(a)},P=()=>i.value=h.value.map(a=>a.name),S=()=>i.value=[],D=async a=>{for(let e of a)if(e.editable)try{if((await N(`https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matching/${e.matchingUuid}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({statutMatching:e.statutMatching,comment:e.comment,score:e.score,profileUuid:e.profileUuid,rfpUuid:e.rfpUuid})})).ok)e.editable=!1,_.value="Modifications sauvegardées avec succès!",w.value="success",C.value=!0;else throw new Error("Erreur de sauvegarde")}catch(s){console.error("Erreur de sauvegarde :",s),_.value="Échec de la sauvegarde.",w.value="error",C.value=!0}};return z(()=>h.value.some(a=>a.jobTitleGroups.some(e=>e.matchings.some(s=>s.editable)))),le(R),(a,e)=>(c(),T(ne,null,{default:l(()=>[e[11]||(e[11]=g("h1",{class:"text-center mb-6"},"Liste des Matchings",-1)),o($,{type:"info",variant:"outlined",class:"mb-4 d-flex align-center"},{default:l(()=>[e[2]||(e[2]=n(" Vous devez être connecté pour accéder aux liens RFP sur le site Connecting-Expertise. ")),o(M,{color:"info",variant:"outlined",href:"https://customer.connecting-expertise.com/",target:"_blank",rel:"noopener noreferrer",size:"small"},{default:l(()=>e[1]||(e[1]=[n(" Se connecter ")])),_:1})]),_:1}),g("div",ke,[o(de,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=s=>b.value=s),label:"Rechercher un matching","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":"",class:"flex-grow-1"},null,8,["modelValue"]),o(oe,{class:"ml-4"},{default:l(()=>[o(M,{onClick:P,size:"small",variant:"outlined"},{default:l(()=>[o(y,null,{default:l(()=>e[3]||(e[3]=[n("mdi-unfold-more-horizontal")])),_:1}),e[4]||(e[4]=n(" Tout développer "))]),_:1}),o(M,{onClick:S,size:"small",variant:"outlined"},{default:l(()=>[o(y,null,{default:l(()=>e[5]||(e[5]=[n("mdi-unfold-less-horizontal")])),_:1}),e[6]||(e[6]=n(" Tout réduire "))]),_:1})]),_:1})]),p.value?(c(),T($,{key:0,type:"error",variant:"outlined",class:"mb-4"},{default:l(()=>[n(m(p.value),1)]),_:1})):U("",!0),!v.value.length&&!p.value?(c(),T($,{key:1,type:"info",class:"mt-4"},{default:l(()=>e[7]||(e[7]=[n(" Aucun matching disponible. ")])),_:1})):U("",!0),(c(!0),k(J,null,I(B.value,s=>(c(),k("div",{key:s.name,class:"mb-6"},[o(me,null,{default:l(()=>[o(fe,{class:K(["consultant-header d-flex align-center",{"cursor-pointer":!0}]),onClick:r=>x(s.name)},{default:l(()=>[o(y,{size:"large",class:"mr-2"},{default:l(()=>e[8]||(e[8]=[n("mdi-account")])),_:1}),g("span",Te,m(s.fullName),1),o(be),o(Q,{class:"ml-2 mr-2",color:"primary"},{default:l(()=>[n(m(s.jobTitleGroups.reduce((r,t)=>r+t.matchings.length,0))+" matching"+m(s.jobTitleGroups.reduce((r,t)=>r+t.matchings.length,0)>1?"s":""),1)]),_:2},1024),o(y,null,{default:l(()=>[n(m(V(s.name)?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:2},1024)]),_:2},1032,["onClick"]),o(re,null,{default:l(()=>[V(s.name)?(c(),T(pe,{key:0},{default:l(()=>[(c(!0),k(J,null,I(s.jobTitleGroups,r=>(c(),k("div",{key:r.jobTitle,class:"mb-4"},[g("h3",Ce,[o(y,{class:"mr-1"},{default:l(()=>e[9]||(e[9]=[n("mdi-briefcase")])),_:1}),n(" "+m(r.jobTitle),1)]),o(he,{headers:A.value,items:r.matchings,class:"elevation-1 mb-4",density:"compact"},{"item.rfpReference":l(({item:t})=>[g("div",null,[g("a",{href:t.rfpUrl,target:"_blank",rel:"noopener noreferrer",style:{color:"#1976d2","text-decoration":"underline"}},m(t.rfpReference),9,_e)])]),"item.edit":l(({item:t})=>[o(ye,{modelValue:t.editable,"onUpdate:modelValue":d=>t.editable=d,"hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),"item.publicationDate":l(({item:t})=>[n(m(E(t.publicationDate)),1)]),"item.score":l(({item:t})=>[o(Q,{color:t.score>=30?"success":t.score>=10?"warning":"error",class:K(t.score>=30?"text-white":""),size:"small"},{default:l(()=>[n(m(t.score),1)]),_:2},1032,["color","class"])]),"item.comment":l(({item:t})=>[o(Ve,{modelValue:t.comment,"onUpdate:modelValue":d=>t.comment=d,disabled:!t.editable,density:"compact",variant:"outlined","hide-details":"",rows:"2",style:{width:"300px","text-align":"right"},class:"comment-textarea"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.statutMatching":l(({item:t})=>[o(ge,{modelValue:t.statutMatching,"onUpdate:modelValue":d=>t.statutMatching=d,items:["Apply","NotApply","Rejected"],disabled:!t.editable,variant:"outlined",density:"compact","hide-details":"",style:{"max-width":"150px"}},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["headers","items"]),r.matchings.some(t=>t.editable)?(c(),k("div",we,[o(M,{size:"small",color:"primary",onClick:t=>D(r.matchings)},{default:l(()=>e[10]||(e[10]=[n(" Sauvegarder ")])),_:2},1032,["onClick"])])):U("",!0)]))),128))]),_:2},1024)):U("",!0)]),_:2},1024)]),_:2},1024)]))),128))]),_:1}))}}),Me=ie(je,[["__scopeId","data-v-02eb229e"]]),Fe=q({__name:"table-matching",setup(u){return(v,p)=>(c(),T(Me))}});export{Fe as default};
