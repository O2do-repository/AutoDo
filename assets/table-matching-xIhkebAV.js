import{f as oe}from"./fetchWithApiKey-2Sqdi0TE.js";import{s as de,u as Ce,x as fe,U as me,ag as Te,z as S,A as ve,ah as he,g as n,B as H,aQ as _e,r as v,O as Pe,aF as Fe,o as ge,P as N,ao as Re,F as O,R as se,S as Se,aR as Me,C as Ue,a3 as Z,aS as ze,a2 as je,aT as Ae,d as be,ab as Be,a as w,c as L,w as s,b as A,e as c,j as Q,k as G,aU as Ee,t as T,f as W,h as $,m as re,V as Ie,p as ie,aV as De,_ as Ne}from"./index-DKQHIKDd.js";import{V as ee}from"./VAlert-Me34cAkj.js";import{m as xe,u as pe,a as q,f as Ge,g as $e,h as Le,i as He,V as Oe}from"./VTextField-F5ZQcyGe.js";import{V as Je,a as Ke,b as Qe}from"./VCard-CTYg1aj2.js";import{V as We}from"./VSpacer-BwdY6qFT.js";import{V as ue}from"./VChip-D85Efj63.js";import{V as qe}from"./VDataTable-DuoMR8nP.js";import{h as Xe,g as ce,a as Ye}from"./filter-pln37DSh.js";const Ze=de({...xe(),...Ce(Xe(),["inline"])},"VCheckbox"),et=fe()({name:"VCheckbox",inheritAttrs:!1,props:Ze(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,_){let{attrs:h,slots:p}=_;const i=me(e,"modelValue"),{isFocused:d,focus:V,blur:U}=pe(e),B=Te(),E=S(()=>e.id||`checkbox-${B}`);return ve(()=>{const[I,k]=he(h),z=q.filterProps(e),y=ce.filterProps(e);return n(q,H({class:["v-checkbox",e.class]},I,z,{modelValue:i.value,"onUpdate:modelValue":P=>i.value=P,id:E.value,focused:d.value,style:e.style}),{...p,default:P=>{let{id:F,messagesId:D,isDisabled:M,isReadonly:l,isValid:t}=P;return n(ce,H(y,{id:F.value,"aria-describedby":D.value,disabled:M.value,readonly:l.value},k,{error:t.value===!1,modelValue:i.value,"onUpdate:modelValue":o=>i.value=o,onFocus:V,onBlur:U}),p)}})}),{}}}),tt=de({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...xe(),...Ge()},"VTextarea"),at=fe()({name:"VTextarea",directives:{Intersect:_e},inheritAttrs:!1,props:tt(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,_){let{attrs:h,emit:p,slots:i}=_;const d=me(e,"modelValue"),{isFocused:V,focus:U,blur:B}=pe(e),E=S(()=>typeof e.counterValue=="function"?e.counterValue(d.value):(d.value||"").toString().length),I=S(()=>{if(h.maxlength)return h.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function k(r,x){var m,C;!e.autofocus||!r||(C=(m=x[0].target)==null?void 0:m.focus)==null||C.call(m)}const z=v(),y=v(),P=Pe(""),F=v(),D=S(()=>e.persistentPlaceholder||V.value||e.active);function M(){var r;F.value!==document.activeElement&&((r=F.value)==null||r.focus()),V.value||U()}function l(r){M(),p("click:control",r)}function t(r){p("mousedown:control",r)}function o(r){r.stopPropagation(),M(),Z(()=>{d.value="",ze(e["onClick:clear"],r)})}function u(r){var m;const x=r.target;if(d.value=x.value,(m=e.modelModifiers)!=null&&m.trim){const C=[x.selectionStart,x.selectionEnd];Z(()=>{x.selectionStart=C[0],x.selectionEnd=C[1]})}}const a=v(),f=v(+e.rows),j=S(()=>["plain","underlined"].includes(e.variant));Fe(()=>{e.autoGrow||(f.value=+e.rows)});function g(){e.autoGrow&&Z(()=>{if(!a.value||!y.value)return;const r=getComputedStyle(a.value),x=getComputedStyle(y.value.$el),m=parseFloat(r.getPropertyValue("--v-field-padding-top"))+parseFloat(r.getPropertyValue("--v-input-padding-top"))+parseFloat(r.getPropertyValue("--v-field-padding-bottom")),C=a.value.scrollHeight,J=parseFloat(r.lineHeight),X=Math.max(parseFloat(e.rows)*J+m,parseFloat(x.getPropertyValue("--v-input-control-height"))),Y=parseFloat(e.maxRows)*J+m||1/0,R=Ae(C??0,X,Y);f.value=Math.floor((R-m)/J),P.value=je(R)})}ge(g),N(d,g),N(()=>e.rows,g),N(()=>e.maxRows,g),N(()=>e.density,g);let b;return N(a,r=>{r?(b=new ResizeObserver(g),b.observe(a.value)):b==null||b.disconnect()}),Re(()=>{b==null||b.disconnect()}),ve(()=>{const r=!!(i.counter||e.counter||e.counterValue),x=!!(r||i.details),[m,C]=he(h),{modelValue:J,...X}=q.filterProps(e),Y=$e(e);return n(q,H({ref:z,modelValue:d.value,"onUpdate:modelValue":R=>d.value=R,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":j.value},e.class],style:e.style},m,X,{centerAffix:f.value===1&&!j.value,focused:V.value}),{...i,default:R=>{let{id:K,isDisabled:te,isDirty:ae,isReadonly:Ve,isValid:ye}=R;return n(Le,H({ref:y,style:{"--v-textarea-control-height":P.value},onClick:l,onMousedown:t,"onClick:clear":o,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},Y,{id:K.value,active:D.value||ae.value,centerAffix:f.value===1&&!j.value,dirty:ae.value||e.dirty,disabled:te.value,focused:V.value,error:ye.value===!1}),{...i,default:we=>{let{props:{class:le,...ne}}=we;return n(O,null,[e.prefix&&n("span",{class:"v-text-field__prefix"},[e.prefix]),se(n("textarea",H({ref:F,class:le,value:d.value,onInput:u,autofocus:e.autofocus,readonly:Ve.value,disabled:te.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:M,onBlur:B},ne,C),null),[[Se("intersect"),{handler:k},null,{once:!0}]]),e.autoGrow&&se(n("textarea",{class:[le,"v-textarea__sizer"],id:`${ne.id}-sizer`,"onUpdate:modelValue":ke=>d.value=ke,ref:a,readonly:!0,"aria-hidden":"true"},null),[[Me,d.value]]),e.suffix&&n("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:x?R=>{var K;return n(O,null,[(K=i.details)==null?void 0:K.call(i,R),r&&n(O,null,[n("span",null,null),n(He,{active:e.persistentCounter||V.value,value:E.value,max:I.value,disabled:e.disabled},i.counter)])])}:void 0})}),Ue({},z,y,F)}}),lt={class:"d-flex align-center mb-4"},nt={class:"text-h5"},ot={class:"text-subtitle-1 mb-2"},st=["href"],rt={key:0},it=be({__name:"TableMatching",setup(e){Be();const _=v([]),h=v(null),p=v(""),i=v([]),d=v(!1),V=v(""),U=v("success"),B=v([{key:"edit",title:"",align:"center"},{key:"rfpReference",title:"Référence RFP",align:"start"},{key:"score",title:"Score",align:"end"},{key:"publicationDate",title:"Date de publication",align:"start"},{key:"statutMatching",title:"Statut",align:"start"},{key:"comment",title:"Commentaire",align:"start"}]),E=async()=>{try{const l=await oe("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matching");if(!l.ok)throw new Error("Erreur, impossible de récupérer les matchings");const t=await l.json();_.value=(Array.isArray(t.data)?t.data:[t.data]).map(o=>({...o,editable:!1})),i.value=k.value.map(o=>o.name)}catch(l){h.value=l instanceof Error?l.message:"Erreur, impossible de récupérer les matchings"}},I=l=>new Date(l).toLocaleDateString("fr-FR"),k=S(()=>{const l={};return _.value.forEach(t=>{const o=`${t.consultantSurname}_${t.consultantName}`,u=`${t.consultantSurname} ${t.consultantName}`;l[o]||(l[o]={name:o,fullName:u,jobTitleGroups:[]});let a=l[o].jobTitleGroups.find(f=>f.jobTitle===t.jobTitle);a||(a={jobTitle:t.jobTitle,matchings:[]},l[o].jobTitleGroups.push(a)),a.matchings.push(t)}),Object.values(l)}),z=S(()=>{if(!p.value)return k.value;const l=p.value.toLowerCase();return k.value.map(t=>{const o=t.fullName.toLowerCase().includes(l),u=t.jobTitleGroups.map(a=>{const f=a.jobTitle.toLowerCase().includes(l),j=a.matchings.filter(g=>{var b;return g.jobTitle.toLowerCase().includes(l)||g.rfpReference.toLowerCase().includes(l)||((b=g.comment)==null?void 0:b.toLowerCase().includes(l))||g.score.toString().includes(l)});return f?{jobTitle:a.jobTitle,matchings:a.matchings}:j.length>0?{jobTitle:a.jobTitle,matchings:j}:null}).filter(Boolean);return o||u.length>0?{...t,jobTitleGroups:u}:null}).filter(Boolean)}),y=l=>i.value.includes(l),P=l=>{y(l)?i.value=i.value.filter(t=>t!==l):i.value.push(l)},F=()=>i.value=k.value.map(l=>l.name),D=()=>i.value=[],M=async l=>{for(let t of l)if(t.editable)try{if((await oe(`https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matching/${t.matchingUuid}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({statutMatching:t.statutMatching,comment:t.comment,score:t.score,profileUuid:t.profileUuid,rfpUuid:t.rfpUuid})})).ok)t.editable=!1,V.value="Modifications sauvegardées avec succès!",U.value="success",d.value=!0;else throw new Error("Erreur de sauvegarde")}catch(o){console.error("Erreur de sauvegarde :",o),V.value="Échec de la sauvegarde.",U.value="error",d.value=!0}};return S(()=>k.value.some(l=>l.jobTitleGroups.some(t=>t.matchings.some(o=>o.editable)))),ge(E),(l,t)=>(w(),L(Ie,null,{default:s(()=>[t[11]||(t[11]=A("h1",{class:"text-center mb-6"},"Liste des Matchings",-1)),n(ee,{type:"info",variant:"outlined",class:"mb-4 d-flex align-center"},{default:s(()=>[t[2]||(t[2]=c(" Vous devez être connecté pour accéder aux liens RFP sur le site Connecting-Expertise. ")),n(Q,{color:"info",variant:"outlined",href:"https://customer.connecting-expertise.com/",target:"_blank",rel:"noopener noreferrer",size:"small"},{default:s(()=>t[1]||(t[1]=[c(" Se connecter ")])),_:1})]),_:1}),A("div",lt,[n(Oe,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=o=>p.value=o),label:"Rechercher un matching","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":"",class:"flex-grow-1"},null,8,["modelValue"]),n(Ee,{class:"ml-4"},{default:s(()=>[n(Q,{onClick:F,size:"small",variant:"outlined"},{default:s(()=>[n(G,null,{default:s(()=>t[3]||(t[3]=[c("mdi-unfold-more-horizontal")])),_:1}),t[4]||(t[4]=c(" Tout développer "))]),_:1}),n(Q,{onClick:D,size:"small",variant:"outlined"},{default:s(()=>[n(G,null,{default:s(()=>t[5]||(t[5]=[c("mdi-unfold-less-horizontal")])),_:1}),t[6]||(t[6]=c(" Tout réduire "))]),_:1})]),_:1})]),h.value?(w(),L(ee,{key:0,type:"error",variant:"outlined",class:"mb-4"},{default:s(()=>[c(T(h.value),1)]),_:1})):W("",!0),!_.value.length&&!h.value?(w(),L(ee,{key:1,type:"info",class:"mt-4"},{default:s(()=>t[7]||(t[7]=[c(" Aucun matching disponible. ")])),_:1})):W("",!0),(w(!0),$(O,null,re(z.value,o=>(w(),$("div",{key:o.name,class:"mb-6"},[n(Je,null,{default:s(()=>[n(Ke,{class:ie(["consultant-header d-flex align-center",{"cursor-pointer":!0}]),onClick:u=>P(o.name)},{default:s(()=>[n(G,{size:"large",class:"mr-2"},{default:s(()=>t[8]||(t[8]=[c("mdi-account")])),_:1}),A("span",nt,T(o.fullName),1),n(We),n(ue,{class:"ml-2 mr-2",color:"primary"},{default:s(()=>[c(T(o.jobTitleGroups.reduce((u,a)=>u+a.matchings.length,0))+" matching"+T(o.jobTitleGroups.reduce((u,a)=>u+a.matchings.length,0)>1?"s":""),1)]),_:2},1024),n(G,null,{default:s(()=>[c(T(y(o.name)?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:2},1024)]),_:2},1032,["onClick"]),n(De,null,{default:s(()=>[y(o.name)?(w(),L(Qe,{key:0},{default:s(()=>[(w(!0),$(O,null,re(o.jobTitleGroups,u=>(w(),$("div",{key:u.jobTitle,class:"mb-4"},[A("h3",ot,[n(G,{class:"mr-1"},{default:s(()=>t[9]||(t[9]=[c("mdi-briefcase")])),_:1}),c(" "+T(u.jobTitle),1)]),n(qe,{headers:B.value,items:u.matchings,class:"elevation-1 mb-4",density:"compact"},{"item.rfpReference":s(({item:a})=>[A("div",null,[A("a",{href:a.rfpUrl,target:"_blank",rel:"noopener noreferrer",style:{color:"#1976d2","text-decoration":"underline"}},T(a.rfpReference),9,st)])]),"item.edit":s(({item:a})=>[n(et,{modelValue:a.editable,"onUpdate:modelValue":f=>a.editable=f,"hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),"item.publicationDate":s(({item:a})=>[c(T(I(a.publicationDate)),1)]),"item.score":s(({item:a})=>[n(ue,{color:a.score>=30?"success":a.score>=10?"warning":"error",class:ie(a.score>=30?"text-white":""),size:"small"},{default:s(()=>[c(T(a.score),1)]),_:2},1032,["color","class"])]),"item.comment":s(({item:a})=>[n(at,{modelValue:a.comment,"onUpdate:modelValue":f=>a.comment=f,disabled:!a.editable,density:"compact",variant:"outlined","hide-details":"",rows:"2",style:{width:"300px","text-align":"right"},class:"comment-textarea"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.statutMatching":s(({item:a})=>[n(Ye,{modelValue:a.statutMatching,"onUpdate:modelValue":f=>a.statutMatching=f,items:["Apply","NotApply","Rejected"],disabled:!a.editable,variant:"outlined",density:"compact","hide-details":"",style:{"max-width":"150px"}},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["headers","items"]),u.matchings.some(a=>a.editable)?(w(),$("div",rt,[n(Q,{size:"small",color:"primary",onClick:a=>M(u.matchings)},{default:s(()=>t[10]||(t[10]=[c(" Sauvegarder ")])),_:2},1032,["onClick"])])):W("",!0)]))),128))]),_:2},1024)):W("",!0)]),_:2},1024)]),_:2},1024)]))),128))]),_:1}))}}),ut=Ne(it,[["__scopeId","data-v-54b9490b"]]),pt=be({__name:"table-matching",setup(e){return(_,h)=>(w(),L(ut))}});export{pt as default};
