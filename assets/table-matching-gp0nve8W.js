import{f as N}from"./fetchWithApiKey-Dhr0x7qW.js";import{s as te,u as ae,x as le,U as se,ag as oe,z as S,A as ne,ah as re,g as s,B as J,d as I,r as v,o as X,a as p,h as _,w as a,e as r,k as x,j as M,c as w,az as ie,t as c,b as d,aO as ue,F as G,ab as ce,aP as de,f as F,m as O,V as me,p as K,aQ as fe,_ as pe}from"./index-TfyZybqF.js";import{V as Y,a as Z,b as ee}from"./VCard-CW5AKRBD.js";import{V as E}from"./VAlert-DfilHtj9.js";import{V as be,a as ve}from"./VDialog-BsGjBcsX.js";import{m as ge,u as he,a as Q,V as ke}from"./VTextField-DSaDmo40.js";import{V as W}from"./VChip-5miARexB.js";import{V as Ve}from"./VDataTable-BxsO81Zc.js";import{h as ye,g as q,a as xe}from"./filter-Da_0XYna.js";import{V as _e}from"./VTextarea-B3Gt7eMX.js";const we=te({...ge(),...ae(ye(),["inline"])},"VCheckbox"),Te=le()({name:"VCheckbox",inheritAttrs:!1,props:we(),emits:{"update:modelValue":b=>!0,"update:focused":b=>!0},setup(b,V){let{attrs:i,slots:g}=V;const m=se(b,"modelValue"),{isFocused:k,focus:j,blur:h}=he(b),o=oe(),T=S(()=>b.id||`checkbox-${o}`);return ne(()=>{const[A,C]=re(i),D=Q.filterProps(b),U=q.filterProps(b);return s(Q,J({class:["v-checkbox",b.class]},A,D,{modelValue:m.value,"onUpdate:modelValue":z=>m.value=z,id:T.value,focused:k.value,style:b.style}),{...g,default:z=>{let{id:L,messagesId:P,isDisabled:R,isReadonly:B,isValid:t}=z;return s(q,J(U,{id:L.value,"aria-describedby":P.value,disabled:R.value,readonly:B.value},C,{error:t.value===!1,modelValue:m.value,"onUpdate:modelValue":e=>m.value=e,onFocus:j,onBlur:h}),g)}})}),{}}}),Ce={key:2,style:{"white-space":"pre-line"}},je={class:"mb-4"},Ue={class:"mb-4"},ze={class:"mb-4"},Fe={class:"mb-4"},Me={class:"text-grey"},$e={key:3},Se=I({__name:"HoverFeedback",props:{matchingUuid:{}},setup(b){const V=b,i=v(null),g=v(!1),m=v(null),k=v(!1);return X(async()=>{g.value=!0,m.value=null;try{const h=await N(`https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matchingfeedback/${V.matchingUuid}`),o=await h.json();if(!h.ok)throw new Error((o==null?void 0:o.message)||"Erreur de récupération du feedback");i.value=o==null?void 0:o.data}catch(h){m.value=h instanceof Error?h.message:"Impossible de charger le feedback."}finally{g.value=!1}}),(h,o)=>(p(),_(G,null,[s(x,{color:"primary",size:"small",onClick:o[0]||(o[0]=T=>k.value=!0)},{default:a(()=>o[3]||(o[3]=[r(" mdi-comment-text-multiple-outline ")])),_:1}),s(be,{modelValue:k.value,"onUpdate:modelValue":o[2]||(o[2]=T=>k.value=T),"max-width":"800"},{default:a(()=>[s(Y,null,{default:a(()=>[s(M,{onClick:o[1]||(o[1]=T=>k.value=!1),outlined:"",color:"primary",size:"small",class:"ml-3 mt-2",icon:""},{default:a(()=>[s(x,null,{default:a(()=>o[4]||(o[4]=[r("mdi-arrow-left")])),_:1})]),_:1}),s(Z,null,{default:a(()=>o[5]||(o[5]=[r(" Feedback de matching ")])),_:1}),s(ee,null,{default:a(()=>[g.value?(p(),w(ie,{key:0,indeterminate:"",color:"primary"})):m.value?(p(),w(E,{key:1,type:"error",dense:""},{default:a(()=>[r(c(m.value),1)]),_:1})):i.value?(p(),_("div",Ce,[o[6]||(o[6]=d("strong",null,"Score total :",-1)),r(" "+c(i.value.totalScore)+" ",1),s(ue,{class:"my-2"}),d("strong",null,"Job Title ("+c(i.value.jobTitleScore)+"/20)",1),d("div",je,c(i.value.jobTitleFeedback),1),d("strong",null,"Expérience ("+c(i.value.experienceScore)+"/20)",1),d("div",Ue,c(i.value.experienceFeedback),1),d("strong",null,"Compétences ("+c(i.value.skillsScore)+"/40)",1),d("div",ze,c(i.value.skillsFeedback),1),d("strong",null,"Localisation ("+c(i.value.locationScore)+"/20)",1),d("div",Fe,c(i.value.locationFeedback),1),d("em",Me,"Dernière mise à jour : "+c(new Date(i.value.lastUpdatedAt).toLocaleString("fr-FR")),1)])):(p(),_("span",$e,"Aucun feedback disponible."))]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),Ee={class:"d-flex align-center mb-4"},Ae={class:"text-h5"},De={class:"text-subtitle-1 mb-2"},Le=["href"],Pe={key:0},Re=I({__name:"TableMatching",setup(b){ce();const V=v([]),i=v(null),g=v(""),m=v([]),k=v(!1),j=v(""),h=v("success"),o=v([{key:"edit",title:"",align:"center"},{key:"rfpReference",title:"Référence RFP",align:"start"},{key:"score",title:"Score",align:"end"},{key:"publicationDate",title:"Date de publication",align:"start"},{key:"statutMatching",title:"Statut",align:"start"},{key:"comment",title:"Commentaire",align:"start"},{key:"feedback",title:"Feedback ",align:"center"}]),T=async()=>{try{const t=await N("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matching");if(!t.ok)throw new Error("Erreur, impossible de récupérer les matchings");const e=await t.json();V.value=(Array.isArray(e.data)?e.data:[e.data]).map(u=>({...u,editable:!1}))}catch(t){i.value=t instanceof Error?t.message:"Erreur, impossible de récupérer les matchings"}},A=t=>new Date(t).toLocaleDateString("fr-FR"),C=S(()=>{const t={};return V.value.forEach(e=>{const u=`${e.consultantSurname}_${e.consultantName}`,f=`${e.consultantSurname} ${e.consultantName}`;t[u]||(t[u]={name:u,fullName:f,jobTitleGroups:[]});let n=t[u].jobTitleGroups.find(l=>l.jobTitle===e.jobTitle);n||(n={jobTitle:e.jobTitle,matchings:[]},t[u].jobTitleGroups.push(n)),n.matchings.push(e)}),Object.values(t)}),D=S(()=>{if(!g.value)return C.value;const t=g.value.toLowerCase();return C.value.map(e=>{const u=e.fullName.toLowerCase().includes(t),f=e.jobTitleGroups.map(n=>{const l=n.jobTitle.toLowerCase().includes(t),y=n.matchings.filter($=>{var H;return $.jobTitle.toLowerCase().includes(t)||$.rfpReference.toLowerCase().includes(t)||((H=$.comment)==null?void 0:H.toLowerCase().includes(t))||$.score.toString().includes(t)});return u||l?{jobTitle:n.jobTitle,matchings:n.matchings}:y.length>0?{jobTitle:n.jobTitle,matchings:y}:null}).filter(Boolean);return u||f.length>0?{...e,jobTitleGroups:f}:null}).filter(Boolean)}),U=t=>m.value.includes(t),z=t=>{U(t)?m.value=m.value.filter(e=>e!==t):m.value.push(t)},L=()=>m.value=C.value.map(t=>t.name),P=()=>m.value=[],R=async t=>{for(let e of t)if(e.editable)try{if((await N(`https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matching/${e.matchingUuid}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({statutMatching:e.statutMatching,comment:e.comment,score:e.score,profileUuid:e.profileUuid,rfpUuid:e.rfpUuid})})).ok)e.editable=!1,j.value="Modifications sauvegardées avec succès!",h.value="success",k.value=!0;else throw new Error("Erreur de sauvegarde")}catch(u){console.error("Erreur de sauvegarde :",u),j.value="Échec de la sauvegarde.",h.value="error",k.value=!0}},B=t=>t.jobTitleGroups.some(e=>e.matchings.some(u=>u.score>60&&u.statutMatching.toLowerCase()==="new"));return S(()=>C.value.some(t=>t.jobTitleGroups.some(e=>e.matchings.some(u=>u.editable)))),X(T),(t,e)=>{const u=Se;return p(),w(me,null,{default:a(()=>[e[12]||(e[12]=d("h1",{class:"text-center mb-6"},"Liste des Matchings",-1)),s(E,{type:"info",variant:"outlined",class:"mb-4 d-flex align-center"},{default:a(()=>[e[2]||(e[2]=r(" Vous devez être connecté pour accéder aux liens RFP sur le site Connecting-Expertise. ")),s(M,{color:"info",variant:"outlined",href:"https://customer.connecting-expertise.com/",target:"_blank",rel:"noopener noreferrer",size:"small"},{default:a(()=>e[1]||(e[1]=[r(" Se connecter ")])),_:1})]),_:1}),d("div",Ee,[s(ke,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=f=>g.value=f),label:"Rechercher un matching","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":"",class:"flex-grow-1"},null,8,["modelValue"]),s(de,{class:"ml-4"},{default:a(()=>[s(M,{onClick:L,size:"small",variant:"outlined"},{default:a(()=>[s(x,null,{default:a(()=>e[3]||(e[3]=[r("mdi-unfold-more-horizontal")])),_:1}),e[4]||(e[4]=r(" Tout développer "))]),_:1}),s(M,{onClick:P,size:"small",variant:"outlined"},{default:a(()=>[s(x,null,{default:a(()=>e[5]||(e[5]=[r("mdi-unfold-less-horizontal")])),_:1}),e[6]||(e[6]=r(" Tout réduire "))]),_:1})]),_:1})]),i.value?(p(),w(E,{key:0,type:"error",variant:"outlined",class:"mb-4"},{default:a(()=>[r(c(i.value),1)]),_:1})):F("",!0),!V.value.length&&!i.value?(p(),w(E,{key:1,type:"info",class:"mt-4"},{default:a(()=>e[7]||(e[7]=[r(" Aucun matching disponible. ")])),_:1})):F("",!0),(p(!0),_(G,null,O(D.value,f=>(p(),_("div",{key:f.name,class:"mb-6"},[s(Y,null,{default:a(()=>[s(Z,{class:K(["consultant-header d-flex align-center",{"cursor-pointer":!0}]),onClick:n=>z(f.name)},{default:a(()=>[s(x,{size:"large",class:"mr-2"},{default:a(()=>e[8]||(e[8]=[r("mdi-account")])),_:1}),d("span",Ae,c(f.fullName),1),s(ve),s(W,{class:"ml-2 mr-2 d-flex align-center",color:"primary"},{default:a(()=>[d("span",null,c(f.jobTitleGroups.reduce((n,l)=>n+l.matchings.length,0))+" matching"+c(f.jobTitleGroups.reduce((n,l)=>n+l.matchings.length,0)>1?"s":""),1),B(f)?(p(),w(x,{key:0,color:"red",size:"small",class:"ml-1",title:"Matching à haut score non traité"},{default:a(()=>e[9]||(e[9]=[r(" mdi-bell-alert ")])),_:1})):F("",!0)]),_:2},1024),s(x,null,{default:a(()=>[r(c(U(f.name)?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:2},1024)]),_:2},1032,["onClick"]),s(fe,null,{default:a(()=>[U(f.name)?(p(),w(ee,{key:0},{default:a(()=>[(p(!0),_(G,null,O(f.jobTitleGroups,n=>(p(),_("div",{key:n.jobTitle,class:"mb-4"},[d("h3",De,[s(x,{class:"mr-1"},{default:a(()=>e[10]||(e[10]=[r("mdi-briefcase")])),_:1}),r(" "+c(n.jobTitle),1)]),s(Ve,{headers:o.value,items:n.matchings,class:"elevation-1 mb-4",density:"compact"},{"item.rfpReference":a(({item:l})=>[d("div",null,[d("a",{href:l.rfpUrl,target:"_blank",rel:"noopener noreferrer",style:{color:"#1976d2","text-decoration":"underline"}},c(l.rfpReference),9,Le)])]),"item.edit":a(({item:l})=>[s(Te,{modelValue:l.editable,"onUpdate:modelValue":y=>l.editable=y,"hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),"item.publicationDate":a(({item:l})=>[r(c(A(l.publicationDate)),1)]),"item.score":a(({item:l})=>[s(W,{color:l.score>=30?"success":l.score>=10?"warning":"error",class:K(l.score>=30?"text-white":""),size:"small"},{default:a(()=>[r(c(l.score),1)]),_:2},1032,["color","class"])]),"item.comment":a(({item:l})=>[s(_e,{modelValue:l.comment,"onUpdate:modelValue":y=>l.comment=y,disabled:!l.editable,density:"compact",variant:"outlined","hide-details":"",rows:"2",style:{width:"300px","text-align":"right"},class:"comment-textarea"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.statutMatching":a(({item:l})=>[s(xe,{modelValue:l.statutMatching,"onUpdate:modelValue":y=>l.statutMatching=y,items:["Apply","NotApply","Rejected"],disabled:!l.editable,variant:"outlined",density:"compact","hide-details":"",style:{"max-width":"150px"}},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.feedback":a(({item:l})=>[s(u,{"matching-uuid":l.matchingUuid},null,8,["matching-uuid"])]),_:2},1032,["headers","items"]),n.matchings.some(l=>l.editable)?(p(),_("div",Pe,[s(M,{size:"small",color:"primary",onClick:l=>R(n.matchings)},{default:a(()=>e[11]||(e[11]=[r(" Sauvegarder ")])),_:2},1032,["onClick"])])):F("",!0)]))),128))]),_:2},1024)):F("",!0)]),_:2},1024)]),_:2},1024)]))),128))]),_:1})}}}),Be=pe(Re,[["__scopeId","data-v-51794641"]]),Xe=I({__name:"table-matching",setup(b){return(V,i)=>(p(),w(Be))}});export{Xe as default};
