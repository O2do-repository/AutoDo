import{f as oe}from"./fetchWithApiKey-BV95KrAI.js";import{s as de,u as Ce,x as fe,U as me,ag as Te,z as R,A as ve,ah as ge,g as n,B as H,aJ as _e,r as v,O as Pe,aF as Fe,o as he,P as G,ao as Re,F as O,R as se,S as Se,aK as Me,C as Ue,a3 as Z,aL as ze,a2 as je,aM as Ae,d as pe,ab as Be,a as V,c as L,w as s,b as A,e as d,j as W,k as N,aN as Ee,t as k,f as q,h as $,m as re,V as Ie,p as ie,aO as De,_ as Ge}from"./index-DvI0SduL.js";import{V as ee}from"./VAlert-BgJyX_2u.js";import{m as be,u as xe,a as Q,d as Ne,f as $e,e as Le,g as He,V as Oe}from"./VTextField-B9e_aAO9.js";import{V as Je,a as Ke,b as We}from"./VCard-BJCWG67F.js";import{V as qe}from"./VSpacer-BfCt4qg6.js";import{V as ue}from"./VChip-ziCDDBdU.js";import{V as Qe}from"./VDataTable-BlXPIbEF.js";import{b as Xe,c as ce,V as Ye}from"./VSelect-CpLz6XFI.js";const Ze=de({...be(),...Ce(Xe(),["inline"])},"VCheckbox"),et=fe()({name:"VCheckbox",inheritAttrs:!1,props:Ze(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,C){let{attrs:g,slots:p}=C;const i=me(e,"modelValue"),{isFocused:f,focus:b,blur:M}=xe(e),B=Te(),E=R(()=>e.id||`checkbox-${B}`);return ve(()=>{const[I,y]=ge(g),U=Q.filterProps(e),x=ce.filterProps(e);return n(Q,H({class:["v-checkbox",e.class]},I,U,{modelValue:i.value,"onUpdate:modelValue":T=>i.value=T,id:E.value,focused:f.value,style:e.style}),{...p,default:T=>{let{id:_,messagesId:D,isDisabled:S,isReadonly:l,isValid:t}=T;return n(ce,H(x,{id:_.value,"aria-describedby":D.value,disabled:S.value,readonly:l.value},y,{error:t.value===!1,modelValue:i.value,"onUpdate:modelValue":o=>i.value=o,onFocus:b,onBlur:M}),p)}})}),{}}}),tt=de({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...be(),...Ne()},"VTextarea"),at=fe()({name:"VTextarea",directives:{Intersect:_e},inheritAttrs:!1,props:tt(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,C){let{attrs:g,emit:p,slots:i}=C;const f=me(e,"modelValue"),{isFocused:b,focus:M,blur:B}=xe(e),E=R(()=>typeof e.counterValue=="function"?e.counterValue(f.value):(f.value||"").toString().length),I=R(()=>{if(g.maxlength)return g.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function y(r,h){var m,w;!e.autofocus||!r||(w=(m=h[0].target)==null?void 0:m.focus)==null||w.call(m)}const U=v(),x=v(),T=Pe(""),_=v(),D=R(()=>e.persistentPlaceholder||b.value||e.active);function S(){var r;_.value!==document.activeElement&&((r=_.value)==null||r.focus()),b.value||M()}function l(r){S(),p("click:control",r)}function t(r){p("mousedown:control",r)}function o(r){r.stopPropagation(),S(),Z(()=>{f.value="",ze(e["onClick:clear"],r)})}function u(r){var m;const h=r.target;if(f.value=h.value,(m=e.modelModifiers)!=null&&m.trim){const w=[h.selectionStart,h.selectionEnd];Z(()=>{h.selectionStart=w[0],h.selectionEnd=w[1]})}}const a=v(),c=v(+e.rows),z=R(()=>["plain","underlined"].includes(e.variant));Fe(()=>{e.autoGrow||(c.value=+e.rows)});function j(){e.autoGrow&&Z(()=>{if(!a.value||!x.value)return;const r=getComputedStyle(a.value),h=getComputedStyle(x.value.$el),m=parseFloat(r.getPropertyValue("--v-field-padding-top"))+parseFloat(r.getPropertyValue("--v-input-padding-top"))+parseFloat(r.getPropertyValue("--v-field-padding-bottom")),w=a.value.scrollHeight,J=parseFloat(r.lineHeight),X=Math.max(parseFloat(e.rows)*J+m,parseFloat(h.getPropertyValue("--v-input-control-height"))),Y=parseFloat(e.maxRows)*J+m||1/0,F=Ae(w??0,X,Y);c.value=Math.floor((F-m)/J),T.value=je(F)})}he(j),G(f,j),G(()=>e.rows,j),G(()=>e.maxRows,j),G(()=>e.density,j);let P;return G(a,r=>{r?(P=new ResizeObserver(j),P.observe(a.value)):P==null||P.disconnect()}),Re(()=>{P==null||P.disconnect()}),ve(()=>{const r=!!(i.counter||e.counter||e.counterValue),h=!!(r||i.details),[m,w]=ge(g),{modelValue:J,...X}=Q.filterProps(e),Y=$e(e);return n(Q,H({ref:U,modelValue:f.value,"onUpdate:modelValue":F=>f.value=F,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":z.value},e.class],style:e.style},m,X,{centerAffix:c.value===1&&!z.value,focused:b.value}),{...i,default:F=>{let{id:K,isDisabled:te,isDirty:ae,isReadonly:Ve,isValid:ye}=F;return n(Le,H({ref:x,style:{"--v-textarea-control-height":T.value},onClick:l,onMousedown:t,"onClick:clear":o,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},Y,{id:K.value,active:D.value||ae.value,centerAffix:c.value===1&&!z.value,dirty:ae.value||e.dirty,disabled:te.value,focused:b.value,error:ye.value===!1}),{...i,default:we=>{let{props:{class:le,...ne}}=we;return n(O,null,[e.prefix&&n("span",{class:"v-text-field__prefix"},[e.prefix]),se(n("textarea",H({ref:_,class:le,value:f.value,onInput:u,autofocus:e.autofocus,readonly:Ve.value,disabled:te.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:S,onBlur:B},ne,w),null),[[Se("intersect"),{handler:y},null,{once:!0}]]),e.autoGrow&&se(n("textarea",{class:[le,"v-textarea__sizer"],id:`${ne.id}-sizer`,"onUpdate:modelValue":ke=>f.value=ke,ref:a,readonly:!0,"aria-hidden":"true"},null),[[Me,f.value]]),e.suffix&&n("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:h?F=>{var K;return n(O,null,[(K=i.details)==null?void 0:K.call(i,F),r&&n(O,null,[n("span",null,null),n(He,{active:e.persistentCounter||b.value,value:E.value,max:I.value,disabled:e.disabled},i.counter)])])}:void 0})}),Ue({},U,x,_)}}),lt={class:"d-flex align-center mb-4"},nt={class:"text-h5"},ot={class:"text-subtitle-1 mb-2"},st=["href"],rt={key:0},it=pe({__name:"TableMatching",setup(e){Be();const C=v([]),g=v(null),p=v(""),i=v([]),f=v(!1),b=v(""),M=v("success"),B=v([{key:"edit",title:"",align:"center"},{key:"rfpReference",title:"Référence RFP",align:"start"},{key:"score",title:"Score",align:"end"},{key:"publicationDate",title:"Date de publication",align:"start"},{key:"statutMatching",title:"Statut",align:"start"},{key:"comment",title:"Commentaire",align:"start"}]),E=async()=>{try{const l=await oe("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matching");if(!l.ok)throw new Error("Erreur, impossible de récupérer les matchings");const t=await l.json();C.value=(Array.isArray(t.data)?t.data:[t.data]).map(o=>({...o,editable:!1})),i.value=y.value.map(o=>o.name)}catch(l){g.value=l instanceof Error?l.message:"Erreur, impossible de récupérer les matchings"}},I=l=>new Date(l).toLocaleDateString("fr-FR"),y=R(()=>{const l={};return C.value.forEach(t=>{const o=`${t.consultantSurname}_${t.consultantName}`,u=`${t.consultantSurname} ${t.consultantName}`;l[o]||(l[o]={name:o,fullName:u,jobTitleGroups:[]});let a=l[o].jobTitleGroups.find(c=>c.jobTitle===t.jobTitle);a||(a={jobTitle:t.jobTitle,matchings:[]},l[o].jobTitleGroups.push(a)),a.matchings.push(t)}),Object.values(l)}),U=R(()=>{if(!p.value)return y.value;const l=p.value.toLowerCase();return y.value.map(t=>{const o=t.jobTitleGroups.map(u=>{const a=u.matchings.filter(c=>{var z;return c.jobTitle.toLowerCase().includes(l)||c.rfpReference.toLowerCase().includes(l)||((z=c.comment)==null?void 0:z.toLowerCase().includes(l))||c.score.toString().includes(l)});return a.length>0?{jobTitle:u.jobTitle,matchings:a}:null}).filter(Boolean);return o.length>0?{...t,jobTitleGroups:o}:null}).filter(Boolean)}),x=l=>i.value.includes(l),T=l=>{x(l)?i.value=i.value.filter(t=>t!==l):i.value.push(l)},_=()=>i.value=y.value.map(l=>l.name),D=()=>i.value=[],S=async l=>{for(let t of l)if(t.editable)try{if((await oe(`https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matching/${t.matchingUuid}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({statutMatching:t.statutMatching,comment:t.comment,score:t.score,profileUuid:t.profileUuid,rfpUuid:t.rfpUuid})})).ok)t.editable=!1,b.value="Modifications sauvegardées avec succès!",M.value="success",f.value=!0;else throw new Error("Erreur de sauvegarde")}catch(o){console.error("Erreur de sauvegarde :",o),b.value="Échec de la sauvegarde.",M.value="error",f.value=!0}};return R(()=>y.value.some(l=>l.jobTitleGroups.some(t=>t.matchings.some(o=>o.editable)))),he(E),(l,t)=>(V(),L(Ie,null,{default:s(()=>[t[11]||(t[11]=A("h1",{class:"text-center mb-6"},"Liste des Matchings",-1)),n(ee,{type:"info",variant:"outlined",class:"mb-4 d-flex align-center"},{default:s(()=>[t[2]||(t[2]=d(" Vous devez être connecté pour accéder aux liens RFP sur le site Connecting-Expertise. ")),n(W,{color:"info",variant:"outlined",href:"https://customer.connecting-expertise.com/",target:"_blank",rel:"noopener noreferrer",size:"small"},{default:s(()=>t[1]||(t[1]=[d(" Se connecter ")])),_:1})]),_:1}),A("div",lt,[n(Oe,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=o=>p.value=o),label:"Rechercher un matching","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":"",class:"flex-grow-1"},null,8,["modelValue"]),n(Ee,{class:"ml-4"},{default:s(()=>[n(W,{onClick:_,size:"small",variant:"outlined"},{default:s(()=>[n(N,null,{default:s(()=>t[3]||(t[3]=[d("mdi-unfold-more-horizontal")])),_:1}),t[4]||(t[4]=d(" Tout développer "))]),_:1}),n(W,{onClick:D,size:"small",variant:"outlined"},{default:s(()=>[n(N,null,{default:s(()=>t[5]||(t[5]=[d("mdi-unfold-less-horizontal")])),_:1}),t[6]||(t[6]=d(" Tout réduire "))]),_:1})]),_:1})]),g.value?(V(),L(ee,{key:0,type:"error",variant:"outlined",class:"mb-4"},{default:s(()=>[d(k(g.value),1)]),_:1})):q("",!0),!C.value.length&&!g.value?(V(),L(ee,{key:1,type:"info",class:"mt-4"},{default:s(()=>t[7]||(t[7]=[d(" Aucun matching disponible. ")])),_:1})):q("",!0),(V(!0),$(O,null,re(U.value,o=>(V(),$("div",{key:o.name,class:"mb-6"},[n(Je,null,{default:s(()=>[n(Ke,{class:ie(["consultant-header d-flex align-center",{"cursor-pointer":!0}]),onClick:u=>T(o.name)},{default:s(()=>[n(N,{size:"large",class:"mr-2"},{default:s(()=>t[8]||(t[8]=[d("mdi-account")])),_:1}),A("span",nt,k(o.fullName),1),n(qe),n(ue,{class:"ml-2 mr-2",color:"primary"},{default:s(()=>[d(k(o.jobTitleGroups.reduce((u,a)=>u+a.matchings.length,0))+" matching"+k(o.jobTitleGroups.reduce((u,a)=>u+a.matchings.length,0)>1?"s":""),1)]),_:2},1024),n(N,null,{default:s(()=>[d(k(x(o.name)?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:2},1024)]),_:2},1032,["onClick"]),n(De,null,{default:s(()=>[x(o.name)?(V(),L(We,{key:0},{default:s(()=>[(V(!0),$(O,null,re(o.jobTitleGroups,u=>(V(),$("div",{key:u.jobTitle,class:"mb-4"},[A("h3",ot,[n(N,{class:"mr-1"},{default:s(()=>t[9]||(t[9]=[d("mdi-briefcase")])),_:1}),d(" "+k(u.jobTitle),1)]),n(Qe,{headers:B.value,items:u.matchings,class:"elevation-1 mb-4",density:"compact"},{"item.rfpReference":s(({item:a})=>[A("div",null,[A("a",{href:a.rfpUrl,target:"_blank",rel:"noopener noreferrer",style:{color:"#1976d2","text-decoration":"underline"}},k(a.rfpReference),9,st)])]),"item.edit":s(({item:a})=>[n(et,{modelValue:a.editable,"onUpdate:modelValue":c=>a.editable=c,"hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),"item.publicationDate":s(({item:a})=>[d(k(I(a.publicationDate)),1)]),"item.score":s(({item:a})=>[n(ue,{color:a.score>=30?"success":a.score>=10?"warning":"error",class:ie(a.score>=30?"text-white":""),size:"small"},{default:s(()=>[d(k(a.score),1)]),_:2},1032,["color","class"])]),"item.comment":s(({item:a})=>[n(at,{modelValue:a.comment,"onUpdate:modelValue":c=>a.comment=c,disabled:!a.editable,density:"compact",variant:"outlined","hide-details":"",rows:"2",style:{width:"300px","text-align":"right"},class:"comment-textarea"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.statutMatching":s(({item:a})=>[n(Ye,{modelValue:a.statutMatching,"onUpdate:modelValue":c=>a.statutMatching=c,items:["Apply","NotApply","Rejected"],disabled:!a.editable,variant:"outlined",density:"compact","hide-details":"",style:{"max-width":"150px"}},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["headers","items"]),u.matchings.some(a=>a.editable)?(V(),$("div",rt,[n(W,{size:"small",color:"primary",onClick:a=>S(u.matchings)},{default:s(()=>t[10]||(t[10]=[d(" Sauvegarder ")])),_:2},1032,["onClick"])])):q("",!0)]))),128))]),_:2},1024)):q("",!0)]),_:2},1024)]),_:2},1024)]))),128))]),_:1}))}}),ut=Ge(it,[["__scopeId","data-v-5197131b"]]),xt=pe({__name:"table-matching",setup(e){return(C,g)=>(V(),L(ut))}});export{xt as default};
