import{z as F,h as D,v as M,j as d,A as y,k as N,o as u,i as m,w as n,l as _,f as l,B as g,n as r,t as o,q as V,s as C,F as j,C as G,D as k,E as I,V as U,_ as q}from"./index-CjQAxy-L.js";import{V as O,c as P,b,d as w}from"./VSelect-B1Ofjcy2.js";import{V as T}from"./VAlert-IV44Bnfu.js";import{V as H,a as J,b as K}from"./VCard-BuPE2Xvi.js";import{V as Q}from"./VDataTable-C1pOGvB9.js";const W=F("v-spacer","div","VSpacer"),X={class:"d-flex align-center mb-4"},Y={class:"text-h5"},Z=D({__name:"TableMatching",setup(z){M();const f=d([]),c=d(null),p=d(""),i=d([]),E=d([{key:"jobTitle",title:"Titre du poste",align:"start"},{key:"rfpReference",title:"Référence RFP",align:"start"},{key:"score",title:"Score",align:"end"},{key:"comment",title:"Commentaire",align:"start"},{key:"offerDate",title:"Date de l'offre",align:"start"}]),S=async()=>{try{const t=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matching");if(!t.ok)throw new Error("Erreur lors de la récupération des matchings");const e=await t.json();console.log("Données reçues :",e),f.value=Array.isArray(e)?e:[e],i.value=v.value.map(a=>a.name)}catch(t){c.value=t instanceof Error?t.message:"Une erreur est survenue"}},A=t=>new Date(t).toLocaleDateString("fr-FR"),v=y(()=>{const t={};return f.value.forEach(e=>{const a=`${e.consultantSurname}_${e.consultantName}`,s=`${e.consultantSurname} ${e.consultantName}`;t[a]||(t[a]={name:a,fullName:s,matchings:[]}),t[a].matchings.push(e)}),Object.values(t)}),B=y(()=>{if(!p.value)return v.value;const t=p.value.toLowerCase();return v.value.map(e=>{const a=e.matchings.filter(s=>{var x;return s.jobTitle.toLowerCase().includes(t)||s.rfpReference.toLowerCase().includes(t)||((x=s.comment)==null?void 0:x.toLowerCase().includes(t))||s.score.toString().includes(t)});return a.length>0?{...e,matchings:a}:null}).filter(Boolean)}),h=t=>i.value.includes(t),L=t=>{h(t)?i.value=i.value.filter(e=>e!==t):i.value.push(t)},R=()=>{i.value=v.value.map(t=>t.name)},$=()=>{i.value=[]};return N(S),(t,e)=>(u(),m(U,null,{default:n(()=>[e[7]||(e[7]=_("h1",{class:"text-center mb-6"},"Liste des Matchings",-1)),_("div",X,[l(O,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),label:"Rechercher un matching","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":"",class:"flex-grow-1"},null,8,["modelValue"]),l(P,{class:"ml-4"},{default:n(()=>[l(b,{onClick:R,size:"small",variant:"outlined"},{default:n(()=>[l(g,null,{default:n(()=>e[1]||(e[1]=[r("mdi-unfold-more-horizontal")])),_:1}),e[2]||(e[2]=r(" Tout développer "))]),_:1}),l(b,{onClick:$,size:"small",variant:"outlined"},{default:n(()=>[l(g,null,{default:n(()=>e[3]||(e[3]=[r("mdi-unfold-less-horizontal")])),_:1}),e[4]||(e[4]=r(" Tout réduire "))]),_:1})]),_:1})]),c.value?(u(),m(T,{key:0,type:"error",variant:"outlined",class:"mb-4"},{default:n(()=>[r(o(c.value),1)]),_:1})):V("",!0),!f.value.length&&!c.value?(u(),m(T,{key:1,type:"info",class:"mt-4"},{default:n(()=>e[5]||(e[5]=[r(" Aucun matching disponible. ")])),_:1})):V("",!0),(u(!0),C(j,null,G(B.value,a=>(u(),C("div",{key:a.name,class:"mb-6"},[l(H,null,{default:n(()=>[l(J,{class:k(["consultant-header d-flex align-center",{"cursor-pointer":!0}]),onClick:s=>L(a.name)},{default:n(()=>[l(g,{size:"large",class:"mr-2"},{default:n(()=>e[6]||(e[6]=[r("mdi-account")])),_:1}),_("span",Y,o(a.fullName),1),l(W),l(w,{class:"ml-2 mr-2",color:"primary"},{default:n(()=>[r(o(a.matchings.length)+" matching"+o(a.matchings.length>1?"s":""),1)]),_:2},1024),l(g,null,{default:n(()=>[r(o(h(a.name)?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:2},1024)]),_:2},1032,["onClick"]),l(I,null,{default:n(()=>[h(a.name)?(u(),m(K,{key:0},{default:n(()=>[l(Q,{headers:E.value,items:a.matchings,class:"elevation-1",density:"compact"},{"item.offerDate":n(({item:s})=>[r(o(A(s.offerDate)),1)]),"item.score":n(({item:s})=>[l(w,{color:s.score>=30?"success":s.score>=10?"warning":"error",class:k(s.score>=30?"text-white":""),size:"small"},{default:n(()=>[r(o(s.score),1)]),_:2},1032,["color","class"])]),"item.comment":n(({item:s})=>[r(o(s.comment||"Aucun commentaire"),1)]),_:2},1032,["headers","items"])]),_:2},1024)):V("",!0)]),_:2},1024)]),_:2},1024)]))),128))]),_:1}))}}),ee=q(Z,[["__scopeId","data-v-ea950caf"]]),re=D({__name:"table-matching",setup(z){return(f,c)=>(u(),m(ee))}});export{re as default};
