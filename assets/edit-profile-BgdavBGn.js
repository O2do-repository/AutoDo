import{_ as j,V as F}from"./VForm-YukehooO.js";import{h as R,j as t,a5 as J,O as H,k as K,_ as O,o as p,i as f,w as a,n as d,t as U,q as V,f as o,V as A}from"./index-BJHyyak7.js";import{V as b,a as P}from"./VSelect-BhpJF4Ay.js";import{V as G,a as I,b as Q,c as W}from"./VCard-Cs1PPY8c.js";import{V as X,a as u}from"./VRow-O0qSftFU.js";import{V as y}from"./VTextField-D9gaevoI.js";import{V as Y}from"./forwardRefs-B4WBqx-R.js";const Z=R({name:"EditProfile",components:{GoBackBtn:j},setup(){const e=localStorage.getItem("selectedProfile"),l=t(e?JSON.parse(e):{profileUuid:"",rateHour:null,cv:"",cvDate:"",jobTitle:"",experienceLevel:"",skills:[],keywords:[]}),w=J(),m=["Junior","Medior","Senior"],k=t([]),g=t([]),c=t(null),s=t(null),v="https://example.com/default-cv.pdf",C=t(""),$=r=>!!r||"Champ obligatoire",B=r=>!isNaN(r)&&Number(r)>=0||"Entier positif requis",N=r=>/^(https?:\/\/)[^\s$.?#].[^\s]*$/.test(r)||"Lien invalide (ex: https://...)",S=r=>!!r||"Date requise",T=()=>{if(!l.value.cv||l.value.cv.trim()===""){C.value="";return}C.value=l.value.cv},M=()=>{l.value.cv===v&&(l.value.cv="")},L=()=>{l.value.cv||(l.value.cv=v)};H(()=>l.value.cv,T);const z=async()=>{try{const r=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/skill");if(!r.ok)throw new Error("Erreur récupération des skills");const i=await r.json();k.value=i.data.map(n=>n.name)}catch(r){console.error("Erreur skills :",r)}},D=async()=>{try{const r=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/keyword");if(!r.ok)throw new Error("Erreur récupération des keywords");const i=await r.json();g.value=i.data.map(n=>n.name)}catch(r){console.error("Erreur keywords :",r)}};K(()=>{z(),D(),T()});const h=t(!1),q=t(null),E=t(!1);return{profile:l,experienceLevels:m,availableSkills:k,availableKeywords:g,formRef:c,required:$,numberRule:B,urlRule:N,dateRule:S,placeholderCV:v,validCV:C,clearPlaceholder:M,restorePlaceholder:L,submitProfile:async()=>{h.value=!0,q.value=null,E.value=!1;try{if((!l.value.cv||l.value.cv.trim()==="")&&(l.value.cv=v),!c.value)return;const{valid:r}=await c.value.validate();if(!r)return;const i=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/profil",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l.value)}),n=await i.json();if(!i.ok)throw new Error(n.message||"Erreur lors de l'ajout du profil");E.value=n.message||"Profil modifié avec succès !",setTimeout(()=>{w.push("/consultant/consultant-info")},1e3)}catch(r){q.value=r instanceof Error?r.message:"Une erreur est survenue"}finally{h.value=!1}},errorMessage:s,loading:h,error:q,success:E}}});function x(e,l,w,m,k,g){const c=j;return p(),f(A,null,{default:a(()=>[e.errorMessage?(p(),f(b,{key:0,closable:"",type:"error",variant:"outlined",class:"mb-4"},{default:a(()=>[d(U(e.errorMessage),1)]),_:1})):V("",!0),o(G,{class:"pa-4"},{default:a(()=>[o(c,{class:"mb-4"}),o(I,{class:"text-h5 font-weight-bold"},{default:a(()=>l[7]||(l[7]=[d("Modifier le Profil")])),_:1}),o(Q,null,{default:a(()=>[o(F,{ref:"formRef"},{default:a(()=>[o(X,null,{default:a(()=>[o(u,{cols:"12"},{default:a(()=>[o(y,{label:"CV URL *",modelValue:e.profile.cv,"onUpdate:modelValue":l[0]||(l[0]=s=>e.profile.cv=s),variant:"outlined",color:"primary",placeholder:e.placeholderCV,rules:[e.required,e.urlRule],onFocus:e.clearPlaceholder,onBlur:e.restorePlaceholder,required:""},null,8,["modelValue","placeholder","rules","onFocus","onBlur"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(y,{label:"Job Title *",modelValue:e.profile.jobTitle,"onUpdate:modelValue":l[1]||(l[1]=s=>e.profile.jobTitle=s),rules:[e.required],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(P,{label:"Niveau d'expérience *",modelValue:e.profile.experienceLevel,"onUpdate:modelValue":l[2]||(l[2]=s=>e.profile.experienceLevel=s),items:e.experienceLevels,rules:[e.required],variant:"outlined",color:"primary",required:""},null,8,["modelValue","items","rules"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(y,{label:"Tarif / heure *",modelValue:e.profile.rateHour,"onUpdate:modelValue":l[3]||(l[3]=s=>e.profile.rateHour=s),modelModifiers:{number:!0},type:"number",rules:[e.required,e.numberRule],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(y,{label:"Date du CV *",modelValue:e.profile.cvDate,"onUpdate:modelValue":l[4]||(l[4]=s=>e.profile.cvDate=s),type:"date",rules:[e.required,e.dateRule],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(u,{cols:"12"},{default:a(()=>[o(P,{label:"Compétences *",modelValue:e.profile.skills,"onUpdate:modelValue":l[5]||(l[5]=s=>e.profile.skills=s),items:e.availableSkills,multiple:"",chips:"","closable-chips":"",rules:[e.required],variant:"outlined",color:"primary"},null,8,["modelValue","items","rules"])]),_:1}),o(u,{cols:"12"},{default:a(()=>[o(P,{label:"Mots-clés *",modelValue:e.profile.keywords,"onUpdate:modelValue":l[6]||(l[6]=s=>e.profile.keywords=s),items:e.availableKeywords,multiple:"",chips:"","closable-chips":"",rules:[e.required],variant:"outlined",color:"primary"},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e.loading?(p(),f(b,{key:0,type:"info",class:"mt-4"},{default:a(()=>l[8]||(l[8]=[d("Chargement en cours...")])),_:1})):V("",!0),e.error?(p(),f(b,{key:1,type:"error",class:"mt-4"},{default:a(()=>[d(U(e.error),1)]),_:1})):V("",!0),e.success?(p(),f(b,{key:2,type:"success",class:"mt-4"},{default:a(()=>l[9]||(l[9]=[d("Consultant ajouté avec succès !")])),_:1})):V("",!0),o(W,{class:"d-flex justify-end"},{default:a(()=>[o(Y,{color:"primary",onClick:e.submitProfile},{default:a(()=>l[10]||(l[10]=[d("Publier")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}const _=O(Z,[["render",x]]),ie=R({__name:"edit-profile",setup(e){return(l,w)=>{const m=_;return p(),f(m)}}});export{ie as default};
