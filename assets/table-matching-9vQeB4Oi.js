import{q as ce,s as ke,u as de,O as fe,a5 as Ce,x as R,y as me,a6 as ve,g as n,z as H,ar as Te,r as v,I as _e,am as Pe,o as ge,J as G,aa as Fe,F as O,L as oe,M as Re,as as Se,T as Z,at as Me,S as ze,au as Ue,d as he,a1 as je,a as V,c as L,w as s,b as B,e as d,j as N,t as k,f as K,h as $,l as se,V as Be,n as re,av as Ae,_ as Ee}from"./index-_jayZypQ.js";import{V as Q,i as Ie}from"./VBtn-BH2dA9a5.js";import{V as ee}from"./VAlert-B4cexLx1.js";import{c as pe,u as xe,d as W,g as De,h as Ge,i as Ne,j as $e,V as Le,a as ie}from"./VTextField-CSyY0Sc4.js";import{V as He,a as Oe,b as Je}from"./VCard-CbGHmNoU.js";import{V as qe}from"./VSpacer-DBMY9PT9.js";import{V as Ke}from"./VDataTable-BVUE1gij.js";import{b as Qe,c as ue,V as We}from"./VSelect-BDZf4OYV.js";import{f as Xe}from"./forwardRefs-BVzxEpr1.js";const Ye=ce({...pe(),...ke(Qe(),["inline"])},"VCheckbox"),Ze=de()({name:"VCheckbox",inheritAttrs:!1,props:Ye(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,C){let{attrs:g,slots:p}=C;const i=fe(e,"modelValue"),{isFocused:f,focus:x,blur:M}=xe(e),A=Ce(),E=R(()=>e.id||`checkbox-${A}`);return me(()=>{const[I,y]=ve(g),z=W.filterProps(e),b=ue.filterProps(e);return n(W,H({class:["v-checkbox",e.class]},I,z,{modelValue:i.value,"onUpdate:modelValue":T=>i.value=T,id:E.value,focused:f.value,style:e.style}),{...p,default:T=>{let{id:_,messagesId:D,isDisabled:S,isReadonly:l,isValid:t}=T;return n(ue,H(b,{id:_.value,"aria-describedby":D.value,disabled:S.value,readonly:l.value},y,{error:t.value===!1,modelValue:i.value,"onUpdate:modelValue":o=>i.value=o,onFocus:x,onBlur:M}),p)}})}),{}}}),et=ce({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...pe(),...De()},"VTextarea"),tt=de()({name:"VTextarea",directives:{Intersect:Te},inheritAttrs:!1,props:et(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,C){let{attrs:g,emit:p,slots:i}=C;const f=fe(e,"modelValue"),{isFocused:x,focus:M,blur:A}=xe(e),E=R(()=>typeof e.counterValue=="function"?e.counterValue(f.value):(f.value||"").toString().length),I=R(()=>{if(g.maxlength)return g.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function y(r,h){var m,w;!e.autofocus||!r||(w=(m=h[0].target)==null?void 0:m.focus)==null||w.call(m)}const z=v(),b=v(),T=_e(""),_=v(),D=R(()=>e.persistentPlaceholder||x.value||e.active);function S(){var r;_.value!==document.activeElement&&((r=_.value)==null||r.focus()),x.value||M()}function l(r){S(),p("click:control",r)}function t(r){p("mousedown:control",r)}function o(r){r.stopPropagation(),S(),Z(()=>{f.value="",Me(e["onClick:clear"],r)})}function u(r){var m;const h=r.target;if(f.value=h.value,(m=e.modelModifiers)!=null&&m.trim){const w=[h.selectionStart,h.selectionEnd];Z(()=>{h.selectionStart=w[0],h.selectionEnd=w[1]})}}const a=v(),c=v(+e.rows),U=R(()=>["plain","underlined"].includes(e.variant));Pe(()=>{e.autoGrow||(c.value=+e.rows)});function j(){e.autoGrow&&Z(()=>{if(!a.value||!b.value)return;const r=getComputedStyle(a.value),h=getComputedStyle(b.value.$el),m=parseFloat(r.getPropertyValue("--v-field-padding-top"))+parseFloat(r.getPropertyValue("--v-input-padding-top"))+parseFloat(r.getPropertyValue("--v-field-padding-bottom")),w=a.value.scrollHeight,J=parseFloat(r.lineHeight),X=Math.max(parseFloat(e.rows)*J+m,parseFloat(h.getPropertyValue("--v-input-control-height"))),Y=parseFloat(e.maxRows)*J+m||1/0,F=Ue(w??0,X,Y);c.value=Math.floor((F-m)/J),T.value=ze(F)})}ge(j),G(f,j),G(()=>e.rows,j),G(()=>e.maxRows,j),G(()=>e.density,j);let P;return G(a,r=>{r?(P=new ResizeObserver(j),P.observe(a.value)):P==null||P.disconnect()}),Fe(()=>{P==null||P.disconnect()}),me(()=>{const r=!!(i.counter||e.counter||e.counterValue),h=!!(r||i.details),[m,w]=ve(g),{modelValue:J,...X}=W.filterProps(e),Y=Ge(e);return n(W,H({ref:z,modelValue:f.value,"onUpdate:modelValue":F=>f.value=F,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":U.value},e.class],style:e.style},m,X,{centerAffix:c.value===1&&!U.value,focused:x.value}),{...i,default:F=>{let{id:q,isDisabled:te,isDirty:ae,isReadonly:be,isValid:Ve}=F;return n(Ne,H({ref:b,style:{"--v-textarea-control-height":T.value},onClick:l,onMousedown:t,"onClick:clear":o,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},Y,{id:q.value,active:D.value||ae.value,centerAffix:c.value===1&&!U.value,dirty:ae.value||e.dirty,disabled:te.value,focused:x.value,error:Ve.value===!1}),{...i,default:ye=>{let{props:{class:le,...ne}}=ye;return n(O,null,[e.prefix&&n("span",{class:"v-text-field__prefix"},[e.prefix]),oe(n("textarea",H({ref:_,class:le,value:f.value,onInput:u,autofocus:e.autofocus,readonly:be.value,disabled:te.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:S,onBlur:A},ne,w),null),[[Re("intersect"),{handler:y},null,{once:!0}]]),e.autoGrow&&oe(n("textarea",{class:[le,"v-textarea__sizer"],id:`${ne.id}-sizer`,"onUpdate:modelValue":we=>f.value=we,ref:a,readonly:!0,"aria-hidden":"true"},null),[[Se,f.value]]),e.suffix&&n("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:h?F=>{var q;return n(O,null,[(q=i.details)==null?void 0:q.call(i,F),r&&n(O,null,[n("span",null,null),n($e,{active:e.persistentCounter||x.value,value:E.value,max:I.value,disabled:e.disabled},i.counter)])])}:void 0})}),Xe({},z,b,_)}}),at={class:"d-flex align-center mb-4"},lt={class:"text-h5"},nt={class:"text-subtitle-1 mb-2"},ot=["href"],st={key:0},rt=he({__name:"TableMatching",setup(e){je();const C=v([]),g=v(null),p=v(""),i=v([]),f=v(!1),x=v(""),M=v("success"),A=v([{key:"edit",title:"",align:"center"},{key:"rfpReference",title:"Référence RFP",align:"start"},{key:"score",title:"Score",align:"end"},{key:"publicationDate",title:"Date de publication",align:"start"},{key:"statutMatching",title:"Statut",align:"start"},{key:"comment",title:"Commentaire",align:"start"}]),E=async()=>{try{const l=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matching",{credentials:"include"});if(!l.ok)throw new Error("Erreur, impossible de récupérer les matchings");const t=await l.json();C.value=(Array.isArray(t.data)?t.data:[t.data]).map(o=>({...o,editable:!1})),i.value=y.value.map(o=>o.name)}catch(l){g.value=l instanceof Error?l.message:"Erreur, impossible de récupérer les matchings"}},I=l=>new Date(l).toLocaleDateString("fr-FR"),y=R(()=>{const l={};return C.value.forEach(t=>{const o=`${t.consultantSurname}_${t.consultantName}`,u=`${t.consultantSurname} ${t.consultantName}`;l[o]||(l[o]={name:o,fullName:u,jobTitleGroups:[]});let a=l[o].jobTitleGroups.find(c=>c.jobTitle===t.jobTitle);a||(a={jobTitle:t.jobTitle,matchings:[]},l[o].jobTitleGroups.push(a)),a.matchings.push(t)}),Object.values(l)}),z=R(()=>{if(!p.value)return y.value;const l=p.value.toLowerCase();return y.value.map(t=>{const o=t.jobTitleGroups.map(u=>{const a=u.matchings.filter(c=>{var U;return c.jobTitle.toLowerCase().includes(l)||c.rfpReference.toLowerCase().includes(l)||((U=c.comment)==null?void 0:U.toLowerCase().includes(l))||c.score.toString().includes(l)});return a.length>0?{jobTitle:u.jobTitle,matchings:a}:null}).filter(Boolean);return o.length>0?{...t,jobTitleGroups:o}:null}).filter(Boolean)}),b=l=>i.value.includes(l),T=l=>{b(l)?i.value=i.value.filter(t=>t!==l):i.value.push(l)},_=()=>i.value=y.value.map(l=>l.name),D=()=>i.value=[],S=async l=>{for(let t of l)if(t.editable)try{if((await fetch(`https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matching/${t.matchingUuid}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({statutMatching:t.statutMatching,comment:t.comment,score:t.score,profileUuid:t.profileUuid,rfpUuid:t.rfpUuid})})).ok)t.editable=!1,x.value="Modifications sauvegardées avec succès!",M.value="success",f.value=!0;else throw new Error("Erreur de sauvegarde")}catch(o){console.error("Erreur de sauvegarde :",o),x.value="Échec de la sauvegarde.",M.value="error",f.value=!0}};return R(()=>y.value.some(l=>l.jobTitleGroups.some(t=>t.matchings.some(o=>o.editable)))),ge(E),(l,t)=>(V(),L(Be,null,{default:s(()=>[t[11]||(t[11]=B("h1",{class:"text-center mb-6"},"Liste des Matchings",-1)),n(ee,{type:"info",variant:"outlined",class:"mb-4 d-flex align-center"},{default:s(()=>[t[2]||(t[2]=d(" Vous devez être connecté pour accéder aux liens RFP sur le site Connecting-Expertise. ")),n(Q,{color:"info",variant:"outlined",href:"https://customer.connecting-expertise.com/",target:"_blank",rel:"noopener noreferrer",size:"small"},{default:s(()=>t[1]||(t[1]=[d(" Se connecter ")])),_:1})]),_:1}),B("div",at,[n(Le,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=o=>p.value=o),label:"Rechercher un matching","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":"",class:"flex-grow-1"},null,8,["modelValue"]),n(Ie,{class:"ml-4"},{default:s(()=>[n(Q,{onClick:_,size:"small",variant:"outlined"},{default:s(()=>[n(N,null,{default:s(()=>t[3]||(t[3]=[d("mdi-unfold-more-horizontal")])),_:1}),t[4]||(t[4]=d(" Tout développer "))]),_:1}),n(Q,{onClick:D,size:"small",variant:"outlined"},{default:s(()=>[n(N,null,{default:s(()=>t[5]||(t[5]=[d("mdi-unfold-less-horizontal")])),_:1}),t[6]||(t[6]=d(" Tout réduire "))]),_:1})]),_:1})]),g.value?(V(),L(ee,{key:0,type:"error",variant:"outlined",class:"mb-4"},{default:s(()=>[d(k(g.value),1)]),_:1})):K("",!0),!C.value.length&&!g.value?(V(),L(ee,{key:1,type:"info",class:"mt-4"},{default:s(()=>t[7]||(t[7]=[d(" Aucun matching disponible. ")])),_:1})):K("",!0),(V(!0),$(O,null,se(z.value,o=>(V(),$("div",{key:o.name,class:"mb-6"},[n(He,null,{default:s(()=>[n(Oe,{class:re(["consultant-header d-flex align-center",{"cursor-pointer":!0}]),onClick:u=>T(o.name)},{default:s(()=>[n(N,{size:"large",class:"mr-2"},{default:s(()=>t[8]||(t[8]=[d("mdi-account")])),_:1}),B("span",lt,k(o.fullName),1),n(qe),n(ie,{class:"ml-2 mr-2",color:"primary"},{default:s(()=>[d(k(o.jobTitleGroups.reduce((u,a)=>u+a.matchings.length,0))+" matching"+k(o.jobTitleGroups.reduce((u,a)=>u+a.matchings.length,0)>1?"s":""),1)]),_:2},1024),n(N,null,{default:s(()=>[d(k(b(o.name)?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:2},1024)]),_:2},1032,["onClick"]),n(Ae,null,{default:s(()=>[b(o.name)?(V(),L(Je,{key:0},{default:s(()=>[(V(!0),$(O,null,se(o.jobTitleGroups,u=>(V(),$("div",{key:u.jobTitle,class:"mb-4"},[B("h3",nt,[n(N,{class:"mr-1"},{default:s(()=>t[9]||(t[9]=[d("mdi-briefcase")])),_:1}),d(" "+k(u.jobTitle),1)]),n(Ke,{headers:A.value,items:u.matchings,class:"elevation-1 mb-4",density:"compact"},{"item.rfpReference":s(({item:a})=>[B("div",null,[B("a",{href:a.rfpUrl,target:"_blank",rel:"noopener noreferrer",style:{color:"#1976d2","text-decoration":"underline"}},k(a.rfpReference),9,ot)])]),"item.edit":s(({item:a})=>[n(Ze,{modelValue:a.editable,"onUpdate:modelValue":c=>a.editable=c,"hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),"item.publicationDate":s(({item:a})=>[d(k(I(a.publicationDate)),1)]),"item.score":s(({item:a})=>[n(ie,{color:a.score>=30?"success":a.score>=10?"warning":"error",class:re(a.score>=30?"text-white":""),size:"small"},{default:s(()=>[d(k(a.score),1)]),_:2},1032,["color","class"])]),"item.comment":s(({item:a})=>[n(tt,{modelValue:a.comment,"onUpdate:modelValue":c=>a.comment=c,disabled:!a.editable,density:"compact",variant:"outlined","hide-details":"",rows:"2",style:{width:"300px","text-align":"right"},class:"comment-textarea"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.statutMatching":s(({item:a})=>[n(We,{modelValue:a.statutMatching,"onUpdate:modelValue":c=>a.statutMatching=c,items:["Apply","NotApply","Rejected"],disabled:!a.editable,variant:"outlined",density:"compact","hide-details":"",style:{"max-width":"150px"}},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["headers","items"]),u.matchings.some(a=>a.editable)?(V(),$("div",st,[n(Q,{size:"small",color:"primary",onClick:a=>S(u.matchings)},{default:s(()=>t[10]||(t[10]=[d(" Sauvegarder ")])),_:2},1032,["onClick"])])):K("",!0)]))),128))]),_:2},1024)):K("",!0)]),_:2},1024)]),_:2},1024)]))),128))]),_:1}))}}),it=Ee(rt,[["__scopeId","data-v-8f96d010"]]),xt=he({__name:"table-matching",setup(e){return(C,g)=>(V(),L(it))}});export{xt as default};
