import{f as h}from"./fetchWithApiKey-DRmr9JxU.js";import{d as D,r as d,a as V,h as j,g as e,j as U,w as t,e as p,t as y,ab as A,z as B,o as M,_ as P,c as k,b as $,F,m as K,am as O,ac as R,ad as G,k as J,al as q,f as T,V as W}from"./index-DZc381AJ.js";import{V as _,a as H,b as z,c as Q}from"./VCard-25saiFZi.js";import{V as X}from"./VSpacer-BpcMPyvc.js";import{V as Y,a as N}from"./VSnackbar-Dd1pS1vy.js";import{a as x,V as w}from"./VRow-DnoMbIXs.js";import{V as Z}from"./VTextField-DecPHR9W.js";const ee=D({__name:"DeleteConsultant",props:{consultantUuid:{}},emits:["consultantDeleted"],setup(a,{emit:n}){const m=a,b=n,f=d(!1),v=d(!1),c=d(!1),s=d(""),C=d(""),E=async()=>{if(!m.consultantUuid){s.value="UUID consultant manquant",C.value="red",c.value=!0;return}v.value=!0;try{const g=await h(`https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/consultant/${m.consultantUuid}`,{method:"DELETE"}),o=await g.text();let u;try{u=JSON.parse(o)}catch{throw new Error("Erreur serveur : réponse invalide")}if(!g.ok||!u.success)throw new Error(u.message);b("consultantDeleted",{uuid:m.consultantUuid,message:u.message})}catch(g){s.value=g.message||"Erreur inconnue",C.value="red"}finally{c.value=!0,v.value=!1}};return(g,o)=>(V(),j("div",null,[e(U,{color:"error",variant:"text",icon:"mdi-delete",density:"comfortable",onClick:o[0]||(o[0]=u=>f.value=!0)}),e(Y,{modelValue:f.value,"onUpdate:modelValue":o[2]||(o[2]=u=>f.value=u),"max-width":"500"},{default:t(()=>[e(_,null,{default:t(()=>[e(H,{class:"headline"},{default:t(()=>o[4]||(o[4]=[p("Confirmer la suppression")])),_:1}),e(z,null,{default:t(()=>o[5]||(o[5]=[p(" Êtes-vous sûr de vouloir supprimer ce consultant ? ")])),_:1}),e(Q,null,{default:t(()=>[e(X),e(U,{color:"grey",onClick:o[1]||(o[1]=u=>f.value=!1)},{default:t(()=>o[6]||(o[6]=[p("Annuler")])),_:1}),e(U,{color:"red",loading:v.value,onClick:E},{default:t(()=>o[7]||(o[7]=[p("Supprimer")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(N,{modelValue:c.value,"onUpdate:modelValue":o[3]||(o[3]=u=>c.value=u),color:C.value,timeout:"3000"},{default:t(()=>[p(y(s.value),1)]),_:1},8,["modelValue","color"])]))}}),te=D({name:"ConsultantGrid",setup(){const a=d([]),n=d(!1),m=d(null),b=A(),f=d(!1),v=d(""),c=d("green"),s="https://via.placeholder.com/150?text=No+Image",C=d(""),E=B(()=>{const r=C.value.toLowerCase();return a.value.filter(l=>l.name.toLowerCase().includes(r)||l.surname.toLowerCase().includes(r)||l.email.toLowerCase().includes(r)).sort((l,i)=>{const I=l.name.toLowerCase().localeCompare(i.name.toLowerCase());return I!==0?I:l.surname.toLowerCase().localeCompare(i.surname.toLowerCase())})}),g=async()=>{n.value=!0;try{const r=localStorage.getItem("apiKey"),l=await h("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/consultant",{method:"GET"});if(!l.ok)throw new Error("Failed to fetch consultants");const i=await l.json();if(i.success&&Array.isArray(i.data))a.value=i.data;else throw new Error("Invalid data format")}catch(r){m.value=r.message||"Unknown error"}finally{n.value=!1}},o=({uuid:r,message:l})=>{a.value=a.value.filter(i=>i.consultantUuid!==r),v.value=l,c.value="green",f.value=!0},u=async r=>{try{if(!(await h(`https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/consultant/${r}`,{method:"DELETE"})).ok)throw new Error("Erreur lors de la suppression");a.value=a.value.filter(i=>i.consultantUuid!==r)}catch(l){console.error(l.message)}},L=r=>{sessionStorage.setItem("selectedConsultant",JSON.stringify(r)),b.push("/consultant/consultant-info")},S=r=>{r.target.src=s};return M(()=>{g()}),{consultants:a,loading:n,error:m,snackbar:f,snackbarMessage:v,snackbarColor:c,deleteConsultant:u,goToConsultantProfiles:L,defaultImage:s,setPlaceholder:S,handleConsultantDeleted:o,search:C,filteredConsultants:E}}}),ae={class:"consultant-name"},se={class:"consultant-email text-caption grey--text"};function oe(a,n,m,b,f,v){const c=ee;return V(),k(W,null,{default:t(()=>[e(x,{justify:"center",class:"mb-4"},{default:t(()=>[e(w,{cols:"12",md:"6"},{default:t(()=>[e(Z,{modelValue:a.search,"onUpdate:modelValue":n[0]||(n[0]=s=>a.search=s),label:"Rechercher un consultant","prepend-inner-icon":"mdi-magnify",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),e(x,{justify:"center"},{default:t(()=>[e(w,{cols:"12",class:"text-center mb-6"},{default:t(()=>n[4]||(n[4]=[$("h2",{class:"purple--text"},"A perfect blend of genius and caffeine",-1)])),_:1}),(V(!0),j(F,null,K(a.filteredConsultants,s=>(V(),k(w,{key:s.consultantUuid,cols:"12",sm:"4",md:"2",class:"text-center"},{default:t(()=>[e(_,{class:"consultant-card",elevation:"3",onClick:C=>a.goToConsultantProfiles(s),color:s.enterprise==="O2do"?"primary":void 0},{default:t(()=>[e(c,{consultantUuid:s.consultantUuid,onClick:n[1]||(n[1]=O(()=>{},["stop"])),onConsultantDeleted:a.handleConsultantDeleted},null,8,["consultantUuid","onConsultantDeleted"]),e(z,{class:"d-flex flex-column align-center justify-center text-truncate text-center"},{default:t(()=>[e(R,{size:"150"},{default:t(()=>[e(G,{src:s.picture?s.picture:a.defaultImage,alt:"Photo Consultant",contain:""},null,8,["src"])]),_:2},1024),$("div",ae,y(s.name)+" "+y(s.surname),1),$("div",se,y(s.email),1)]),_:2},1024)]),_:2},1032,["onClick","color"])]),_:2},1024))),128)),e(w,{cols:"12",sm:"4",md:"2",class:"text-center"},{default:t(()=>[e(_,{outlined:"",class:"consultant-card d-flex flex-column align-center justify-center"},{default:t(()=>[e(U,{onClick:n[2]||(n[2]=s=>a.$router.push("/consultant/add-consultant")),icon:"",color:"primary"},{default:t(()=>[e(J,{large:""},{default:t(()=>n[5]||(n[5]=[p("mdi-plus-circle")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a.loading?(V(),k(x,{key:0,justify:"center"},{default:t(()=>[e(w,{cols:"12",class:"text-center"},{default:t(()=>[e(q,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):T("",!0),a.error?(V(),k(x,{key:1,justify:"center"},{default:t(()=>[e(w,{cols:"12",class:"text-center red--text"},{default:t(()=>[p(y(a.error),1)]),_:1})]),_:1})):T("",!0),e(N,{modelValue:a.snackbar,"onUpdate:modelValue":n[3]||(n[3]=s=>a.snackbar=s),color:a.snackbarColor,timeout:"3000"},{default:t(()=>[p(y(a.snackbarMessage),1)]),_:1},8,["modelValue","color"])]),_:1})}const ne=P(te,[["render",oe],["__scopeId","data-v-377d36ad"]]),fe=D({__name:"list-consultant",setup(a){return(n,m)=>(V(),k(ne))}});export{fe as default};
