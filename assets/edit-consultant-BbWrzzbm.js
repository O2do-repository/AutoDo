import{_ as R,V as O}from"./VForm-YukehooO.js";import{h as U,a5 as F,j as d,O as q,k as J,_ as L,o as V,i as y,w as o,f as a,n as v,a6 as A,a7 as M,q as w,t as G,V as H}from"./index-BJHyyak7.js";import{V as K,a as Q,b as W,c as X}from"./VCard-Cs1PPY8c.js";import{V as Y,a as n}from"./VRow-O0qSftFU.js";import{V as u}from"./VTextField-D9gaevoI.js";import{V as Z}from"./VSwitch-BzR0l7Kp.js";import{a as x,V as E}from"./VSelect-BhpJF4Ay.js";import{V as _}from"./forwardRefs-B4WBqx-R.js";const ee=U({name:"EditConsultant",components:{GoBackBtn:R},setup(){const e=F(),l=d({email:"",availabilityDate:"",expirationDateCI:"",intern:!1,name:"",surname:"",enterprise:"",phone:"",copyCI:"",picture:""}),g=d([]),C=d(null),b=d(!1),h=d(null),p=d(!1),r=t=>(t==null?void 0:t.trim())!==""||"Champ obligatoire",k=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||"Format invalide (ex: exemple@mail.com)",$=t=>/^\+?[0-9]{9,15}$/.test(t)||"Format invalide (ex: +32444332211)",j=t=>/^(https?:\/\/)[^\s$.?#].[^\s]*$/.test(t)||"Lien invalide (ex: https://...)",D=t=>/^(https?:\/\/.*\.(?:png|jpg|jpeg|gif|webp))$/i.test(t)||"Lien image invalide (ex: https://site.com/photo.jpg)",P=t=>!!t||"Veuillez choisir une date",s="https://static.vecteezy.com/system/resources/thumbnails/003/337/584/small/default-avatar-photo-placeholder-profile-icon-vector.jpg",m=d(s),I=()=>{if(!l.value.picture||l.value.picture.trim()===""){m.value=s;return}const t=new Image;t.src=l.value.picture,t.onload=()=>{m.value=l.value.picture},t.onerror=()=>{m.value=s}},S=()=>{l.value.picture===s&&(l.value.picture="")},T=()=>{l.value.picture||(l.value.picture=s)},B=()=>{m.value=s};q(()=>l.value.picture,I),q(()=>l.value.intern,t=>{t?l.value.enterprise="O2do":l.value.enterprise=""});const N=async()=>{try{const t=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/enterprise");if(!t.ok)throw new Error("Erreur lors du chargement des entreprises");const i=await t.json();g.value=i.data}catch(t){console.error("Erreur fetch entreprises :",t)}},z=async()=>{b.value=!0,h.value=null,p.value=!1;try{if((!l.value.picture||l.value.picture.trim()==="")&&(l.value.picture=s),!C.value)return;const{valid:t}=await C.value.validate();if(!t)return;const i=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/consultant",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l.value)}),c=await i.json();if(!i.ok)throw new Error(c.message||"Erreur lors de l'ajout du consultant");sessionStorage.setItem("editConsultant",JSON.stringify(l.value)),sessionStorage.setItem("selectedConsultant",JSON.stringify(l.value)),p.value=c.message||"Consultant modifié avec succès !",setTimeout(()=>{e.push("/consultant/consultant-info")},1e3)}catch(t){h.value=t instanceof Error?t.message:"Une erreur est survenue"}finally{b.value=!1}};return J(()=>{var i,c;N();const t=sessionStorage.getItem("editConsultant");if(t){const f=JSON.parse(t);f.expirationDateCI=((i=f.expirationDateCI)==null?void 0:i.split("T")[0])||"",f.availabilityDate=((c=f.availabilityDate)==null?void 0:c.split("T")[0])||"",Object.assign(l.value,f),I()}}),{consultant:l,enterprises:g,formRef:C,validPicture:m,required:r,emailRule:k,phoneRule:$,urlRule:j,imageUrlRule:D,dateRule:P,clearPlaceholder:S,restorePlaceholder:T,setPlaceholder:B,submitConsultant:z,placeholderImage:s,loading:b,error:h,success:p}}});function le(e,l,g,C,b,h){const p=R;return V(),y(H,null,{default:o(()=>[a(K,{class:"pa-4"},{default:o(()=>[a(p,{class:"mb-4"}),a(Q,{class:"text-h5 font-weight-bold"},{default:o(()=>l[10]||(l[10]=[v("Modifier Consultant")])),_:1}),a(W,null,{default:o(()=>[a(O,{ref:"formRef"},{default:o(()=>[a(Y,null,{default:o(()=>[a(n,{cols:"12",class:"d-flex flex-column align-center"},{default:o(()=>[a(A,{size:"150"},{default:o(()=>[a(M,{src:e.validPicture,alt:"Photo Consultant",contain:"",onError:e.setPlaceholder},null,8,["src","onError"])]),_:1})]),_:1}),a(n,{cols:"12"},{default:o(()=>[a(u,{variant:"outlined",color:"primary",label:"Lien Photo *",modelValue:e.consultant.picture,"onUpdate:modelValue":l[0]||(l[0]=r=>e.consultant.picture=r),placeholder:e.placeholderImage,rules:[e.required,e.imageUrlRule],onFocus:e.clearPlaceholder,onBlur:e.restorePlaceholder},null,8,["modelValue","placeholder","rules","onFocus","onBlur"])]),_:1}),a(n,{cols:"6"},{default:o(()=>[a(u,{label:"Prénom *",modelValue:e.consultant.surname,"onUpdate:modelValue":l[1]||(l[1]=r=>e.consultant.surname=r),rules:[e.required],required:"",variant:"outlined",color:"primary"},null,8,["modelValue","rules"])]),_:1}),a(n,{cols:"6"},{default:o(()=>[a(u,{label:"Nom *",modelValue:e.consultant.name,"onUpdate:modelValue":l[2]||(l[2]=r=>e.consultant.name=r),rules:[e.required],required:"",variant:"outlined",color:"primary"},null,8,["modelValue","rules"])]),_:1}),a(n,{cols:"6"},{default:o(()=>[a(u,{label:"Lien Copie CI *",modelValue:e.consultant.copyCI,"onUpdate:modelValue":l[3]||(l[3]=r=>e.consultant.copyCI=r),rules:[e.required,e.urlRule],required:"",variant:"outlined",color:"primary"},null,8,["modelValue","rules"])]),_:1}),a(n,{cols:"6"},{default:o(()=>[a(u,{label:"Expiration CI *",modelValue:e.consultant.expirationDateCI,"onUpdate:modelValue":l[4]||(l[4]=r=>e.consultant.expirationDateCI=r),type:"date",rules:[e.required,e.dateRule],variant:"outlined",color:"primary"},null,8,["modelValue","rules"])]),_:1}),a(n,{cols:"6"},{default:o(()=>[a(Z,{label:"Interne",modelValue:e.consultant.intern,"onUpdate:modelValue":l[5]||(l[5]=r=>e.consultant.intern=r),color:"primary"},null,8,["modelValue"])]),_:1}),a(n,{cols:"6"},{default:o(()=>[a(x,{label:"Entreprise *",modelValue:e.consultant.enterprise,"onUpdate:modelValue":l[6]||(l[6]=r=>e.consultant.enterprise=r),items:e.enterprises,"item-title":"name","item-value":"name",rules:[e.required],variant:"outlined",color:"primary",disabled:!!e.consultant.intern},null,8,["modelValue","items","rules","disabled"])]),_:1}),a(n,{cols:"6"},{default:o(()=>[a(u,{label:"Email *",modelValue:e.consultant.email,"onUpdate:modelValue":l[7]||(l[7]=r=>e.consultant.email=r),rules:[e.required,e.emailRule],required:"",variant:"outlined",color:"primary"},null,8,["modelValue","rules"])]),_:1}),a(n,{cols:"6"},{default:o(()=>[a(u,{label:"Téléphone *",modelValue:e.consultant.phone,"onUpdate:modelValue":l[8]||(l[8]=r=>e.consultant.phone=r),rules:[e.required,e.phoneRule],required:"",variant:"outlined",color:"primary"},null,8,["modelValue","rules"])]),_:1}),a(n,{cols:"6"},{default:o(()=>[a(u,{label:"Date de disponibilité *",modelValue:e.consultant.availabilityDate,"onUpdate:modelValue":l[9]||(l[9]=r=>e.consultant.availabilityDate=r),type:"date",rules:[e.required,e.dateRule],required:"",variant:"outlined",color:"primary"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e.loading?(V(),y(E,{key:0,type:"info",class:"mt-4"},{default:o(()=>l[11]||(l[11]=[v("Chargement en cours...")])),_:1})):w("",!0),e.error?(V(),y(E,{key:1,type:"error",class:"mt-4"},{default:o(()=>[v(G(e.error),1)]),_:1})):w("",!0),e.success?(V(),y(E,{key:2,type:"success",class:"mt-4"},{default:o(()=>l[12]||(l[12]=[v("Consultant ajouté avec succès !")])),_:1})):w("",!0),a(X,{class:"d-flex justify-end"},{default:o(()=>[a(_,{color:"primary",onClick:e.submitConsultant},{default:o(()=>l[13]||(l[13]=[v("Modifier")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}const te=L(ee,[["render",le]]),pe=U({__name:"edit-consultant",setup(e){return(l,g)=>(V(),y(te))}});export{pe as default};
