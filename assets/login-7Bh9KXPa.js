import{d as x,a1 as b,r as l,o as v,a as u,c as _,w as n,g as r,e as h,j as p,b as V,h as C,t as B,f as y,V as $,_ as z}from"./index-Ffi5nEiw.js";import{V as I,a as S,b as T}from"./VCard-CwKF1LFO.js";import{V as j}from"./VBtn-7PVO-BoB.js";const E={key:0,class:"text-error mb-4"},R=x({__name:"LoginBtn",setup(g){const o="https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net",s=b(),d=l(null),m=l(!0),c=l(null);function k(){window.location.href=`${o}/.auth/login/github?post_login_redirect_uri=${encodeURIComponent(`${o}/user/token`)}`}return v(async()=>{try{const a=localStorage.getItem("autodo_token");if(a){const t=await fetch(`${o}/user/me`,{headers:{Authorization:`Bearer ${a}`}});if(t.ok){const i=await t.json();d.value=i,s.push("/consultant/list-consultant");return}else localStorage.removeItem("autodo_token")}if(new URLSearchParams(window.location.search).get("redirected")==="true")try{const t=await fetch(`${o}/user/token`,{credentials:"include"});if(!t.ok)throw new Error("Impossible de récupérer le token");const i=await t.json();localStorage.setItem("autodo_token",i.token);const f=await fetch(`${o}/user/me`,{headers:{Authorization:`Bearer ${i.token}`}});if(f.ok){const w=await f.json();d.value=w,s.push("/consultant/list-consultant")}else throw new Error("Token invalide")}catch(t){console.error("Erreur d'authentification:",t),c.value="Échec de l'authentification"}}catch(a){console.error("Erreur d'authentification:",a),c.value="Une erreur s'est produite"}finally{m.value=!1}}),(a,e)=>(u(),_($,{class:"fill-height d-flex align-center justify-center"},{default:n(()=>[r(I,{class:"pa-8",elevation:"12",rounded:"2xl","max-width":"400"},{default:n(()=>[r(S,{class:"text-h5 text-center mb-4"},{default:n(()=>e[0]||(e[0]=[h(" Connexion ")])),_:1}),r(T,{class:"text-center"},{default:n(()=>[r(p,{icon:"mdi-github",size:"56",color:"primary",class:"mb-4"}),e[2]||(e[2]=V("p",{class:"mb-6"}," Connecte-toi avec ton compte GitHub (membre O2do requis). ",-1)),c.value?(u(),C("div",E,B(c.value),1)):y("",!0),r(j,{color:"primary",size:"large",rounded:"",onClick:k,loading:m.value},{default:n(()=>[r(p,{start:"",icon:"mdi-login"}),e[1]||(e[1]=h(" Se connecter "))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1}))}}),L={};function N(g,o){const s=R;return u(),_(s)}const q=z(L,[["render",N]]);export{q as default};
