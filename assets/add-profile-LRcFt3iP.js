import{_ as R,V as D}from"./VForm-DQ3cpKHq.js";import{h as P,j as t,a5 as J,O as A,k as F,_ as M,o as f,i as m,w as a,f as o,n as p,q as h,t as E,V as H}from"./index-JP4oIp_E.js";import{V as K,a as O,b as G,c as I}from"./VCard-0SKndsko.js";import{V as Q,a as u}from"./VRow-CAluCcV1.js";import{V}from"./VTextField-BwNjoS2o.js";import{a as g,V as q}from"./VSelect-B9jD7Rq2.js";import{V as W}from"./forwardRefs-DfmRq_29.js";const X=P({name:"AddProfile",components:{GoBackBtn:R},setup(){const e=t({consultantUuid:"",RateHour:null,CV:"",CVDate:"",JobTitle:"",ExperienceLevel:"",Skills:[],keywords:[]}),r=J(),v=["Junior","Medior","Senior"],b=t([]),C=t([]),c=t(null),i="https://example.com/default-cv",s=t(""),S=l=>!!l||"Champ obligatoire",T=l=>!isNaN(l)&&Number(l)>=0||"Entier positif requis",U=l=>/^(https?:\/\/)[^\s$.?#].[^\s]*$/.test(l)||"Lien invalide (ex: https://...)",$=l=>!!l||"Date requise",B=async()=>{try{const l=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/skill");if(!l.ok)throw new Error("Erreur récupération des skills");const n=await l.json();b.value=n.data.map(d=>d.name)}catch(l){console.error("Erreur skills :",l)}},N=async()=>{try{const l=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/keyword");if(!l.ok)throw new Error("Erreur récupération des keywords");const n=await l.json();C.value=n.data.map(d=>d.name)}catch(l){console.error("Erreur keywords :",l)}},L=()=>{if(!e.value.CV||e.value.CV.trim()===""){s.value="";return}s.value=e.value.CV},j=()=>{e.value.CV===i&&(e.value.CV="")},z=()=>{e.value.CV||(e.value.CV=i)};A(()=>e.value.CV,L),F(()=>{const l=sessionStorage.getItem("selectedConsultantUuid");l?e.value.consultantUuid=l:console.error("Aucun consultant sélectionné"),B(),N()});const y=t(!1),w=t(null),k=t(!1);return{profile:e,experienceLevels:v,availableSkills:b,availableKeywords:C,formRef:c,required:S,numberRule:T,urlRule:U,dateRule:$,placeholderCV:i,validCV:s,clearPlaceholder:j,restorePlaceholder:z,submitProfile:async()=>{y.value=!0,w.value=null,k.value=!1;try{if((!e.value.CV||e.value.CV.trim()==="")&&(e.value.CV=i),!c.value)return;const{valid:l}=await c.value.validate();if(!l)return;const n=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/profil",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.value)}),d=await n.json();if(!n.ok)throw new Error(d.message);k.value=d.message,setTimeout(()=>{r.push("/consultant/consultant-info")},1e3)}catch(l){w.value=l instanceof Error?l.message:"Une erreur est survenue"}finally{y.value=!1}},loading:y,error:w,success:k}}});function Y(e,r,v,b,C,c){const i=R;return f(),m(H,null,{default:a(()=>[o(K,{class:"pa-4"},{default:a(()=>[o(i,{class:"mb-4"}),o(O,{class:"text-h5 font-weight-bold"},{default:a(()=>r[7]||(r[7]=[p("Nouveau Profil")])),_:1}),o(G,null,{default:a(()=>[o(D,{ref:"formRef"},{default:a(()=>[o(Q,null,{default:a(()=>[o(u,{cols:"12"},{default:a(()=>[o(V,{label:"Lien du CV *",modelValue:e.profile.CV,"onUpdate:modelValue":r[0]||(r[0]=s=>e.profile.CV=s),variant:"outlined",color:"primary",placeholder:e.placeholderCV,rules:[e.required,e.urlRule],onFocus:e.clearPlaceholder,onBlur:e.restorePlaceholder,required:""},null,8,["modelValue","placeholder","rules","onFocus","onBlur"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(V,{label:"Job Title *",modelValue:e.profile.JobTitle,"onUpdate:modelValue":r[1]||(r[1]=s=>e.profile.JobTitle=s),rules:[e.required],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(g,{label:"Niveau d'expérience *",modelValue:e.profile.ExperienceLevel,"onUpdate:modelValue":r[2]||(r[2]=s=>e.profile.ExperienceLevel=s),items:e.experienceLevels,rules:[e.required],variant:"outlined",color:"primary",required:""},null,8,["modelValue","items","rules"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(V,{label:"Tarif / heure *",modelValue:e.profile.RateHour,"onUpdate:modelValue":r[3]||(r[3]=s=>e.profile.RateHour=s),modelModifiers:{number:!0},type:"number",rules:[e.required,e.numberRule],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(V,{label:"Date du CV *",modelValue:e.profile.CVDate,"onUpdate:modelValue":r[4]||(r[4]=s=>e.profile.CVDate=s),type:"date",rules:[e.required,e.dateRule],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(u,{cols:"12"},{default:a(()=>[o(g,{label:"Compétences *",modelValue:e.profile.Skills,"onUpdate:modelValue":r[5]||(r[5]=s=>e.profile.Skills=s),items:e.availableSkills,multiple:"",chips:"","closable-chips":"",rules:[e.required],variant:"outlined",color:"primary"},null,8,["modelValue","items","rules"])]),_:1}),o(u,{cols:"12"},{default:a(()=>[o(g,{label:"Mots-clés *",modelValue:e.profile.keywords,"onUpdate:modelValue":r[6]||(r[6]=s=>e.profile.keywords=s),items:e.availableKeywords,multiple:"",chips:"","closable-chips":"",rules:[e.required],variant:"outlined",color:"primary"},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e.loading?(f(),m(q,{key:0,type:"info",class:"mt-4"},{default:a(()=>r[8]||(r[8]=[p("Chargement en cours...")])),_:1})):h("",!0),e.error?(f(),m(q,{key:1,type:"error",class:"mt-4"},{default:a(()=>[p(E(e.error),1)]),_:1})):h("",!0),e.success?(f(),m(q,{key:2,type:"success",class:"mt-4"},{default:a(()=>[p(E(e.success),1)]),_:1})):h("",!0),o(I,{class:"d-flex justify-end"},{default:a(()=>[o(W,{color:"primary",onClick:e.submitProfile},{default:a(()=>r[9]||(r[9]=[p("Publier")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}const Z=M(X,[["render",Y]]),te=P({__name:"add-profile",setup(e){return(r,v)=>(f(),m(Z))}});export{te as default};
