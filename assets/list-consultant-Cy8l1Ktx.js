import{V as b,h as j}from"./forwardRefs-B4WBqx-R.js";import{V as _,a as N,b as I,c as S}from"./VCard-Cs1PPY8c.js";import{V as A}from"./VSpacer-CnNV0xHp.js";import{V as B,a as z}from"./VSnackbar-uoS8vTNJ.js";import{h as D,j as u,o as g,s as T,f as e,w as t,n as m,t as V,a5 as M,k as P,_ as L,i as w,l as U,F,z as q,ad as J,a6 as O,a7 as R,x as G,q as h,V as H}from"./index-BJHyyak7.js";import{V as $,a as k}from"./VRow-O0qSftFU.js";const K=D({__name:"DeleteConsultant",props:{consultantUuid:{}},emits:["consultantDeleted"],setup(a,{emit:o}){const c=a,y=o,i=u(!1),p=u(!1),d=u(!1),n=u(""),C=u(""),x=async()=>{if(!c.consultantUuid){n.value="UUID consultant manquant",C.value="red",d.value=!0;return}p.value=!0;try{const v=await fetch(`https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/consultant/${c.consultantUuid}`,{method:"DELETE"}),s=await v.text();let r;try{r=JSON.parse(s)}catch{throw new Error("Erreur serveur : réponse invalide")}if(!v.ok||!r.success)throw new Error(r.message||"Erreur lors de la suppression");y("consultantDeleted",{uuid:c.consultantUuid,message:r.message||"Consultant supprimé avec succès"})}catch(v){n.value=v.message||"Erreur inconnue",C.value="red"}finally{d.value=!0,p.value=!1}};return(v,s)=>(g(),T("div",null,[e(b,{color:"error",variant:"text",icon:"mdi-delete",density:"comfortable",onClick:s[0]||(s[0]=r=>i.value=!0)}),e(B,{modelValue:i.value,"onUpdate:modelValue":s[2]||(s[2]=r=>i.value=r),"max-width":"500"},{default:t(()=>[e(_,null,{default:t(()=>[e(N,{class:"headline"},{default:t(()=>s[4]||(s[4]=[m("Confirmer la suppression")])),_:1}),e(I,null,{default:t(()=>s[5]||(s[5]=[m(" Êtes-vous sûr de vouloir supprimer ce consultant ? ")])),_:1}),e(S,null,{default:t(()=>[e(A),e(b,{color:"grey",onClick:s[1]||(s[1]=r=>i.value=!1)},{default:t(()=>s[6]||(s[6]=[m("Annuler")])),_:1}),e(b,{color:"red",loading:p.value,onClick:x},{default:t(()=>s[7]||(s[7]=[m("Supprimer")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(z,{modelValue:d.value,"onUpdate:modelValue":s[3]||(s[3]=r=>d.value=r),color:C.value,timeout:"3000"},{default:t(()=>[m(V(n.value),1)]),_:1},8,["modelValue","color"])]))}}),Q=D({name:"ConsultantGrid",setup(){const a=u([]),o=u(!1),c=u(null),y=M(),i=u(!1),p=u(""),d=u("green"),n="https://via.placeholder.com/150?text=No+Image",C=async()=>{o.value=!0;try{const l=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/consultant");if(!l.ok)throw new Error("Failed to fetch consultants");const f=await l.json();if(f.success&&Array.isArray(f.data))a.value=f.data;else throw new Error("Invalid data format")}catch(l){c.value=l.message||"Unknown error"}finally{o.value=!1}},x=({uuid:l,message:f})=>{a.value=a.value.filter(E=>E.consultantUuid!==l),p.value=f,d.value="green",i.value=!0},v=async l=>{try{if(!(await fetch(`https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/consultant/${l}`,{method:"DELETE"})).ok)throw new Error("Erreur lors de la suppression");a.value=a.value.filter(E=>E.consultantUuid!==l)}catch(f){console.error(f.message)}},s=l=>{sessionStorage.setItem("selectedConsultant",JSON.stringify(l)),y.push("/consultant/consultant-info")},r=l=>{l.target.src=n};return P(()=>{C()}),{consultants:a,loading:o,error:c,snackbar:i,snackbarMessage:p,snackbarColor:d,deleteConsultant:v,goToConsultantProfiles:s,defaultImage:n,setPlaceholder:r,handleConsultantDeleted:x}}}),W={class:"text-caption grey--text"};function X(a,o,c,y,i,p){const d=K;return g(),w(H,null,{default:t(()=>[e($,{justify:"center"},{default:t(()=>[e(k,{cols:"12",class:"text-center mb-6"},{default:t(()=>o[3]||(o[3]=[U("h2",{class:"purple--text"},"A perfect blend of genius and caffeine",-1)])),_:1}),(g(!0),T(F,null,q(a.consultants,n=>(g(),w(k,{key:n.consultantUuid,cols:"12",sm:"4",md:"2",class:"text-center"},{default:t(()=>[e(_,{class:"consultant-card",elevation:"3",onClick:C=>a.goToConsultantProfiles(n)},{default:t(()=>[e(d,{consultantUuid:n.consultantUuid,onClick:o[0]||(o[0]=J(()=>{},["stop"])),onConsultantDeleted:a.handleConsultantDeleted},null,8,["consultantUuid","onConsultantDeleted"]),e(I,{class:"d-flex flex-column align-center justify-center"},{default:t(()=>[e(O,{size:"150"},{default:t(()=>[e(R,{src:n.picture?n.picture:a.defaultImage,alt:"Photo Consultant",contain:""},null,8,["src"])]),_:2},1024),U("div",null,V(n.name)+" "+V(n.surname),1),U("div",W,V(n.email),1)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128)),e(k,{cols:"12",sm:"4",md:"2",class:"text-center"},{default:t(()=>[e(_,{outlined:"",class:"consultant-card d-flex flex-column align-center justify-center"},{default:t(()=>[e(b,{onClick:o[1]||(o[1]=n=>a.$router.push("/consultant/add-consultant")),icon:"",color:"primary"},{default:t(()=>[e(G,{large:""},{default:t(()=>o[4]||(o[4]=[m("mdi-plus-circle")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a.loading?(g(),w($,{key:0,justify:"center"},{default:t(()=>[e(k,{cols:"12",class:"text-center"},{default:t(()=>[e(j,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):h("",!0),a.error?(g(),w($,{key:1,justify:"center"},{default:t(()=>[e(k,{cols:"12",class:"text-center red--text"},{default:t(()=>[m(V(a.error),1)]),_:1})]),_:1})):h("",!0),e(z,{modelValue:a.snackbar,"onUpdate:modelValue":o[2]||(o[2]=n=>a.snackbar=n),color:a.snackbarColor,timeout:"3000"},{default:t(()=>[m(V(a.snackbarMessage),1)]),_:1},8,["modelValue","color"])]),_:1})}const Y=L(Q,[["render",X],["__scopeId","data-v-201e27d1"]]),oe=D({__name:"list-consultant",setup(a){return(o,c)=>(g(),w(Y))}});export{oe as default};
