import{h as I,a5 as P,j as u,k as A,o as m,i as D,w as t,f as e,x as L,n as s,a6 as h,a7 as F,l as k,t as d,s as x,q as E,_ as $,V as R,F as j}from"./index-BJHyyak7.js";import{V}from"./forwardRefs-B4WBqx-R.js";import{a as z,b as O,c as B,V as J}from"./VCard-Cs1PPY8c.js";import{V as q,a as g}from"./VRow-O0qSftFU.js";import{V as H}from"./VSpacer-CnNV0xHp.js";import{V as G,a as M}from"./VSnackbar-uoS8vTNJ.js";import{V as N}from"./VSelect-BhpJF4Ay.js";import{V as K}from"./VTextField-D9gaevoI.js";import{V as Q}from"./VDataTable-u7T_T4cZ.js";const W={key:1},X=I({__name:"ConsultantInfo",setup(U){const y=P(),o=u(null),c=()=>{o.value&&(sessionStorage.setItem("editConsultant",JSON.stringify(o.value)),y.push("/consultant/edit-consultant"))};return A(()=>{const f=sessionStorage.getItem("selectedConsultant");f&&(o.value=JSON.parse(f))}),(f,l)=>o.value?(m(),D(J,{key:0,class:"pa-4 mb-4"},{default:t(()=>[e(V,{to:"/consultant/list-consultant",class:"back-btn",outlined:"",color:"primary",size:"small",icon:""},{default:t(()=>[e(L,null,{default:t(()=>l[0]||(l[0]=[s("mdi-arrow-left")])),_:1})]),_:1}),e(z,null,{default:t(()=>l[1]||(l[1]=[s(" Informations du Consultant ")])),_:1}),e(O,null,{default:t(()=>[e(q,null,{default:t(()=>[e(g,{cols:"12"},{default:t(()=>[e(h,{size:"150"},{default:t(()=>[e(F,{src:o.value.picture,alt:"Photo Consultant",contain:""},null,8,["src"])]),_:1})]),_:1}),e(g,{cols:"12",sm:"6"},{default:t(()=>[l[2]||(l[2]=k("strong",null,"Prénom et nom :",-1)),s(" "+d(o.value.surname)+" "+d(o.value.name),1)]),_:1}),e(g,{cols:"12",sm:"6"},{default:t(()=>[l[3]||(l[3]=k("strong",null,"Email :",-1)),s(" "+d(o.value.email),1)]),_:1}),e(g,{cols:"12",sm:"6"},{default:t(()=>[l[4]||(l[4]=k("strong",null,"Téléphone :",-1)),s(" "+d(o.value.phone),1)]),_:1}),e(g,{cols:"12",sm:"6"},{default:t(()=>[l[5]||(l[5]=k("strong",null,"Entreprise :",-1)),s(" "+d(o.value.enterprise),1)]),_:1}),e(g,{cols:"12",sm:"6"},{default:t(()=>[l[6]||(l[6]=k("strong",null,"Interne :",-1)),s(" "+d(o.value.intern?"Oui":"Non"),1)]),_:1}),e(g,{cols:"12",sm:"6"},{default:t(()=>[l[7]||(l[7]=k("strong",null,"Date de disponibilité :",-1)),s(" "+d(o.value.availabilityDate),1)]),_:1}),e(g,{cols:"12",sm:"6"},{default:t(()=>[l[8]||(l[8]=k("strong",null,"Date d'expiration CI :",-1)),s(" "+d(o.value.expirationDateCI),1)]),_:1}),e(g,{cols:"12"},{default:t(()=>[l[10]||(l[10]=k("strong",null,"Copie de la carte d'identité : ",-1)),o.value.copyCI?(m(),D(V,{key:0,href:o.value.copyCI,"prepend-icon":"mdi-file",target:"_blank",variant:"outlined",color:"primary"},{default:t(()=>l[9]||(l[9]=[s(" Voir le document ")])),_:1},8,["href"])):(m(),x("span",W,"Non disponible"))]),_:1})]),_:1})]),_:1}),e(B,{class:"d-flex justify-end"},{default:t(()=>[e(V,{color:"primary",variant:"tonal",icon:"mdi-pencil",onClick:c})]),_:1})]),_:1})):E("",!0)}}),Y=$(X,[["__scopeId","data-v-82c8eb33"]]),Z=I({__name:"DeleteProfile",props:{profileUuid:{}},emits:["profileDeleted"],setup(U,{emit:y}){const o=U,c=y,f=u(!1),l=u(!1),C=u(!1),b=u(""),v=u("");P();const S=async()=>{if(!o.profileUuid){b.value="UUID profil manquant",v.value="red",C.value=!0;return}l.value=!0;try{const _=await fetch(`https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/profil/${o.profileUuid}`,{method:"DELETE"}),a=await _.text();let i;try{i=JSON.parse(a)}catch{throw new Error("Erreur serveur : réponse invalide")}if(!_.ok||!i.success)throw new Error(i.message||"Erreur lors de la suppression");c("profileDeleted",{uuid:o.profileUuid,message:i.message||"Profile supprimé avec succès"})}catch(_){b.value=_.message||"Erreur inconnue",v.value="red"}finally{C.value=!0,l.value=!1}};return(_,a)=>(m(),x("div",null,[e(V,{color:"error",icon:"mdi-delete",density:"comfortable",onClick:a[0]||(a[0]=i=>f.value=!0)}),e(G,{modelValue:f.value,"onUpdate:modelValue":a[2]||(a[2]=i=>f.value=i),"max-width":"500"},{default:t(()=>[e(J,null,{default:t(()=>[e(z,{class:"headline"},{default:t(()=>a[4]||(a[4]=[s("Confirmer la suppression")])),_:1}),e(O,null,{default:t(()=>a[5]||(a[5]=[s(" Êtes-vous sûr de vouloir supprimer ce profil ? ")])),_:1}),e(B,null,{default:t(()=>[e(H),e(V,{color:"grey",onClick:a[1]||(a[1]=i=>f.value=!1)},{default:t(()=>a[6]||(a[6]=[s("Annuler")])),_:1}),e(V,{color:"red",loading:l.value,onClick:S},{default:t(()=>a[7]||(a[7]=[s("Supprimer")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(M,{modelValue:C.value,"onUpdate:modelValue":a[3]||(a[3]=i=>C.value=i),color:v.value,timeout:"3000"},{default:t(()=>[s(d(b.value),1)]),_:1},8,["modelValue","color"])]))}}),ee=["href"],te={key:1},le=I({__name:"TableProfile",setup(U){const y=P(),o=u([]),c=u(null),f=u(""),l=u(!1),C=u(""),b=u("");u(null);const v=u(null);A(()=>{const r=sessionStorage.getItem("selectedConsultant");r?(v.value=JSON.parse(r),i()):c.value="Aucun consultant sélectionné."});const S=()=>{v.value?(sessionStorage.setItem("selectedConsultantUuid",v.value.consultantUuid),y.push("/profile/add-profile")):c.value="Aucun consultant sélectionné."},_=({uuid:r,message:p})=>{r?(o.value=o.value.filter(n=>n.profileUuid!==r),b.value="success"):b.value="error",C.value=p,l.value=!0,r&&i()},a=u([{key:"jobTitle",title:"Titre du poste",align:"start"},{key:"experienceLevel",title:"Expérience",align:"start"},{key:"rateHour",title:"Tarif / heure",align:"end"},{key:"cv",title:"Lien CV",align:"center"},{key:"cvDate",title:"Date CV",align:"end"},{key:"skills",title:"Compétences",align:"start"},{key:"keywords",title:"Mots-clés",align:"start"},{key:"actions",title:"Modifier",align:"center"},{key:"actionsSupp",title:"Supprimer",align:"center"}]),i=async()=>{if(!v.value){c.value="Aucun consultant trouvé.";return}try{const r=await fetch(`https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/profil/consultant/${v.value.consultantUuid}`);if(!r.ok)throw new Error("Erreur lors de la récupération des profils");const{data:p}=await r.json();o.value=p}catch(r){c.value=r instanceof Error?r.message:"Une erreur est survenue"}},T=r=>{localStorage.setItem("selectedProfile",JSON.stringify(r)),y.push({path:"/profile/edit-profile"})};return(r,p)=>(m(),x(j,null,[e(R,null,{default:t(()=>[p[3]||(p[3]=k("h1",{class:"text-center mb-6"},"Liste des Profils",-1)),e(V,{onClick:S,icon:"mdi-plus",color:"primary",class:"mb-4"}),c.value?(m(),D(N,{key:0,type:"error",variant:"outlined",class:"mb-4"},{default:t(()=>[s(d(c.value),1)]),_:1})):E("",!0),e(K,{modelValue:f.value,"onUpdate:modelValue":p[0]||(p[0]=n=>f.value=n),label:"Rechercher un profil","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":"",class:"mb-4"},null,8,["modelValue"]),e(Q,{headers:a.value,items:o.value,search:f.value,"item-value":"consultantUuid",class:"elevation-2"},{"item.cv":t(({item:n})=>[n.cv&&n.cv.trim()!==""?(m(),x("a",{key:0,href:n.cv,target:"_blank"},"Voir le CV",8,ee)):(m(),x("span",te,"Non disponible"))]),"item.skills":t(({item:n})=>{var w;return[s(d((w=n.skills)!=null&&w.length?n.skills.join(", "):"Aucune compétence"),1)]}),"item.keywords":t(({item:n})=>{var w;return[s(d((w=n.keywords)!=null&&w.length?n.keywords.join(", "):"Aucun mot-clé"),1)]}),"item.actions":t(({item:n})=>[e(V,{color:"primary",onClick:w=>T(n),icon:"mdi-pencil",density:"comfortable"},null,8,["onClick"])]),"item.actionsSupp":t(({item:n})=>[e(Z,{profileUuid:n.profileUuid,onProfileDeleted:_},null,8,["profileUuid"])]),_:1},8,["headers","items","search"]),!o.value.length&&!c.value?(m(),D(N,{key:1,type:"info",class:"mt-4"},{default:t(()=>p[2]||(p[2]=[s(" Aucun profil disponible. ")])),_:1})):E("",!0)]),_:1}),e(M,{modelValue:l.value,"onUpdate:modelValue":p[1]||(p[1]=n=>l.value=n),color:b.value,timeout:"3000"},{default:t(()=>[s(d(C.value),1)]),_:1},8,["modelValue","color"])],64))}}),oe=$(le,[["__scopeId","data-v-fc58e662"]]),ce=I({__name:"consultant-info",setup(U){return(y,o)=>(m(),x(j,null,[e(Y),e(oe)],64))}});export{ce as default};
