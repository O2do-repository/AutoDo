import{_ as P,V as A}from"./VAutocomplete-vBOt-nic.js";import{d as R,ab as J,r as d,P as U,o as L,_ as M,a as V,c as y,w as o,g as t,e as v,ac as G,ad as K,f as w,t as D,j as W,V as H}from"./index-D-Inbi5U.js";import{f as q}from"./fetchWithApiKey-puCv6LHg.js";import{V as Q,a as X,b as Y,c as Z}from"./VCard-D2J_XjvE.js";import{V as x}from"./VForm-O3Sno3Kz.js";import{a as _,V as n}from"./VRow-CxmJ-ldm.js";import{V as u}from"./VTextField-Xr4deW5K.js";import{V as ee}from"./VSwitch-C72mDwIj.js";import{V as le}from"./VTextarea-GILDFczO.js";import{V as I}from"./VAlert-BJkg2Izn.js";import"./filter-D2Osl6aZ.js";import"./VChip-CevWF3Km.js";const te=R({name:"EditConsultant",components:{GoBackBtn:P},setup(){const l=J(),e=d({email:"",availabilityDate:"",expirationDateCI:"",intern:!1,name:"",surname:"",enterprise:"",phone:"",copyCI:"",picture:"",comment:""}),C=d([]),b=d(null),g=d(!1),h=d(null),m=d(!1),r=a=>(a==null?void 0:a.trim())!==""||"Champ obligatoire",k=a=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)||"Format invalide (ex: exemple@mail.com)",$=a=>/^\+?[0-9]{9,15}$/.test(a)||"Format invalide (ex: +32444332211)",T=a=>/^(https?:\/\/)[^\s$.?#].[^\s]*$/.test(a)||"Lien invalide (ex: https://...)",B=a=>/^(https?:\/\/.*)/i.test(a)||"Lien invalide (ex: https://site.com/image)",N=a=>!!a||"Veuillez choisir une date",s="https://static.vecteezy.com/system/resources/thumbnails/003/337/584/small/default-avatar-photo-placeholder-profile-icon-vector.jpg",p=d(s),E=()=>{if(!e.value.picture||e.value.picture.trim()===""){p.value=s;return}const a=new Image;a.src=e.value.picture,a.onload=()=>{p.value=e.value.picture},a.onerror=()=>{p.value=s}},S=()=>{e.value.picture===s&&(e.value.picture="")},j=()=>{e.value.picture||(e.value.picture=s)},z=()=>{p.value=s};U(()=>e.value.picture,E),U(()=>e.value.intern,a=>{a?e.value.enterprise="O2do":e.value.enterprise=""});const F=async()=>{try{const a=await q("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/enterprise");if(!a.ok)throw new Error("Erreur lors du chargement des entreprises");const i=await a.json();C.value=i.data}catch(a){console.error("Erreur fetch entreprises :",a)}},O=async()=>{g.value=!0,h.value=null,m.value=!1;try{if((!e.value.picture||e.value.picture.trim()==="")&&(e.value.picture=s),e.value.expirationDateCI===""&&(e.value.expirationDateCI=null),!b.value)return;const{valid:a}=await b.value.validate();if(!a)return;const i=await q("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/consultant",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.value)}),c=await i.json();if(!i.ok)throw new Error(c.message);sessionStorage.setItem("editConsultant",JSON.stringify(e.value)),sessionStorage.setItem("selectedConsultant",JSON.stringify(e.value)),m.value=c.message,setTimeout(()=>{l.push("/consultant/consultant-info")},1e3)}catch(a){h.value=a instanceof Error?a.message:"Une erreur est survenue"}finally{g.value=!1}};return L(()=>{var i,c;F();const a=sessionStorage.getItem("editConsultant");if(a){const f=JSON.parse(a);f.expirationDateCI=((i=f.expirationDateCI)==null?void 0:i.split("T")[0])||"",f.availabilityDate=((c=f.availabilityDate)==null?void 0:c.split("T")[0])||"",Object.assign(e.value,f),E()}}),{consultant:e,enterprises:C,formRef:b,validPicture:p,required:r,emailRule:k,phoneRule:$,urlRule:T,imageUrlRule:B,dateRule:N,clearPlaceholder:S,restorePlaceholder:j,setPlaceholder:z,submitConsultant:O,placeholderImage:s,loading:g,error:h,success:m}}});function ae(l,e,C,b,g,h){const m=P;return V(),y(H,null,{default:o(()=>[t(Q,{class:"pa-4"},{default:o(()=>[t(m,{class:"mb-4"}),t(X,{class:"text-h5 font-weight-bold"},{default:o(()=>e[11]||(e[11]=[v("Modifier Consultant")])),_:1}),t(Y,null,{default:o(()=>[t(x,{ref:"formRef"},{default:o(()=>[t(_,null,{default:o(()=>[t(n,{cols:"12",class:"d-flex flex-column align-center"},{default:o(()=>[t(G,{size:"150"},{default:o(()=>[t(K,{src:l.validPicture,alt:"Photo Consultant",contain:"",onError:l.setPlaceholder},null,8,["src","onError"])]),_:1})]),_:1}),t(n,{cols:"12"},{default:o(()=>[t(u,{variant:"outlined",color:"primary",label:"Lien Photo *",modelValue:l.consultant.picture,"onUpdate:modelValue":e[0]||(e[0]=r=>l.consultant.picture=r),placeholder:l.placeholderImage,rules:[l.required,l.imageUrlRule],onFocus:l.clearPlaceholder,onBlur:l.restorePlaceholder},null,8,["modelValue","placeholder","rules","onFocus","onBlur"])]),_:1}),t(n,{cols:"6"},{default:o(()=>[t(u,{label:"Prénom *",modelValue:l.consultant.surname,"onUpdate:modelValue":e[1]||(e[1]=r=>l.consultant.surname=r),rules:[l.required],required:"",variant:"outlined",color:"primary"},null,8,["modelValue","rules"])]),_:1}),t(n,{cols:"6"},{default:o(()=>[t(u,{label:"Nom *",modelValue:l.consultant.name,"onUpdate:modelValue":e[2]||(e[2]=r=>l.consultant.name=r),rules:[l.required],required:"",variant:"outlined",color:"primary"},null,8,["modelValue","rules"])]),_:1}),t(n,{cols:"6"},{default:o(()=>[t(u,{label:"Lien Copie CI",modelValue:l.consultant.copyCI,"onUpdate:modelValue":e[3]||(e[3]=r=>l.consultant.copyCI=r),variant:"outlined",color:"primary"},null,8,["modelValue"])]),_:1}),t(n,{cols:"6"},{default:o(()=>[t(u,{label:"Expiration CI",modelValue:l.consultant.expirationDateCI,"onUpdate:modelValue":e[4]||(e[4]=r=>l.consultant.expirationDateCI=r),type:"date",variant:"outlined",color:"primary"},null,8,["modelValue"])]),_:1}),t(n,{cols:"6"},{default:o(()=>[t(ee,{label:"Interne",modelValue:l.consultant.intern,"onUpdate:modelValue":e[5]||(e[5]=r=>l.consultant.intern=r),color:"primary"},null,8,["modelValue"])]),_:1}),t(n,{cols:"6"},{default:o(()=>[t(A,{label:"Entreprise *",modelValue:l.consultant.enterprise,"onUpdate:modelValue":e[6]||(e[6]=r=>l.consultant.enterprise=r),items:l.enterprises,"item-title":"name","item-value":"name",rules:[l.required],variant:"outlined",color:"primary",disabled:!!l.consultant.intern},null,8,["modelValue","items","rules","disabled"])]),_:1}),t(n,{cols:"6"},{default:o(()=>[t(u,{label:"Email *",modelValue:l.consultant.email,"onUpdate:modelValue":e[7]||(e[7]=r=>l.consultant.email=r),rules:[l.required,l.emailRule],required:"",variant:"outlined",color:"primary"},null,8,["modelValue","rules"])]),_:1}),t(n,{cols:"6"},{default:o(()=>[t(u,{label:"Téléphone *",modelValue:l.consultant.phone,"onUpdate:modelValue":e[8]||(e[8]=r=>l.consultant.phone=r),rules:[l.required,l.phoneRule],required:"",variant:"outlined",color:"primary"},null,8,["modelValue","rules"])]),_:1}),t(n,{cols:"6"},{default:o(()=>[t(u,{label:"Date de disponibilité *",modelValue:l.consultant.availabilityDate,"onUpdate:modelValue":e[9]||(e[9]=r=>l.consultant.availabilityDate=r),type:"date",rules:[l.required,l.dateRule],required:"",variant:"outlined",color:"primary"},null,8,["modelValue","rules"])]),_:1}),t(n,{cols:"6"},{default:o(()=>[t(le,{clearable:"",label:"Note",variant:"outlined",color:"primary",rows:"1","auto-grow":"",modelValue:l.consultant.comment,"onUpdate:modelValue":e[10]||(e[10]=r=>l.consultant.comment=r)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},512)]),_:1}),l.loading?(V(),y(I,{key:0,type:"info",class:"mt-4"},{default:o(()=>e[12]||(e[12]=[v("Chargement en cours...")])),_:1})):w("",!0),l.error?(V(),y(I,{key:1,type:"error",class:"mt-4"},{default:o(()=>[v(D(l.error),1)]),_:1})):w("",!0),l.success?(V(),y(I,{key:2,type:"success",class:"mt-4"},{default:o(()=>[v(D(l.success),1)]),_:1})):w("",!0),t(Z,{class:"d-flex justify-end"},{default:o(()=>[t(W,{color:"primary",onClick:l.submitConsultant},{default:o(()=>e[13]||(e[13]=[v("Modifier")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}const oe=M(te,[["render",ae]]),ye=R({__name:"edit-consultant",setup(l){return(e,C)=>(V(),y(oe))}});export{ye as default};
