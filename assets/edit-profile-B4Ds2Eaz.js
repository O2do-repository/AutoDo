import{_ as R,V as J}from"./VForm-D-vx999P.js";import{d as $,r as t,a1 as F,J as H,o as K,_ as A,a as p,c,w as a,e as d,t as E,f as V,g as o,V as G}from"./index-B1mgH4_e.js";import{V as b}from"./VAlert-BXiDL6gI.js";import{V as O,a as I,b as Q,c as W}from"./VCard-BbynzqBI.js";import{a as X,V as u}from"./VRow-GjXUJkfB.js";import{V as y}from"./VTextField-m7tJBNf0.js";import{V as T}from"./VSelect-DhH1Tacz.js";import{V as Y}from"./VBtn-Bagz_ZtH.js";import"./forwardRefs-Wa_6Fwro.js";const Z=$({name:"EditProfile",components:{GoBackBtn:R},setup(){const e=localStorage.getItem("selectedProfile"),l=t(e?JSON.parse(e):{profileUuid:"",rateHour:null,cv:"",cvDate:"",jobTitle:"",experienceLevel:"",skills:[],keywords:[]}),w=F(),m=["Junior","Medior","Senior"],k=t([]),g=t([]),f=t(null),s=t(null),v="https://example.com/default-cv",h=t(""),B=r=>!!r||"Champ obligatoire",N=r=>!isNaN(r)&&Number(r)>=0||"Entier positif requis",S=r=>/^(https?:\/\/)[^\s$.?#].[^\s]*$/.test(r)||"Lien invalide (ex: https://...)",j=r=>!!r||"Date requise",U=()=>{if(!l.value.cv||l.value.cv.trim()===""){h.value="";return}h.value=l.value.cv},M=()=>{l.value.cv===v&&(l.value.cv="")},L=()=>{l.value.cv||(l.value.cv=v)};H(()=>l.value.cv,U);const z=async()=>{try{const r=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/skill",{credentials:"include"});if(!r.ok)throw new Error("Erreur récupération des skills");const i=await r.json();k.value=i.data.map(n=>n.name)}catch(r){console.error("Erreur skills :",r)}},D=async()=>{try{const r=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/keyword",{credentials:"include"});if(!r.ok)throw new Error("Erreur récupération des keywords");const i=await r.json();g.value=i.data.map(n=>n.name)}catch(r){console.error("Erreur keywords :",r)}};K(()=>{z(),D(),U()});const C=t(!1),q=t(null),P=t(!1);return{profile:l,experienceLevels:m,availableSkills:k,availableKeywords:g,formRef:f,required:B,numberRule:N,urlRule:S,dateRule:j,placeholderCV:v,validCV:h,clearPlaceholder:M,restorePlaceholder:L,submitProfile:async()=>{C.value=!0,q.value=null,P.value=!1;try{if((!l.value.cv||l.value.cv.trim()==="")&&(l.value.cv=v),!f.value)return;const{valid:r}=await f.value.validate();if(!r)return;const i=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/profil",{credentials:"include",method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l.value)}),n=await i.json();if(!i.ok)throw new Error(n.message);P.value=n.message,setTimeout(()=>{w.push("/consultant/consultant-info")},1e3)}catch(r){q.value=r instanceof Error?r.message:"Une erreur est survenue"}finally{C.value=!1}},errorMessage:s,loading:C,error:q,success:P}}});function x(e,l,w,m,k,g){const f=R;return p(),c(G,null,{default:a(()=>[e.errorMessage?(p(),c(b,{key:0,closable:"",type:"error",variant:"outlined",class:"mb-4"},{default:a(()=>[d(E(e.errorMessage),1)]),_:1})):V("",!0),o(O,{class:"pa-4"},{default:a(()=>[o(f,{class:"mb-4"}),o(I,{class:"text-h5 font-weight-bold"},{default:a(()=>l[7]||(l[7]=[d("Modifier le Profil")])),_:1}),o(Q,null,{default:a(()=>[o(J,{ref:"formRef"},{default:a(()=>[o(X,null,{default:a(()=>[o(u,{cols:"12"},{default:a(()=>[o(y,{label:"CV URL *",modelValue:e.profile.cv,"onUpdate:modelValue":l[0]||(l[0]=s=>e.profile.cv=s),variant:"outlined",color:"primary",placeholder:e.placeholderCV,rules:[e.required,e.urlRule],onFocus:e.clearPlaceholder,onBlur:e.restorePlaceholder,required:""},null,8,["modelValue","placeholder","rules","onFocus","onBlur"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(y,{label:"Job Title *",modelValue:e.profile.jobTitle,"onUpdate:modelValue":l[1]||(l[1]=s=>e.profile.jobTitle=s),rules:[e.required],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(T,{label:"Niveau d'expérience *",modelValue:e.profile.experienceLevel,"onUpdate:modelValue":l[2]||(l[2]=s=>e.profile.experienceLevel=s),items:e.experienceLevels,rules:[e.required],variant:"outlined",color:"primary",required:""},null,8,["modelValue","items","rules"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(y,{label:"Tarif / heure *",modelValue:e.profile.rateHour,"onUpdate:modelValue":l[3]||(l[3]=s=>e.profile.rateHour=s),modelModifiers:{number:!0},type:"number",rules:[e.required,e.numberRule],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(y,{label:"Date du CV *",modelValue:e.profile.cvDate,"onUpdate:modelValue":l[4]||(l[4]=s=>e.profile.cvDate=s),type:"date",rules:[e.required,e.dateRule],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(u,{cols:"12"},{default:a(()=>[o(T,{label:"Compétences *",modelValue:e.profile.skills,"onUpdate:modelValue":l[5]||(l[5]=s=>e.profile.skills=s),items:e.availableSkills,multiple:"",chips:"","closable-chips":"",rules:[e.required],variant:"outlined",color:"primary"},null,8,["modelValue","items","rules"])]),_:1}),o(u,{cols:"12"},{default:a(()=>[o(T,{label:"Mots-clés *",modelValue:e.profile.keywords,"onUpdate:modelValue":l[6]||(l[6]=s=>e.profile.keywords=s),items:e.availableKeywords,multiple:"",chips:"","closable-chips":"",rules:[e.required],variant:"outlined",color:"primary"},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e.loading?(p(),c(b,{key:0,type:"info",class:"mt-4"},{default:a(()=>l[8]||(l[8]=[d("Chargement en cours...")])),_:1})):V("",!0),e.error?(p(),c(b,{key:1,type:"error",class:"mt-4"},{default:a(()=>[d(E(e.error),1)]),_:1})):V("",!0),e.success?(p(),c(b,{key:2,type:"success",class:"mt-4"},{default:a(()=>[d(E(e.success),1)]),_:1})):V("",!0),o(W,{class:"d-flex justify-end"},{default:a(()=>[o(Y,{color:"primary",onClick:e.submitProfile},{default:a(()=>l[9]||(l[9]=[d("Publier")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}const _=A(Z,[["render",x]]),de=$({__name:"edit-profile",setup(e){return(l,w)=>{const m=_;return p(),c(m)}}});export{de as default};
