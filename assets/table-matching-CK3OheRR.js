import{f as B}from"./fetchWithApiKey-CJzxDa4E.js";import{s as ee,u as te,x as ae,U as le,ag as se,z as M,A as oe,ah as ne,g as s,B as J,d as G,r as b,o as q,a as p,h as x,w as a,e as i,k as w,j as $,c as C,az as re,t as c,b as m,aO as ie,F as N,ab as ue,aP as ce,f as S,m as O,V as de,p as H,aQ as me,_ as fe}from"./index-CtwiEmZS.js";import{V as X,a as Y,b as Z}from"./VCard-d6g3d6KS.js";import{V as E}from"./VAlert-Ba2DNq0Q.js";import{V as pe,a as ve}from"./VDialog-BMLurKa2.js";import{m as be,u as ge,a as K,V as he}from"./VTextField-D2rKWWMS.js";import{V as Q}from"./VChip-CRi9kMOx.js";import{V as ke}from"./VDataTable-0oXrsN06.js";import{h as Ve,g as W,a as ye}from"./filter-Drl8NiY5.js";import{V as xe}from"./VTextarea-BjTMpKYh.js";const _e=ee({...be(),...te(Ve(),["inline"])},"VCheckbox"),Te=ae()({name:"VCheckbox",inheritAttrs:!1,props:_e(),emits:{"update:modelValue":v=>!0,"update:focused":v=>!0},setup(v,V){let{attrs:u,slots:g}=V;const d=le(v,"modelValue"),{isFocused:k,focus:j,blur:h}=ge(v),o=se(),_=M(()=>v.id||`checkbox-${o}`);return oe(()=>{const[A,T]=ne(u),D=K.filterProps(v),U=W.filterProps(v);return s(K,J({class:["v-checkbox",v.class]},A,D,{modelValue:d.value,"onUpdate:modelValue":F=>d.value=F,id:_.value,focused:k.value,style:v.style}),{...g,default:F=>{let{id:P,messagesId:R,isDisabled:L,isReadonly:t,isValid:e}=F;return s(W,J(U,{id:P.value,"aria-describedby":R.value,disabled:L.value,readonly:t.value},T,{error:e.value===!1,modelValue:d.value,"onUpdate:modelValue":n=>d.value=n,onFocus:j,onBlur:h}),g)}})}),{}}}),we={key:2,style:{"white-space":"pre-line"}},Ce={class:"mb-4"},je={class:"mb-4"},Ue={class:"mb-4"},Fe={class:"mb-4"},$e={class:"text-grey"},ze={key:3},Se=G({__name:"HoverFeedback",props:{matchingUuid:{}},setup(v){const V=v,u=b(null),g=b(!1),d=b(null),k=b(!1);return q(async()=>{g.value=!0,d.value=null;try{const h=await B(`https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matchingfeedback/${V.matchingUuid}`),o=await h.json();if(!h.ok)throw new Error((o==null?void 0:o.message)||"Erreur de récupération du feedback");u.value=o==null?void 0:o.data}catch(h){d.value=h instanceof Error?h.message:"Impossible de charger le feedback."}finally{g.value=!1}}),(h,o)=>(p(),x(N,null,[s(w,{color:"primary",size:"small",onClick:o[0]||(o[0]=_=>k.value=!0)},{default:a(()=>o[3]||(o[3]=[i(" mdi-comment-text-multiple-outline ")])),_:1}),s(pe,{modelValue:k.value,"onUpdate:modelValue":o[2]||(o[2]=_=>k.value=_),"max-width":"800"},{default:a(()=>[s(X,null,{default:a(()=>[s($,{onClick:o[1]||(o[1]=_=>k.value=!1),outlined:"",color:"primary",size:"small",class:"ml-3 mt-2",icon:""},{default:a(()=>[s(w,null,{default:a(()=>o[4]||(o[4]=[i("mdi-arrow-left")])),_:1})]),_:1}),s(Y,null,{default:a(()=>o[5]||(o[5]=[i(" Feedback de matching ")])),_:1}),s(Z,null,{default:a(()=>[g.value?(p(),C(re,{key:0,indeterminate:"",color:"primary"})):d.value?(p(),C(E,{key:1,type:"error",dense:""},{default:a(()=>[i(c(d.value),1)]),_:1})):u.value?(p(),x("div",we,[o[6]||(o[6]=m("strong",null,"Score total :",-1)),i(" "+c(u.value.totalScore)+" ",1),s(ie,{class:"my-2"}),m("strong",null,"Job Title ("+c(u.value.jobTitleScore)+"/20)",1),m("div",Ce,c(u.value.jobTitleFeedback),1),m("strong",null,"Expérience ("+c(u.value.experienceScore)+"/20)",1),m("div",je,c(u.value.experienceFeedback),1),m("strong",null,"Compétences ("+c(u.value.skillsScore)+"/40)",1),m("div",Ue,c(u.value.skillsFeedback),1),m("strong",null,"Localisation ("+c(u.value.locationScore)+"/20)",1),m("div",Fe,c(u.value.locationFeedback),1),m("em",$e,"Dernière mise à jour : "+c(new Date(u.value.lastUpdatedAt).toLocaleString("fr-FR")),1)])):(p(),x("span",ze,"Aucun feedback disponible."))]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),Me={class:"d-flex align-center mb-4"},Ee={class:"text-h5"},Ae={class:"text-subtitle-1 mb-2"},De=["href"],Pe={key:0},Re=G({__name:"TableMatching",setup(v){ue();const V=b([]),u=b(null),g=b(""),d=b([]),k=b(!1),j=b(""),h=b("success"),o=b([{key:"edit",title:"",align:"center"},{key:"rfpReference",title:"Référence RFP",align:"start"},{key:"score",title:"Score",align:"end"},{key:"publicationDate",title:"Date de publication",align:"start"},{key:"statutMatching",title:"Statut",align:"start"},{key:"comment",title:"Commentaire",align:"start"},{key:"feedback",title:"Feedback ",align:"center"}]),_=async()=>{try{const t=await B("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matching");if(!t.ok)throw new Error("Erreur, impossible de récupérer les matchings");const e=await t.json();V.value=(Array.isArray(e.data)?e.data:[e.data]).map(n=>({...n,editable:!1})),d.value=T.value.map(n=>n.name)}catch(t){u.value=t instanceof Error?t.message:"Erreur, impossible de récupérer les matchings"}},A=t=>new Date(t).toLocaleDateString("fr-FR"),T=M(()=>{const t={};return V.value.forEach(e=>{const n=`${e.consultantSurname}_${e.consultantName}`,f=`${e.consultantSurname} ${e.consultantName}`;t[n]||(t[n]={name:n,fullName:f,jobTitleGroups:[]});let r=t[n].jobTitleGroups.find(l=>l.jobTitle===e.jobTitle);r||(r={jobTitle:e.jobTitle,matchings:[]},t[n].jobTitleGroups.push(r)),r.matchings.push(e)}),Object.values(t)}),D=M(()=>{if(!g.value)return T.value;const t=g.value.toLowerCase();return T.value.map(e=>{const n=e.fullName.toLowerCase().includes(t),f=e.jobTitleGroups.map(r=>{const l=r.jobTitle.toLowerCase().includes(t),y=r.matchings.filter(z=>{var I;return z.jobTitle.toLowerCase().includes(t)||z.rfpReference.toLowerCase().includes(t)||((I=z.comment)==null?void 0:I.toLowerCase().includes(t))||z.score.toString().includes(t)});return n||l?{jobTitle:r.jobTitle,matchings:r.matchings}:y.length>0?{jobTitle:r.jobTitle,matchings:y}:null}).filter(Boolean);return n||f.length>0?{...e,jobTitleGroups:f}:null}).filter(Boolean)}),U=t=>d.value.includes(t),F=t=>{U(t)?d.value=d.value.filter(e=>e!==t):d.value.push(t)},P=()=>d.value=T.value.map(t=>t.name),R=()=>d.value=[],L=async t=>{for(let e of t)if(e.editable)try{if((await B(`https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matching/${e.matchingUuid}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({statutMatching:e.statutMatching,comment:e.comment,score:e.score,profileUuid:e.profileUuid,rfpUuid:e.rfpUuid})})).ok)e.editable=!1,j.value="Modifications sauvegardées avec succès!",h.value="success",k.value=!0;else throw new Error("Erreur de sauvegarde")}catch(n){console.error("Erreur de sauvegarde :",n),j.value="Échec de la sauvegarde.",h.value="error",k.value=!0}};return M(()=>T.value.some(t=>t.jobTitleGroups.some(e=>e.matchings.some(n=>n.editable)))),q(_),(t,e)=>{const n=Se;return p(),C(de,null,{default:a(()=>[e[11]||(e[11]=m("h1",{class:"text-center mb-6"},"Liste des Matchings",-1)),s(E,{type:"info",variant:"outlined",class:"mb-4 d-flex align-center"},{default:a(()=>[e[2]||(e[2]=i(" Vous devez être connecté pour accéder aux liens RFP sur le site Connecting-Expertise. ")),s($,{color:"info",variant:"outlined",href:"https://customer.connecting-expertise.com/",target:"_blank",rel:"noopener noreferrer",size:"small"},{default:a(()=>e[1]||(e[1]=[i(" Se connecter ")])),_:1})]),_:1}),m("div",Me,[s(he,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=f=>g.value=f),label:"Rechercher un matching","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":"",class:"flex-grow-1"},null,8,["modelValue"]),s(ce,{class:"ml-4"},{default:a(()=>[s($,{onClick:P,size:"small",variant:"outlined"},{default:a(()=>[s(w,null,{default:a(()=>e[3]||(e[3]=[i("mdi-unfold-more-horizontal")])),_:1}),e[4]||(e[4]=i(" Tout développer "))]),_:1}),s($,{onClick:R,size:"small",variant:"outlined"},{default:a(()=>[s(w,null,{default:a(()=>e[5]||(e[5]=[i("mdi-unfold-less-horizontal")])),_:1}),e[6]||(e[6]=i(" Tout réduire "))]),_:1})]),_:1})]),u.value?(p(),C(E,{key:0,type:"error",variant:"outlined",class:"mb-4"},{default:a(()=>[i(c(u.value),1)]),_:1})):S("",!0),!V.value.length&&!u.value?(p(),C(E,{key:1,type:"info",class:"mt-4"},{default:a(()=>e[7]||(e[7]=[i(" Aucun matching disponible. ")])),_:1})):S("",!0),(p(!0),x(N,null,O(D.value,f=>(p(),x("div",{key:f.name,class:"mb-6"},[s(X,null,{default:a(()=>[s(Y,{class:H(["consultant-header d-flex align-center",{"cursor-pointer":!0}]),onClick:r=>F(f.name)},{default:a(()=>[s(w,{size:"large",class:"mr-2"},{default:a(()=>e[8]||(e[8]=[i("mdi-account")])),_:1}),m("span",Ee,c(f.fullName),1),s(ve),s(Q,{class:"ml-2 mr-2",color:"primary"},{default:a(()=>[i(c(f.jobTitleGroups.reduce((r,l)=>r+l.matchings.length,0))+" matching"+c(f.jobTitleGroups.reduce((r,l)=>r+l.matchings.length,0)>1?"s":""),1)]),_:2},1024),s(w,null,{default:a(()=>[i(c(U(f.name)?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:2},1024)]),_:2},1032,["onClick"]),s(me,null,{default:a(()=>[U(f.name)?(p(),C(Z,{key:0},{default:a(()=>[(p(!0),x(N,null,O(f.jobTitleGroups,r=>(p(),x("div",{key:r.jobTitle,class:"mb-4"},[m("h3",Ae,[s(w,{class:"mr-1"},{default:a(()=>e[9]||(e[9]=[i("mdi-briefcase")])),_:1}),i(" "+c(r.jobTitle),1)]),s(ke,{headers:o.value,items:r.matchings,class:"elevation-1 mb-4",density:"compact"},{"item.rfpReference":a(({item:l})=>[m("div",null,[m("a",{href:l.rfpUrl,target:"_blank",rel:"noopener noreferrer",style:{color:"#1976d2","text-decoration":"underline"}},c(l.rfpReference),9,De)])]),"item.edit":a(({item:l})=>[s(Te,{modelValue:l.editable,"onUpdate:modelValue":y=>l.editable=y,"hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),"item.publicationDate":a(({item:l})=>[i(c(A(l.publicationDate)),1)]),"item.score":a(({item:l})=>[s(Q,{color:l.score>=30?"success":l.score>=10?"warning":"error",class:H(l.score>=30?"text-white":""),size:"small"},{default:a(()=>[i(c(l.score),1)]),_:2},1032,["color","class"])]),"item.comment":a(({item:l})=>[s(xe,{modelValue:l.comment,"onUpdate:modelValue":y=>l.comment=y,disabled:!l.editable,density:"compact",variant:"outlined","hide-details":"",rows:"2",style:{width:"300px","text-align":"right"},class:"comment-textarea"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.statutMatching":a(({item:l})=>[s(ye,{modelValue:l.statutMatching,"onUpdate:modelValue":y=>l.statutMatching=y,items:["Apply","NotApply","Rejected"],disabled:!l.editable,variant:"outlined",density:"compact","hide-details":"",style:{"max-width":"150px"}},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.feedback":a(({item:l})=>[s(n,{"matching-uuid":l.matchingUuid},null,8,["matching-uuid"])]),_:2},1032,["headers","items"]),r.matchings.some(l=>l.editable)?(p(),x("div",Pe,[s($,{size:"small",color:"primary",onClick:l=>L(r.matchings)},{default:a(()=>e[10]||(e[10]=[i(" Sauvegarder ")])),_:2},1032,["onClick"])])):S("",!0)]))),128))]),_:2},1024)):S("",!0)]),_:2},1024)]),_:2},1024)]))),128))]),_:1})}}}),Le=fe(Re,[["__scopeId","data-v-22bc60d3"]]),qe=G({__name:"table-matching",setup(v){return(V,u)=>(p(),C(Le))}});export{qe as default};
