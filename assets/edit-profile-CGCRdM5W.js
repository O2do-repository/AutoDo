import{_ as $}from"./GoBackBtn.vue_vue_type_script_setup_true_lang-DDsWPqvM.js";import{d as j,r as t,ab as J,P as K,o as A,_ as H,a as p,c as f,w as a,e as d,t as E,f as V,g as o,j as G,V as O}from"./index-DZc381AJ.js";import{f as T}from"./fetchWithApiKey-DRmr9JxU.js";import{V as b}from"./VAlert-xp5TqwgX.js";import{V as I,a as W,b as Q,c as X}from"./VCard-25saiFZi.js";import{V as Y}from"./VForm-BwZtJcjX.js";import{a as Z,V as u}from"./VRow-DnoMbIXs.js";import{V as y}from"./VTextField-DecPHR9W.js";import{V as U}from"./VSelect-Bna2Rpyp.js";import"./VChip-BNSnJZhn.js";const x=j({name:"EditProfile",components:{GoBackBtn:$},setup(){const e=localStorage.getItem("selectedProfile"),r=t(e?JSON.parse(e):{profileUuid:"",rateHour:null,cv:"",cvDate:"",jobTitle:"",experienceLevel:"",skills:[],keywords:[]}),w=J(),c=["Junior","Medior","Senior"],k=t([]),g=t([]),m=t(null),s=t(null),v="https://example.com/default-cv",h=t(""),B=l=>!!l||"Champ obligatoire",N=l=>!isNaN(l)&&Number(l)>=0||"Entier positif requis",S=l=>/^(https?:\/\/)[^\s$.?#].[^\s]*$/.test(l)||"Lien invalide (ex: https://...)",M=l=>!!l||"Date requise",R=()=>{if(!r.value.cv||r.value.cv.trim()===""){h.value="";return}h.value=r.value.cv},L=()=>{r.value.cv===v&&(r.value.cv="")},z=()=>{r.value.cv||(r.value.cv=v)};K(()=>r.value.cv,R);const D=async()=>{try{const l=await T("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/skill",{});if(!l.ok)throw new Error("Erreur récupération des skills");const i=await l.json();k.value=i.data.map(n=>n.name)}catch(l){console.error("Erreur skills :",l)}},F=async()=>{try{const l=await T("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/keyword",{});if(!l.ok)throw new Error("Erreur récupération des keywords");const i=await l.json();g.value=i.data.map(n=>n.name)}catch(l){console.error("Erreur keywords :",l)}};A(()=>{D(),F(),R()});const C=t(!1),q=t(null),P=t(!1);return{profile:r,experienceLevels:c,availableSkills:k,availableKeywords:g,formRef:m,required:B,numberRule:N,urlRule:S,dateRule:M,placeholderCV:v,validCV:h,clearPlaceholder:L,restorePlaceholder:z,submitProfile:async()=>{C.value=!0,q.value=null,P.value=!1;try{if((!r.value.cv||r.value.cv.trim()==="")&&(r.value.cv=v),!m.value)return;const{valid:l}=await m.value.validate();if(!l)return;const i=await T("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/profil",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r.value)}),n=await i.json();if(!i.ok)throw new Error(n.message);P.value=n.message,setTimeout(()=>{w.push("/consultant/consultant-info")},1e3)}catch(l){q.value=l instanceof Error?l.message:"Une erreur est survenue"}finally{C.value=!1}},errorMessage:s,loading:C,error:q,success:P}}});function _(e,r,w,c,k,g){const m=$;return p(),f(O,null,{default:a(()=>[e.errorMessage?(p(),f(b,{key:0,closable:"",type:"error",variant:"outlined",class:"mb-4"},{default:a(()=>[d(E(e.errorMessage),1)]),_:1})):V("",!0),o(I,{class:"pa-4"},{default:a(()=>[o(m,{class:"mb-4"}),o(W,{class:"text-h5 font-weight-bold"},{default:a(()=>r[7]||(r[7]=[d("Modifier le Profil")])),_:1}),o(Q,null,{default:a(()=>[o(Y,{ref:"formRef"},{default:a(()=>[o(Z,null,{default:a(()=>[o(u,{cols:"12"},{default:a(()=>[o(y,{label:"CV URL *",modelValue:e.profile.cv,"onUpdate:modelValue":r[0]||(r[0]=s=>e.profile.cv=s),variant:"outlined",color:"primary",placeholder:e.placeholderCV,rules:[e.required,e.urlRule],onFocus:e.clearPlaceholder,onBlur:e.restorePlaceholder,required:""},null,8,["modelValue","placeholder","rules","onFocus","onBlur"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(y,{label:"Job Title *",modelValue:e.profile.jobTitle,"onUpdate:modelValue":r[1]||(r[1]=s=>e.profile.jobTitle=s),rules:[e.required],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(U,{label:"Niveau d'expérience *",modelValue:e.profile.experienceLevel,"onUpdate:modelValue":r[2]||(r[2]=s=>e.profile.experienceLevel=s),items:e.experienceLevels,rules:[e.required],variant:"outlined",color:"primary",required:""},null,8,["modelValue","items","rules"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(y,{label:"Tarif / heure *",modelValue:e.profile.rateHour,"onUpdate:modelValue":r[3]||(r[3]=s=>e.profile.rateHour=s),modelModifiers:{number:!0},type:"number",rules:[e.required,e.numberRule],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(u,{cols:"6"},{default:a(()=>[o(y,{label:"Date du CV *",modelValue:e.profile.cvDate,"onUpdate:modelValue":r[4]||(r[4]=s=>e.profile.cvDate=s),type:"date",rules:[e.required,e.dateRule],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(u,{cols:"12"},{default:a(()=>[o(U,{label:"Compétences *",modelValue:e.profile.skills,"onUpdate:modelValue":r[5]||(r[5]=s=>e.profile.skills=s),items:e.availableSkills,multiple:"",chips:"","closable-chips":"",rules:[e.required],variant:"outlined",color:"primary"},null,8,["modelValue","items","rules"])]),_:1}),o(u,{cols:"12"},{default:a(()=>[o(U,{label:"Mots-clés *",modelValue:e.profile.keywords,"onUpdate:modelValue":r[6]||(r[6]=s=>e.profile.keywords=s),items:e.availableKeywords,multiple:"",chips:"","closable-chips":"",rules:[e.required],variant:"outlined",color:"primary"},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e.loading?(p(),f(b,{key:0,type:"info",class:"mt-4"},{default:a(()=>r[8]||(r[8]=[d("Chargement en cours...")])),_:1})):V("",!0),e.error?(p(),f(b,{key:1,type:"error",class:"mt-4"},{default:a(()=>[d(E(e.error),1)]),_:1})):V("",!0),e.success?(p(),f(b,{key:2,type:"success",class:"mt-4"},{default:a(()=>[d(E(e.success),1)]),_:1})):V("",!0),o(X,{class:"d-flex justify-end"},{default:a(()=>[o(G,{color:"primary",onClick:e.submitProfile},{default:a(()=>r[9]||(r[9]=[d("Publier")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}const ee=H(x,[["render",_]]),fe=j({__name:"edit-profile",setup(e){return(r,w)=>{const c=ee;return p(),f(c)}}});export{fe as default};
