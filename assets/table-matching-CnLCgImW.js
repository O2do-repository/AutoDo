import{p as ce,T as ke,g as de,A as fe,C as Ce,B as M,e as me,D as ve,f as n,E as H,aa as Te,j as v,Y as _e,a4 as Pe,k as he,x as I,N as Fe,F as L,ab as ne,ac as Me,ad as Re,P as X,ae as Se,af as je,ag as Ue,h as ge,v as Be,o as V,i as $,w as r,l as K,J as G,n as f,t as F,q,s as N,K as se,ah as oe,ai as ze,V as Ae,_ as Ee}from"./index-Bkgs0Zah.js";import{m as xe,e as De,u as be,c as Y,f as re,g as Ie,h as Ge,i as Ne,j as $e,V as He,k as ie,a as Le}from"./VSelect-yJoDpOm4.js";import{f as Oe,i as Je,V as Z}from"./forwardRefs-DzoXtlxl.js";import{V as ue}from"./VAlert-BxSA71N3.js";import{V as Ke,a as qe,b as Ye}from"./VCard-DbOxVaLs.js";import{V as Qe}from"./VSpacer-B5Vudcxd.js";import{V as We}from"./VDataTable-jccchsfI.js";const Xe=ce({...xe(),...ke(De(),["inline"])},"VCheckbox"),Ze=de()({name:"VCheckbox",inheritAttrs:!1,props:Xe(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,k){let{attrs:h,slots:x}=k;const i=fe(e,"modelValue"),{isFocused:d,focus:b,blur:S}=be(e),z=Ce(),A=M(()=>e.id||`checkbox-${z}`);return me(()=>{const[E,y]=ve(h),j=Y.filterProps(e),p=re.filterProps(e);return n(Y,H({class:["v-checkbox",e.class]},E,j,{modelValue:i.value,"onUpdate:modelValue":C=>i.value=C,id:A.value,focused:d.value,style:e.style}),{...x,default:C=>{let{id:T,messagesId:D,isDisabled:R,isReadonly:l,isValid:t}=C;return n(re,H(p,{id:T.value,"aria-describedby":D.value,disabled:R.value,readonly:l.value},y,{error:t.value===!1,modelValue:i.value,"onUpdate:modelValue":s=>i.value=s,onFocus:b,onBlur:S}),x)}})}),{}}}),et=ce({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...xe(),...Ie()},"VTextarea"),tt=de()({name:"VTextarea",directives:{Intersect:Te},inheritAttrs:!1,props:et(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,k){let{attrs:h,emit:x,slots:i}=k;const d=fe(e,"modelValue"),{isFocused:b,focus:S,blur:z}=be(e),A=M(()=>typeof e.counterValue=="function"?e.counterValue(d.value):(d.value||"").toString().length),E=M(()=>{if(h.maxlength)return h.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function y(o,g){var m,w;!e.autofocus||!o||(w=(m=g[0].target)==null?void 0:m.focus)==null||w.call(m)}const j=v(),p=v(),C=_e(""),T=v(),D=M(()=>e.persistentPlaceholder||b.value||e.active);function R(){var o;T.value!==document.activeElement&&((o=T.value)==null||o.focus()),b.value||S()}function l(o){R(),x("click:control",o)}function t(o){x("mousedown:control",o)}function s(o){o.stopPropagation(),R(),X(()=>{d.value="",Se(e["onClick:clear"],o)})}function u(o){var m;const g=o.target;if(d.value=g.value,(m=e.modelModifiers)!=null&&m.trim){const w=[g.selectionStart,g.selectionEnd];X(()=>{g.selectionStart=w[0],g.selectionEnd=w[1]})}}const a=v(),c=v(+e.rows),U=M(()=>["plain","underlined"].includes(e.variant));Pe(()=>{e.autoGrow||(c.value=+e.rows)});function B(){e.autoGrow&&X(()=>{if(!a.value||!p.value)return;const o=getComputedStyle(a.value),g=getComputedStyle(p.value.$el),m=parseFloat(o.getPropertyValue("--v-field-padding-top"))+parseFloat(o.getPropertyValue("--v-input-padding-top"))+parseFloat(o.getPropertyValue("--v-field-padding-bottom")),w=a.value.scrollHeight,O=parseFloat(o.lineHeight),Q=Math.max(parseFloat(e.rows)*O+m,parseFloat(g.getPropertyValue("--v-input-control-height"))),W=parseFloat(e.maxRows)*O+m||1/0,P=Ue(w??0,Q,W);c.value=Math.floor((P-m)/O),C.value=je(P)})}he(B),I(d,B),I(()=>e.rows,B),I(()=>e.maxRows,B),I(()=>e.density,B);let _;return I(a,o=>{o?(_=new ResizeObserver(B),_.observe(a.value)):_==null||_.disconnect()}),Fe(()=>{_==null||_.disconnect()}),me(()=>{const o=!!(i.counter||e.counter||e.counterValue),g=!!(o||i.details),[m,w]=ve(h),{modelValue:O,...Q}=Y.filterProps(e),W=Ge(e);return n(Y,H({ref:j,modelValue:d.value,"onUpdate:modelValue":P=>d.value=P,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":U.value},e.class],style:e.style},m,Q,{centerAffix:c.value===1&&!U.value,focused:b.value}),{...i,default:P=>{let{id:J,isDisabled:ee,isDirty:te,isReadonly:pe,isValid:Ve}=P;return n(Ne,H({ref:p,style:{"--v-textarea-control-height":C.value},onClick:l,onMousedown:t,"onClick:clear":s,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},W,{id:J.value,active:D.value||te.value,centerAffix:c.value===1&&!U.value,dirty:te.value||e.dirty,disabled:ee.value,focused:b.value,error:Ve.value===!1}),{...i,default:ye=>{let{props:{class:ae,...le}}=ye;return n(L,null,[e.prefix&&n("span",{class:"v-text-field__prefix"},[e.prefix]),ne(n("textarea",H({ref:T,class:ae,value:d.value,onInput:u,autofocus:e.autofocus,readonly:pe.value,disabled:ee.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:R,onBlur:z},le,w),null),[[Me("intersect"),{handler:y},null,{once:!0}]]),e.autoGrow&&ne(n("textarea",{class:[ae,"v-textarea__sizer"],id:`${le.id}-sizer`,"onUpdate:modelValue":we=>d.value=we,ref:a,readonly:!0,"aria-hidden":"true"},null),[[Re,d.value]]),e.suffix&&n("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:g?P=>{var J;return n(L,null,[(J=i.details)==null?void 0:J.call(i,P),o&&n(L,null,[n("span",null,null),n($e,{active:e.persistentCounter||b.value,value:A.value,max:E.value,disabled:e.disabled},i.counter)])])}:void 0})}),Oe({},j,p,T)}}),at={class:"d-flex align-center mb-4"},lt={class:"text-h5"},nt={class:"text-subtitle-1 mb-2"},st={key:0},ot=ge({__name:"TableMatching",setup(e){Be();const k=v([]),h=v(null),x=v(""),i=v([]),d=v(!1),b=v(""),S=v("success"),z=v([{key:"edit",title:"",align:"center"},{key:"rfpReference",title:"Référence RFP",align:"start"},{key:"score",title:"Score",align:"end"},{key:"offerDate",title:"Date de l'offre",align:"start"},{key:"statutMatching",title:"Statut",align:"start"},{key:"comment",title:"Commentaire",align:"start"}]),A=async()=>{try{const l=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matching");if(!l.ok)throw new Error("Erreur, impossible de récupérer les matchings");const t=await l.json();k.value=(Array.isArray(t)?t:[t]).map(s=>({...s,editable:!1})),i.value=y.value.map(s=>s.name)}catch(l){h.value=l instanceof Error?l.message:"Erreur, impossible de récupérer les matchings"}},E=l=>new Date(l).toLocaleDateString("fr-FR"),y=M(()=>{const l={};return k.value.forEach(t=>{const s=`${t.consultantSurname}_${t.consultantName}`,u=`${t.consultantSurname} ${t.consultantName}`;l[s]||(l[s]={name:s,fullName:u,jobTitleGroups:[]});let a=l[s].jobTitleGroups.find(c=>c.jobTitle===t.jobTitle);a||(a={jobTitle:t.jobTitle,matchings:[]},l[s].jobTitleGroups.push(a)),a.matchings.push(t)}),Object.values(l)}),j=M(()=>{if(!x.value)return y.value;const l=x.value.toLowerCase();return y.value.map(t=>{const s=t.jobTitleGroups.map(u=>{const a=u.matchings.filter(c=>{var U;return c.jobTitle.toLowerCase().includes(l)||c.rfpReference.toLowerCase().includes(l)||((U=c.comment)==null?void 0:U.toLowerCase().includes(l))||c.score.toString().includes(l)});return a.length>0?{jobTitle:u.jobTitle,matchings:a}:null}).filter(Boolean);return s.length>0?{...t,jobTitleGroups:s}:null}).filter(Boolean)}),p=l=>i.value.includes(l),C=l=>{p(l)?i.value=i.value.filter(t=>t!==l):i.value.push(l)},T=()=>i.value=y.value.map(l=>l.name),D=()=>i.value=[],R=async l=>{for(let t of l)if(t.editable)try{if((await fetch(`https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matching/${t.matchingUuid}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({statutMatching:t.statutMatching,comment:t.comment,score:t.score,profileUuid:t.profileUuid,rfpUuid:t.rfpUuid})})).ok)t.editable=!1,b.value="Modifications sauvegardées avec succès!",S.value="success",d.value=!0;else throw new Error("Erreur de sauvegarde")}catch(s){console.error("Erreur de sauvegarde :",s),b.value="Échec de la sauvegarde.",S.value="error",d.value=!0}};return M(()=>y.value.some(l=>l.jobTitleGroups.some(t=>t.matchings.some(s=>s.editable)))),he(A),(l,t)=>(V(),$(Ae,null,{default:r(()=>[t[9]||(t[9]=K("h1",{class:"text-center mb-6"},"Liste des Matchings",-1)),K("div",at,[n(He,{modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=s=>x.value=s),label:"Rechercher un matching","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":"",class:"flex-grow-1"},null,8,["modelValue"]),n(Je,{class:"ml-4"},{default:r(()=>[n(Z,{onClick:T,size:"small",variant:"outlined"},{default:r(()=>[n(G,null,{default:r(()=>t[1]||(t[1]=[f("mdi-unfold-more-horizontal")])),_:1}),t[2]||(t[2]=f(" Tout développer "))]),_:1}),n(Z,{onClick:D,size:"small",variant:"outlined"},{default:r(()=>[n(G,null,{default:r(()=>t[3]||(t[3]=[f("mdi-unfold-less-horizontal")])),_:1}),t[4]||(t[4]=f(" Tout réduire "))]),_:1})]),_:1})]),h.value?(V(),$(ue,{key:0,type:"error",variant:"outlined",class:"mb-4"},{default:r(()=>[f(F(h.value),1)]),_:1})):q("",!0),!k.value.length&&!h.value?(V(),$(ue,{key:1,type:"info",class:"mt-4"},{default:r(()=>t[5]||(t[5]=[f(" Aucun matching disponible. ")])),_:1})):q("",!0),(V(!0),N(L,null,se(j.value,s=>(V(),N("div",{key:s.name,class:"mb-6"},[n(Ke,null,{default:r(()=>[n(qe,{class:oe(["consultant-header d-flex align-center",{"cursor-pointer":!0}]),onClick:u=>C(s.name)},{default:r(()=>[n(G,{size:"large",class:"mr-2"},{default:r(()=>t[6]||(t[6]=[f("mdi-account")])),_:1}),K("span",lt,F(s.fullName),1),n(Qe),n(ie,{class:"ml-2 mr-2",color:"primary"},{default:r(()=>[f(F(s.jobTitleGroups.reduce((u,a)=>u+a.matchings.length,0))+" matching"+F(s.jobTitleGroups.reduce((u,a)=>u+a.matchings.length,0)>1?"s":""),1)]),_:2},1024),n(G,null,{default:r(()=>[f(F(p(s.name)?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:2},1024)]),_:2},1032,["onClick"]),n(ze,null,{default:r(()=>[p(s.name)?(V(),$(Ye,{key:0},{default:r(()=>[(V(!0),N(L,null,se(s.jobTitleGroups,u=>(V(),N("div",{key:u.jobTitle,class:"mb-4"},[K("h3",nt,[n(G,{class:"mr-1"},{default:r(()=>t[7]||(t[7]=[f("mdi-briefcase")])),_:1}),f(" "+F(u.jobTitle),1)]),n(We,{headers:z.value,items:u.matchings,class:"elevation-1 mb-4",density:"compact"},{"item.edit":r(({item:a})=>[n(Ze,{modelValue:a.editable,"onUpdate:modelValue":c=>a.editable=c,"hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),"item.offerDate":r(({item:a})=>[f(F(E(a.offerDate)),1)]),"item.score":r(({item:a})=>[n(ie,{color:a.score>=30?"success":a.score>=10?"warning":"error",class:oe(a.score>=30?"text-white":""),size:"small"},{default:r(()=>[f(F(a.score),1)]),_:2},1032,["color","class"])]),"item.comment":r(({item:a})=>[n(tt,{modelValue:a.comment,"onUpdate:modelValue":c=>a.comment=c,disabled:!a.editable,density:"compact",variant:"outlined","hide-details":"",rows:"2",style:{width:"300px","text-align":"right"},class:"comment-textarea"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.statutMatching":r(({item:a})=>[n(Le,{modelValue:a.statutMatching,"onUpdate:modelValue":c=>a.statutMatching=c,items:["Apply","NotApply","Rejected"],disabled:!a.editable,variant:"outlined",density:"compact","hide-details":"",style:{"max-width":"150px"}},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["headers","items"]),u.matchings.some(a=>a.editable)?(V(),N("div",st,[n(Z,{size:"small",color:"primary",onClick:a=>R(u.matchings)},{default:r(()=>t[8]||(t[8]=[f(" Sauvegarder ")])),_:2},1032,["onClick"])])):q("",!0)]))),128))]),_:2},1024)):q("",!0)]),_:2},1024)]),_:2},1024)]))),128))]),_:1}))}}),rt=Ee(ot,[["__scopeId","data-v-cd476717"]]),ht=ge({__name:"table-matching",setup(e){return(k,h)=>(V(),$(rt))}});export{ht as default};
