import{_ as I}from"./GoBackBtn.vue_vue_type_script_setup_true_lang-JHxlzadA.js";import{d as q,r as i,ab as F,P as h,o as L,_ as O,a as c,c as f,w as o,g as l,e as p,ac as G,ad as J,f as C,t as E,j as K,V as M}from"./index-Ch00-T5v.js";import{f as w}from"./fetchWithApiKey-C7sQFpO8.js";import{V as W,a as H,b as Q,c as X}from"./VCard-BssREAJA.js";import{V as Y}from"./VForm-CEOap3g_.js";import{a as Z,V as n}from"./VRow-B6JHqpeN.js";import{V as u}from"./VTextField-NEJ7P9LY.js";import{V as x}from"./VSwitch-tgzUXFeH.js";import{V as _}from"./VSelect-Db8poBrv.js";import{V as P}from"./VAlert-nealorJD.js";import"./VChip-Dh1s8N5S.js";const ee=q({name:"AddConsultant",components:{GoBackBtn:I},setup(){const e=i({Email:"",AvailabilityDate:"",ExpirationDateCI:"",Intern:!1,Name:"",Surname:"",enterprise:"",Phone:"",CopyCI:"",Picture:""}),a=F(),v=i([]),V=i(null),s="https://static.vecteezy.com/system/resources/thumbnails/003/337/584/small/default-avatar-photo-placeholder-profile-icon-vector.jpg",d=i(s),m=i(!1),r=i(null),b=i(!1),R=t=>(t==null?void 0:t.trim())!==""||"Champ obligatoire",U=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||"Format invalide (ex: exemple@mail.com)",k=t=>/^\+?[0-9]{9,15}$/.test(t)||"Format invalide (ex: +32444332211)",$=t=>/^(https?:\/\/)[^\s$.?#].[^\s]*$/.test(t)||"Lien invalide (ex: https://...)",A=t=>/^(https?:\/\/.*)/i.test(t)||"Lien invalide (ex: https://site.com/image)",B=t=>!!t||"Veuillez choisir une date",N=async()=>{try{const t=await w("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/enterprise",{});if(!t.ok)throw new Error("Erreur lors du chargement des entreprises");const y=await t.json();v.value=y.data}catch(t){console.error("Erreur fetch entreprises :",t)}};h(()=>e.value.Intern,t=>{t?e.value.enterprise="O2do":e.value.enterprise=""});const D=()=>{if(!e.value.Picture||e.value.Picture.trim()===""){d.value=s;return}const t=new Image;t.src=e.value.Picture,t.onload=()=>{d.value=e.value.Picture},t.onerror=()=>{d.value=s}},S=()=>{e.value.Picture===s&&(e.value.Picture="")},T=()=>{e.value.Picture||(e.value.Picture=s)},z=()=>{d.value=s};h(()=>e.value.Picture,D);const j=async()=>{m.value=!0,r.value=null,b.value=!1;try{if((!e.value.Picture||e.value.Picture.trim()==="")&&(e.value.Picture=s),!V.value)return;const{valid:t}=await V.value.validate();if(!t)return;const y=await w("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/consultant",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.value)}),g=await y.json();if(!y.ok)throw new Error(g.message);b.value=g.message,setTimeout(()=>{a.push("/consultant/list-consultant")},1e3)}catch(t){r.value=t instanceof Error?t.message:"Une erreur est survenue"}finally{m.value=!1}};return L(()=>{N()}),{consultant:e,enterprises:v,formRef:V,validPicture:d,required:R,emailRule:U,phoneRule:k,urlRule:$,imageUrlRule:A,dateRule:B,clearPlaceholder:S,restorePlaceholder:T,setPlaceholder:z,submitConsultant:j,placeholderImage:s,loading:m,error:r,success:b}}});function le(e,a,v,V,s,d){const m=I;return c(),f(M,null,{default:o(()=>[l(W,{class:"pa-4"},{default:o(()=>[l(m,{class:"mb-4"}),l(H,{class:"text-h5 font-weight-bold"},{default:o(()=>a[10]||(a[10]=[p("Nouveau Consultant")])),_:1}),l(Q,null,{default:o(()=>[l(Y,{ref:"formRef"},{default:o(()=>[l(Z,null,{default:o(()=>[l(n,{cols:"12",class:"d-flex flex-column align-center"},{default:o(()=>[l(G,{size:"150"},{default:o(()=>[l(J,{src:e.validPicture,alt:"Photo Consultant",contain:"",onError:e.setPlaceholder},null,8,["src","onError"])]),_:1})]),_:1}),l(n,{cols:"12"},{default:o(()=>[l(u,{variant:"outlined",color:"primary",label:"Lien Photo *",modelValue:e.consultant.Picture,"onUpdate:modelValue":a[0]||(a[0]=r=>e.consultant.Picture=r),placeholder:e.placeholderImage,rules:[e.required,e.imageUrlRule],onFocus:e.clearPlaceholder,onBlur:e.restorePlaceholder},null,8,["modelValue","placeholder","rules","onFocus","onBlur"])]),_:1}),l(n,{cols:"6"},{default:o(()=>[l(u,{variant:"outlined",color:"primary",label:"Prénom *",modelValue:e.consultant.Surname,"onUpdate:modelValue":a[1]||(a[1]=r=>e.consultant.Surname=r),rules:[e.required],required:""},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"6"},{default:o(()=>[l(u,{variant:"outlined",color:"primary",label:"Nom *",modelValue:e.consultant.Name,"onUpdate:modelValue":a[2]||(a[2]=r=>e.consultant.Name=r),rules:[e.required],required:""},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"6"},{default:o(()=>[l(u,{variant:"outlined",color:"primary",label:"Lien Copie CI *",modelValue:e.consultant.CopyCI,"onUpdate:modelValue":a[3]||(a[3]=r=>e.consultant.CopyCI=r),rules:[e.required,e.urlRule],required:""},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"6"},{default:o(()=>[l(u,{variant:"outlined",color:"primary",label:"Expiration CI *",modelValue:e.consultant.ExpirationDateCI,"onUpdate:modelValue":a[4]||(a[4]=r=>e.consultant.ExpirationDateCI=r),type:"date",rules:[e.required,e.dateRule]},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"6"},{default:o(()=>[l(x,{variant:"outlined",color:"primary",label:"Interne",modelValue:e.consultant.Intern,"onUpdate:modelValue":a[5]||(a[5]=r=>e.consultant.Intern=r)},null,8,["modelValue"])]),_:1}),l(n,{cols:"6"},{default:o(()=>[l(_,{label:"Entreprise *",modelValue:e.consultant.enterprise,"onUpdate:modelValue":a[6]||(a[6]=r=>e.consultant.enterprise=r),items:e.enterprises,"item-title":"name","item-value":"name",rules:[e.required],variant:"outlined",color:"primary",disabled:!!e.consultant.Intern},null,8,["modelValue","items","rules","disabled"])]),_:1}),l(n,{cols:"6"},{default:o(()=>[l(u,{variant:"outlined",color:"primary",label:"Email *",modelValue:e.consultant.Email,"onUpdate:modelValue":a[7]||(a[7]=r=>e.consultant.Email=r),rules:[e.required,e.emailRule],required:""},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"6"},{default:o(()=>[l(u,{variant:"outlined",color:"primary",label:"Téléphone *",modelValue:e.consultant.Phone,"onUpdate:modelValue":a[8]||(a[8]=r=>e.consultant.Phone=r),rules:[e.required,e.phoneRule],required:""},null,8,["modelValue","rules"])]),_:1}),l(n,{cols:"6"},{default:o(()=>[l(u,{variant:"outlined",color:"primary",label:"Date de disponibilité *",modelValue:e.consultant.AvailabilityDate,"onUpdate:modelValue":a[9]||(a[9]=r=>e.consultant.AvailabilityDate=r),type:"date",rules:[e.dateRule],required:""},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e.loading?(c(),f(P,{key:0,type:"info",class:"mt-4"},{default:o(()=>a[11]||(a[11]=[p("Chargement en cours...")])),_:1})):C("",!0),e.error?(c(),f(P,{key:1,type:"error",class:"mt-4"},{default:o(()=>[p(E(e.error),1)]),_:1})):C("",!0),e.success?(c(),f(P,{key:2,type:"success",class:"mt-4"},{default:o(()=>[p(E(e.success),1)]),_:1})):C("",!0),l(X,{class:"d-flex justify-end"},{default:o(()=>[l(K,{color:"primary",onClick:e.submitConsultant,loading:e.loading},{default:o(()=>a[12]||(a[12]=[p("Publier")])),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1})}const ae=O(ee,[["render",le]]),fe=q({__name:"add-consultant",setup(e){return(a,v)=>(c(),f(ae))}});export{fe as default};
