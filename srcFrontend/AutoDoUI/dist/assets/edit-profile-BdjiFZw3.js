import{_ as g,V as N}from"./VForm-BD57haRY.js";import{h as q,j as i,a5 as S,O as M,k as L,_ as z,o as k,i as h,w as s,n as w,t as D,q as F,f as o,V as J}from"./index-CXmdwxo-.js";import{V as H}from"./VAlert-DWWzsjAl.js";import{V as K,a as O,b as A,c as G}from"./VCard-DpfQPIBz.js";import{V as I,a as t}from"./VRow-D9b1hgQV.js";import{V as m}from"./VTextField-DQoh-tBi.js";import{V as y}from"./VSelect-BgZoX6lA.js";import{V as Q}from"./forwardRefs-BGojW5Df.js";const W=q({name:"EditProfile",components:{GoBackBtn:g},setup(){const e=localStorage.getItem("selectedProfile"),r=i(e?JSON.parse(e):{profileUuid:"",rateHour:null,cv:"",cvDate:"",jobTitle:"",experienceLevel:"",skills:[],keywords:[]}),f=S(),n=["Junior","Medior","Senior"],c=i([]),v=i([]),u=i(null),a=i(null),d="https://example.com/default-cv.pdf",V=i(""),E=l=>!!l||"Champ obligatoire",P=l=>!isNaN(l)&&Number(l)>=0||"Entier positif requis",T=l=>/^(https?:\/\/)[^\s$.?#].[^\s]*$/.test(l)||"Lien invalide (ex: https://...)",U=l=>!!l||"Date requise",C=()=>{if(!r.value.cv||r.value.cv.trim()===""){V.value="";return}V.value=r.value.cv},R=()=>{r.value.cv===d&&(r.value.cv="")},$=()=>{r.value.cv||(r.value.cv=d)};M(()=>r.value.cv,C);const j=async()=>{try{const l=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/skill");if(!l.ok)throw new Error("Erreur récupération des skills");const p=await l.json();c.value=p.map(b=>b.name)}catch(l){console.error("Erreur skills :",l)}},B=async()=>{try{const l=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/keyword");if(!l.ok)throw new Error("Erreur récupération des keywords");const p=await l.json();v.value=p.map(b=>b.name)}catch(l){console.error("Erreur keywords :",l)}};return L(()=>{j(),B(),C()}),{profile:r,experienceLevels:n,availableSkills:c,availableKeywords:v,formRef:u,required:E,numberRule:P,urlRule:T,dateRule:U,placeholderCV:d,validCV:V,clearPlaceholder:R,restorePlaceholder:$,submitProfile:async()=>{try{if((!r.value.cv||r.value.cv.trim()==="")&&(r.value.cv=d),a.value=null,!u.value)return;const{valid:l}=await u.value.validate();if(!l)return;if(!(await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/profil",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r.value)})).ok)throw new Error("Erreur lors de la mise à jour du profil");setTimeout(()=>{f.go(-1)},1e3)}catch(l){console.error(l instanceof Error?l.message:"Une erreur est survenue"),a.value="Erreur lors de la mise à jour"}},errorMessage:a}}});function X(e,r,f,n,c,v){const u=g;return k(),h(J,null,{default:s(()=>[e.errorMessage?(k(),h(H,{key:0,closable:"",type:"error",variant:"outlined",class:"mb-4"},{default:s(()=>[w(D(e.errorMessage),1)]),_:1})):F("",!0),o(K,{class:"pa-4"},{default:s(()=>[o(u,{class:"mb-4"}),o(O,{class:"text-h5 font-weight-bold"},{default:s(()=>r[7]||(r[7]=[w("Modifier le Profil")])),_:1}),o(A,null,{default:s(()=>[o(N,{ref:"formRef"},{default:s(()=>[o(I,null,{default:s(()=>[o(t,{cols:"12"},{default:s(()=>[o(m,{label:"CV URL *",modelValue:e.profile.cv,"onUpdate:modelValue":r[0]||(r[0]=a=>e.profile.cv=a),variant:"outlined",color:"primary",placeholder:e.placeholderCV,rules:[e.required,e.urlRule],onFocus:e.clearPlaceholder,onBlur:e.restorePlaceholder,required:""},null,8,["modelValue","placeholder","rules","onFocus","onBlur"])]),_:1}),o(t,{cols:"6"},{default:s(()=>[o(m,{label:"Job Title *",modelValue:e.profile.jobTitle,"onUpdate:modelValue":r[1]||(r[1]=a=>e.profile.jobTitle=a),rules:[e.required],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(t,{cols:"6"},{default:s(()=>[o(y,{label:"Niveau d'expérience *",modelValue:e.profile.experienceLevel,"onUpdate:modelValue":r[2]||(r[2]=a=>e.profile.experienceLevel=a),items:e.experienceLevels,rules:[e.required],variant:"outlined",color:"primary",required:""},null,8,["modelValue","items","rules"])]),_:1}),o(t,{cols:"6"},{default:s(()=>[o(m,{label:"Tarif / heure *",modelValue:e.profile.rateHour,"onUpdate:modelValue":r[3]||(r[3]=a=>e.profile.rateHour=a),modelModifiers:{number:!0},type:"number",rules:[e.required,e.numberRule],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(t,{cols:"6"},{default:s(()=>[o(m,{label:"Date du CV *",modelValue:e.profile.cvDate,"onUpdate:modelValue":r[4]||(r[4]=a=>e.profile.cvDate=a),type:"date",rules:[e.required,e.dateRule],variant:"outlined",color:"primary",required:""},null,8,["modelValue","rules"])]),_:1}),o(t,{cols:"12"},{default:s(()=>[o(y,{label:"Compétences *",modelValue:e.profile.skills,"onUpdate:modelValue":r[5]||(r[5]=a=>e.profile.skills=a),items:e.availableSkills,multiple:"",chips:"","closable-chips":"",rules:[e.required],variant:"outlined",color:"primary"},null,8,["modelValue","items","rules"])]),_:1}),o(t,{cols:"12"},{default:s(()=>[o(y,{label:"Mots-clés *",modelValue:e.profile.keywords,"onUpdate:modelValue":r[6]||(r[6]=a=>e.profile.keywords=a),items:e.availableKeywords,multiple:"",chips:"","closable-chips":"",rules:[e.required],variant:"outlined",color:"primary"},null,8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),o(G,{class:"d-flex justify-end"},{default:s(()=>[o(Q,{color:"primary",onClick:e.submitProfile},{default:s(()=>r[8]||(r[8]=[w("Publier")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}const Y=z(W,[["render",X]]),te=q({__name:"edit-profile",setup(e){return(r,f)=>{const n=Y;return k(),h(n)}}});export{te as default};
