import{p as ce,D as ke,g as de,T as fe,a9 as Ce,G as R,e as me,aa as ve,f as n,H,at as Te,j as v,N as _e,ap as Pe,k as he,O as G,ae as Fe,F as L,Q as ne,R as Re,au as Me,Y as W,av as Se,X as je,aw as Ue,h as ge,a5 as ze,o as V,i as $,w as r,l as J,x as I,n as f,t as F,q as K,s as N,z as se,B as oe,ax as Be,V as Ae,_ as De}from"./index-CXmdwxo-.js";import{c as xe,u as be,d as Q,g as Ee,h as Ge,i as Ie,j as Ne,V as $e,a as re}from"./VTextField-DQoh-tBi.js";import{f as He,q as Le,V as Z}from"./forwardRefs-BGojW5Df.js";import{V as ie}from"./VAlert-DWWzsjAl.js";import{V as Oe,a as qe,b as Je}from"./VCard-DpfQPIBz.js";import{V as Ke}from"./VSpacer-DNiTar-0.js";import{V as Qe}from"./VDataTable-C26AibDa.js";import{b as Xe,c as ue,V as Ye}from"./VSelect-BgZoX6lA.js";const We=ce({...xe(),...ke(Xe(),["inline"])},"VCheckbox"),Ze=de()({name:"VCheckbox",inheritAttrs:!1,props:We(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,k){let{attrs:h,slots:x}=k;const i=fe(e,"modelValue"),{isFocused:d,focus:b,blur:S}=be(e),B=Ce(),A=R(()=>e.id||`checkbox-${B}`);return me(()=>{const[D,y]=ve(h),j=Q.filterProps(e),p=ue.filterProps(e);return n(Q,H({class:["v-checkbox",e.class]},D,j,{modelValue:i.value,"onUpdate:modelValue":C=>i.value=C,id:A.value,focused:d.value,style:e.style}),{...x,default:C=>{let{id:T,messagesId:E,isDisabled:M,isReadonly:l,isValid:t}=C;return n(ue,H(p,{id:T.value,"aria-describedby":E.value,disabled:M.value,readonly:l.value},y,{error:t.value===!1,modelValue:i.value,"onUpdate:modelValue":s=>i.value=s,onFocus:b,onBlur:S}),x)}})}),{}}}),et=ce({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...xe(),...Ee()},"VTextarea"),tt=de()({name:"VTextarea",directives:{Intersect:Te},inheritAttrs:!1,props:et(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,k){let{attrs:h,emit:x,slots:i}=k;const d=fe(e,"modelValue"),{isFocused:b,focus:S,blur:B}=be(e),A=R(()=>typeof e.counterValue=="function"?e.counterValue(d.value):(d.value||"").toString().length),D=R(()=>{if(h.maxlength)return h.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function y(o,g){var m,w;!e.autofocus||!o||(w=(m=g[0].target)==null?void 0:m.focus)==null||w.call(m)}const j=v(),p=v(),C=_e(""),T=v(),E=R(()=>e.persistentPlaceholder||b.value||e.active);function M(){var o;T.value!==document.activeElement&&((o=T.value)==null||o.focus()),b.value||S()}function l(o){M(),x("click:control",o)}function t(o){x("mousedown:control",o)}function s(o){o.stopPropagation(),M(),W(()=>{d.value="",Se(e["onClick:clear"],o)})}function u(o){var m;const g=o.target;if(d.value=g.value,(m=e.modelModifiers)!=null&&m.trim){const w=[g.selectionStart,g.selectionEnd];W(()=>{g.selectionStart=w[0],g.selectionEnd=w[1]})}}const a=v(),c=v(+e.rows),U=R(()=>["plain","underlined"].includes(e.variant));Pe(()=>{e.autoGrow||(c.value=+e.rows)});function z(){e.autoGrow&&W(()=>{if(!a.value||!p.value)return;const o=getComputedStyle(a.value),g=getComputedStyle(p.value.$el),m=parseFloat(o.getPropertyValue("--v-field-padding-top"))+parseFloat(o.getPropertyValue("--v-input-padding-top"))+parseFloat(o.getPropertyValue("--v-field-padding-bottom")),w=a.value.scrollHeight,O=parseFloat(o.lineHeight),X=Math.max(parseFloat(e.rows)*O+m,parseFloat(g.getPropertyValue("--v-input-control-height"))),Y=parseFloat(e.maxRows)*O+m||1/0,P=Ue(w??0,X,Y);c.value=Math.floor((P-m)/O),C.value=je(P)})}he(z),G(d,z),G(()=>e.rows,z),G(()=>e.maxRows,z),G(()=>e.density,z);let _;return G(a,o=>{o?(_=new ResizeObserver(z),_.observe(a.value)):_==null||_.disconnect()}),Fe(()=>{_==null||_.disconnect()}),me(()=>{const o=!!(i.counter||e.counter||e.counterValue),g=!!(o||i.details),[m,w]=ve(h),{modelValue:O,...X}=Q.filterProps(e),Y=Ge(e);return n(Q,H({ref:j,modelValue:d.value,"onUpdate:modelValue":P=>d.value=P,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":U.value},e.class],style:e.style},m,X,{centerAffix:c.value===1&&!U.value,focused:b.value}),{...i,default:P=>{let{id:q,isDisabled:ee,isDirty:te,isReadonly:pe,isValid:Ve}=P;return n(Ie,H({ref:p,style:{"--v-textarea-control-height":C.value},onClick:l,onMousedown:t,"onClick:clear":s,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},Y,{id:q.value,active:E.value||te.value,centerAffix:c.value===1&&!U.value,dirty:te.value||e.dirty,disabled:ee.value,focused:b.value,error:Ve.value===!1}),{...i,default:ye=>{let{props:{class:ae,...le}}=ye;return n(L,null,[e.prefix&&n("span",{class:"v-text-field__prefix"},[e.prefix]),ne(n("textarea",H({ref:T,class:ae,value:d.value,onInput:u,autofocus:e.autofocus,readonly:pe.value,disabled:ee.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:M,onBlur:B},le,w),null),[[Re("intersect"),{handler:y},null,{once:!0}]]),e.autoGrow&&ne(n("textarea",{class:[ae,"v-textarea__sizer"],id:`${le.id}-sizer`,"onUpdate:modelValue":we=>d.value=we,ref:a,readonly:!0,"aria-hidden":"true"},null),[[Me,d.value]]),e.suffix&&n("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:g?P=>{var q;return n(L,null,[(q=i.details)==null?void 0:q.call(i,P),o&&n(L,null,[n("span",null,null),n(Ne,{active:e.persistentCounter||b.value,value:A.value,max:D.value,disabled:e.disabled},i.counter)])])}:void 0})}),He({},j,p,T)}}),at={class:"d-flex align-center mb-4"},lt={class:"text-h5"},nt={class:"text-subtitle-1 mb-2"},st={key:0},ot=ge({__name:"TableMatching",setup(e){ze();const k=v([]),h=v(null),x=v(""),i=v([]),d=v(!1),b=v(""),S=v("success"),B=v([{key:"edit",title:"",align:"center"},{key:"rfpReference",title:"Référence RFP",align:"start"},{key:"score",title:"Score",align:"end"},{key:"offerDate",title:"Date de l'offre",align:"start"},{key:"statutMatching",title:"Statut",align:"start"},{key:"comment",title:"Commentaire",align:"start"}]),A=async()=>{try{const l=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matching");if(!l.ok)throw new Error("Erreur, impossible de récupérer les matchings");const t=await l.json();k.value=(Array.isArray(t)?t:[t]).map(s=>({...s,editable:!1})),i.value=y.value.map(s=>s.name)}catch(l){h.value=l instanceof Error?l.message:"Erreur, impossible de récupérer les matchings"}},D=l=>new Date(l).toLocaleDateString("fr-FR"),y=R(()=>{const l={};return k.value.forEach(t=>{const s=`${t.consultantSurname}_${t.consultantName}`,u=`${t.consultantSurname} ${t.consultantName}`;l[s]||(l[s]={name:s,fullName:u,jobTitleGroups:[]});let a=l[s].jobTitleGroups.find(c=>c.jobTitle===t.jobTitle);a||(a={jobTitle:t.jobTitle,matchings:[]},l[s].jobTitleGroups.push(a)),a.matchings.push(t)}),Object.values(l)}),j=R(()=>{if(!x.value)return y.value;const l=x.value.toLowerCase();return y.value.map(t=>{const s=t.jobTitleGroups.map(u=>{const a=u.matchings.filter(c=>{var U;return c.jobTitle.toLowerCase().includes(l)||c.rfpReference.toLowerCase().includes(l)||((U=c.comment)==null?void 0:U.toLowerCase().includes(l))||c.score.toString().includes(l)});return a.length>0?{jobTitle:u.jobTitle,matchings:a}:null}).filter(Boolean);return s.length>0?{...t,jobTitleGroups:s}:null}).filter(Boolean)}),p=l=>i.value.includes(l),C=l=>{p(l)?i.value=i.value.filter(t=>t!==l):i.value.push(l)},T=()=>i.value=y.value.map(l=>l.name),E=()=>i.value=[],M=async l=>{for(let t of l)if(t.editable)try{if((await fetch(`https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/matching/${t.matchingUuid}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({statutMatching:t.statutMatching,comment:t.comment,score:t.score,profileUuid:t.profileUuid,rfpUuid:t.rfpUuid})})).ok)t.editable=!1,b.value="Modifications sauvegardées avec succès!",S.value="success",d.value=!0;else throw new Error("Erreur de sauvegarde")}catch(s){console.error("Erreur de sauvegarde :",s),b.value="Échec de la sauvegarde.",S.value="error",d.value=!0}};return R(()=>y.value.some(l=>l.jobTitleGroups.some(t=>t.matchings.some(s=>s.editable)))),he(A),(l,t)=>(V(),$(Ae,null,{default:r(()=>[t[9]||(t[9]=J("h1",{class:"text-center mb-6"},"Liste des Matchings",-1)),J("div",at,[n($e,{modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=s=>x.value=s),label:"Rechercher un matching","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":"",class:"flex-grow-1"},null,8,["modelValue"]),n(Le,{class:"ml-4"},{default:r(()=>[n(Z,{onClick:T,size:"small",variant:"outlined"},{default:r(()=>[n(I,null,{default:r(()=>t[1]||(t[1]=[f("mdi-unfold-more-horizontal")])),_:1}),t[2]||(t[2]=f(" Tout développer "))]),_:1}),n(Z,{onClick:E,size:"small",variant:"outlined"},{default:r(()=>[n(I,null,{default:r(()=>t[3]||(t[3]=[f("mdi-unfold-less-horizontal")])),_:1}),t[4]||(t[4]=f(" Tout réduire "))]),_:1})]),_:1})]),h.value?(V(),$(ie,{key:0,type:"error",variant:"outlined",class:"mb-4"},{default:r(()=>[f(F(h.value),1)]),_:1})):K("",!0),!k.value.length&&!h.value?(V(),$(ie,{key:1,type:"info",class:"mt-4"},{default:r(()=>t[5]||(t[5]=[f(" Aucun matching disponible. ")])),_:1})):K("",!0),(V(!0),N(L,null,se(j.value,s=>(V(),N("div",{key:s.name,class:"mb-6"},[n(Oe,null,{default:r(()=>[n(qe,{class:oe(["consultant-header d-flex align-center",{"cursor-pointer":!0}]),onClick:u=>C(s.name)},{default:r(()=>[n(I,{size:"large",class:"mr-2"},{default:r(()=>t[6]||(t[6]=[f("mdi-account")])),_:1}),J("span",lt,F(s.fullName),1),n(Ke),n(re,{class:"ml-2 mr-2",color:"primary"},{default:r(()=>[f(F(s.jobTitleGroups.reduce((u,a)=>u+a.matchings.length,0))+" matching"+F(s.jobTitleGroups.reduce((u,a)=>u+a.matchings.length,0)>1?"s":""),1)]),_:2},1024),n(I,null,{default:r(()=>[f(F(p(s.name)?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:2},1024)]),_:2},1032,["onClick"]),n(Be,null,{default:r(()=>[p(s.name)?(V(),$(Je,{key:0},{default:r(()=>[(V(!0),N(L,null,se(s.jobTitleGroups,u=>(V(),N("div",{key:u.jobTitle,class:"mb-4"},[J("h3",nt,[n(I,{class:"mr-1"},{default:r(()=>t[7]||(t[7]=[f("mdi-briefcase")])),_:1}),f(" "+F(u.jobTitle),1)]),n(Qe,{headers:B.value,items:u.matchings,class:"elevation-1 mb-4",density:"compact"},{"item.edit":r(({item:a})=>[n(Ze,{modelValue:a.editable,"onUpdate:modelValue":c=>a.editable=c,"hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),"item.offerDate":r(({item:a})=>[f(F(D(a.offerDate)),1)]),"item.score":r(({item:a})=>[n(re,{color:a.score>=30?"success":a.score>=10?"warning":"error",class:oe(a.score>=30?"text-white":""),size:"small"},{default:r(()=>[f(F(a.score),1)]),_:2},1032,["color","class"])]),"item.comment":r(({item:a})=>[n(tt,{modelValue:a.comment,"onUpdate:modelValue":c=>a.comment=c,disabled:!a.editable,density:"compact",variant:"outlined","hide-details":"",rows:"2",style:{width:"300px","text-align":"right"},class:"comment-textarea"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.statutMatching":r(({item:a})=>[n(Ye,{modelValue:a.statutMatching,"onUpdate:modelValue":c=>a.statutMatching=c,items:["Apply","NotApply","Rejected"],disabled:!a.editable,variant:"outlined",density:"compact","hide-details":"",style:{"max-width":"150px"}},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["headers","items"]),u.matchings.some(a=>a.editable)?(V(),N("div",st,[n(Z,{size:"small",color:"primary",onClick:a=>M(u.matchings)},{default:r(()=>t[8]||(t[8]=[f(" Sauvegarder ")])),_:2},1032,["onClick"])])):K("",!0)]))),128))]),_:2},1024)):K("",!0)]),_:2},1024)]),_:2},1024)]))),128))]),_:1}))}}),rt=De(ot,[["__scopeId","data-v-25792416"]]),gt=ge({__name:"table-matching",setup(e){return(k,h)=>(V(),$(rt))}});export{gt as default};
