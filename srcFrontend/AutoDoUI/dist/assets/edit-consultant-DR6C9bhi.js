import{_ as w,V as j}from"./VForm-BD57haRY.js";import{h as I,a5 as B,j as f,O as g,k as z,_ as S,o as E,i as q,w as r,f as a,n as h,a6 as F,a7 as N,V as O}from"./index-CXmdwxo-.js";import{V as L,a as J,b as M,c as A}from"./VCard-DpfQPIBz.js";import{V as G,a as n}from"./VRow-D9b1hgQV.js";import{V as u}from"./VTextField-DQoh-tBi.js";import{V as H}from"./VSwitch-Cb4-sE-K.js";import{V as K}from"./VSelect-BgZoX6lA.js";import{V as Q}from"./forwardRefs-BGojW5Df.js";const W=I({name:"EditConsultant",components:{GoBackBtn:w},setup(){const e=B(),l=f({email:"",availabilityDate:"",expirationDateCI:"",intern:!1,name:"",surname:"",enterprise:"",phone:"",copyCI:"",picture:""}),m=f([]),c=f(null),v=t=>(t==null?void 0:t.trim())!==""||"Champ obligatoire",b=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||"Format invalide (ex: exemple@mail.com)",V=t=>/^\+?[0-9]{9,15}$/.test(t)||"Format invalide (ex: +32444332211)",o=t=>/^(https?:\/\/)[^\s$.?#].[^\s]*$/.test(t)||"Lien invalide (ex: https://...)",R=t=>/^(https?:\/\/.*\.(?:png|jpg|jpeg|gif|webp))$/i.test(t)||"Lien image invalide (ex: https://site.com/photo.jpg)",U=t=>!!t||"Veuillez choisir une date",s="https://static.vecteezy.com/system/resources/thumbnails/003/337/584/small/default-avatar-photo-placeholder-profile-icon-vector.jpg",i=f(s),y=()=>{if(!l.value.picture||l.value.picture.trim()===""){i.value=s;return}const t=new Image;t.src=l.value.picture,t.onload=()=>{i.value=l.value.picture},t.onerror=()=>{i.value=s}},$=()=>{l.value.picture===s&&(l.value.picture="")},P=()=>{l.value.picture||(l.value.picture=s)},D=()=>{i.value=s};g(()=>l.value.picture,y),g(()=>l.value.intern,t=>{t?l.value.enterprise="O2do":l.value.enterprise=""});const k=async()=>{try{const t=await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/enterprise");if(!t.ok)throw new Error("Erreur lors du chargement des entreprises");const d=await t.json();m.value=d}catch(t){console.error("Erreur fetch entreprises :",t)}},T=async()=>{try{if((!l.value.picture||l.value.picture.trim()==="")&&(l.value.picture=s),!c.value||!(await c.value.validate()).valid)return;if(!(await fetch("https://autodo-fpe3azgvbvcxbgcx.westeurope-01.azurewebsites.net/consultant",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l.value)})).ok)throw new Error("Erreur lors de la modification du consultant");sessionStorage.setItem("selectedConsultant",JSON.stringify(l.value)),setTimeout(()=>{e.push("/consultant/consultant-info")},1e3)}catch(t){console.error(t instanceof Error?t.message:"Une erreur est survenue")}};return z(()=>{var d,C;k();const t=sessionStorage.getItem("editConsultant");if(t){const p=JSON.parse(t);p.expirationDateCI=((d=p.expirationDateCI)==null?void 0:d.split("T")[0])||"",p.availabilityDate=((C=p.availabilityDate)==null?void 0:C.split("T")[0])||"",Object.assign(l.value,p),y()}}),{consultant:l,enterprises:m,formRef:c,validPicture:i,required:v,emailRule:b,phoneRule:V,urlRule:o,imageUrlRule:R,dateRule:U,clearPlaceholder:$,restorePlaceholder:P,setPlaceholder:D,submitConsultant:T,placeholderImage:s}}});function X(e,l,m,c,v,b){const V=w;return E(),q(O,null,{default:r(()=>[a(L,{class:"pa-4"},{default:r(()=>[a(V,{class:"mb-4"}),a(J,{class:"text-h5 font-weight-bold"},{default:r(()=>l[10]||(l[10]=[h("Modifier Consultant")])),_:1}),a(M,null,{default:r(()=>[a(j,{ref:"formRef"},{default:r(()=>[a(G,null,{default:r(()=>[a(n,{cols:"12",class:"d-flex flex-column align-center"},{default:r(()=>[a(F,{size:"150"},{default:r(()=>[a(N,{src:e.validPicture,alt:"Photo Consultant",contain:"",onError:e.setPlaceholder},null,8,["src","onError"])]),_:1})]),_:1}),a(n,{cols:"12"},{default:r(()=>[a(u,{variant:"outlined",color:"primary",label:"Lien Photo *",modelValue:e.consultant.picture,"onUpdate:modelValue":l[0]||(l[0]=o=>e.consultant.picture=o),placeholder:e.placeholderImage,rules:[e.required,e.imageUrlRule],onFocus:e.clearPlaceholder,onBlur:e.restorePlaceholder},null,8,["modelValue","placeholder","rules","onFocus","onBlur"])]),_:1}),a(n,{cols:"6"},{default:r(()=>[a(u,{label:"Prénom *",modelValue:e.consultant.surname,"onUpdate:modelValue":l[1]||(l[1]=o=>e.consultant.surname=o),rules:[e.required],required:"",variant:"outlined",color:"primary"},null,8,["modelValue","rules"])]),_:1}),a(n,{cols:"6"},{default:r(()=>[a(u,{label:"Nom *",modelValue:e.consultant.name,"onUpdate:modelValue":l[2]||(l[2]=o=>e.consultant.name=o),rules:[e.required],required:"",variant:"outlined",color:"primary"},null,8,["modelValue","rules"])]),_:1}),a(n,{cols:"6"},{default:r(()=>[a(u,{label:"Lien Copie CI *",modelValue:e.consultant.copyCI,"onUpdate:modelValue":l[3]||(l[3]=o=>e.consultant.copyCI=o),rules:[e.required,e.urlRule],required:"",variant:"outlined",color:"primary"},null,8,["modelValue","rules"])]),_:1}),a(n,{cols:"6"},{default:r(()=>[a(u,{label:"Expiration CI *",modelValue:e.consultant.expirationDateCI,"onUpdate:modelValue":l[4]||(l[4]=o=>e.consultant.expirationDateCI=o),type:"date",rules:[e.required,e.dateRule],variant:"outlined",color:"primary"},null,8,["modelValue","rules"])]),_:1}),a(n,{cols:"6"},{default:r(()=>[a(H,{label:"Interne",modelValue:e.consultant.intern,"onUpdate:modelValue":l[5]||(l[5]=o=>e.consultant.intern=o),color:"primary"},null,8,["modelValue"])]),_:1}),a(n,{cols:"6"},{default:r(()=>[a(K,{label:"Entreprise *",modelValue:e.consultant.enterprise,"onUpdate:modelValue":l[6]||(l[6]=o=>e.consultant.enterprise=o),items:e.enterprises,"item-title":"name","item-value":"name",rules:[e.required],variant:"outlined",color:"primary",disabled:!!e.consultant.intern},null,8,["modelValue","items","rules","disabled"])]),_:1}),a(n,{cols:"6"},{default:r(()=>[a(u,{label:"Email *",modelValue:e.consultant.email,"onUpdate:modelValue":l[7]||(l[7]=o=>e.consultant.email=o),rules:[e.required,e.emailRule],required:"",variant:"outlined",color:"primary"},null,8,["modelValue","rules"])]),_:1}),a(n,{cols:"6"},{default:r(()=>[a(u,{label:"Téléphone *",modelValue:e.consultant.phone,"onUpdate:modelValue":l[8]||(l[8]=o=>e.consultant.phone=o),rules:[e.required,e.phoneRule],required:"",variant:"outlined",color:"primary"},null,8,["modelValue","rules"])]),_:1}),a(n,{cols:"6"},{default:r(()=>[a(u,{label:"Date de disponibilité *",modelValue:e.consultant.availabilityDate,"onUpdate:modelValue":l[9]||(l[9]=o=>e.consultant.availabilityDate=o),type:"date",rules:[e.required,e.dateRule],required:"",variant:"outlined",color:"primary"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),a(A,{class:"d-flex justify-end"},{default:r(()=>[a(Q,{color:"primary",onClick:e.submitConsultant},{default:r(()=>l[11]||(l[11]=[h("Modifier")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}const Y=S(W,[["render",X]]),re=I({__name:"edit-consultant",setup(e){return(l,m)=>(E(),q(Y))}});export{re as default};
